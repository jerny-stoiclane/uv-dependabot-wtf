import {
  AbstractLifeCycle,
  Batch,
  BoundedBuffer,
  ConsoleApiName,
  DefaultPrivacyLevel,
  ErrorSource,
  ExperimentalFeature,
  INTAKE_SITE_EU1,
  INTAKE_SITE_STAGING,
  INTAKE_SITE_US1,
  ONE_MINUTE,
  ONE_SECOND,
  Observable,
  PageExitReason,
  RawReportType,
  SESSION_TIME_OUT_DELAY,
  ValueHistory,
  addDuration,
  addEventListener,
  addEventListeners,
  addTelemetryConfiguration,
  addTelemetryDebug,
  addTelemetryError,
  arrayFrom,
  assign,
  buildUrl,
  callMonitored,
  canUseEventBridge,
  checkUser,
  clearInterval,
  clearTimeout,
  clocksNow,
  clocksOrigin,
  combine,
  computeBytesCount,
  computeRawError,
  computeStackTrace,
  concatBuffers,
  createContextManager,
  createEventRateLimiter,
  createFlushController,
  createHandlingStack,
  createHttpRequest,
  createPageExitObservable,
  cssEscape,
  currentDrift,
  dateNow,
  deepClone,
  defineGlobal,
  display,
  elapsed,
  elementMatches,
  find,
  findCommaSeparatedValue,
  findLast,
  forEach,
  generateUUID,
  getEventBridge,
  getGlobalObject,
  getOrigin,
  getPathName,
  getRelativeTime,
  getSyntheticsResultId,
  getSyntheticsTestId,
  getType,
  getZoneJsOriginalValue,
  includes,
  initConsoleObservable,
  initFetchObservable,
  initReportObservable,
  initXhrObservable,
  instrumentMethodAndCallOriginal,
  instrumentSetter,
  isEmptyObject,
  isExperimentalFeatureEnabled,
  isIE,
  isMatchOption,
  isNumber,
  isPageExitReason,
  isPercentage,
  isTelemetryReplicationAllowed,
  isValidUrl,
  jsonStringify,
  looksLikeRelativeTime,
  makePublicApi,
  mapValues,
  matchList,
  monitor,
  noop,
  objectEntries,
  objectHasValue,
  performDraw,
  readBytesFromStream,
  relativeNow,
  relativeToClocks,
  round,
  runOnReadyState,
  safeTruncate,
  sanitize,
  sanitizeUser,
  sendToExtension,
  serializeConfiguration,
  setInterval,
  setTimeout,
  shallowClone,
  startSessionManager,
  startTelemetry,
  startsWith,
  throttle,
  timeStampNow,
  toServerDuration,
  trackRuntimeError,
  tryToClone,
  validateAndBuildConfiguration,
  warnIfCustomerDataLimitReached,
  willSyntheticsInjectRum
} from "./chunk-6AG5JEVU.js";
import "./chunk-GFT2G5UO.js";

// ../../node_modules/@datadog/browser-rum-core/esm/domain/tracing/tracer.js
function isTracingOption(item) {
  var expectedItem = item;
  return getType(expectedItem) === "object" && isMatchOption(expectedItem.match) && Array.isArray(expectedItem.propagatorTypes);
}
function clearTracingIfNeeded(context) {
  if (context.status === 0 && !context.isAborted) {
    context.traceId = void 0;
    context.spanId = void 0;
    context.traceSampled = void 0;
  }
}
function startTracer(configuration, sessionManager) {
  return {
    clearTracingIfNeeded,
    traceFetch: function(context) {
      return injectHeadersIfTracingAllowed(configuration, context, sessionManager, function(tracingHeaders) {
        var _a2;
        if (context.input instanceof Request && !((_a2 = context.init) === null || _a2 === void 0 ? void 0 : _a2.headers)) {
          context.input = new Request(context.input);
          Object.keys(tracingHeaders).forEach(function(key) {
            ;
            context.input.headers.append(key, tracingHeaders[key]);
          });
        } else {
          context.init = shallowClone(context.init);
          var headers_1 = [];
          if (context.init.headers instanceof Headers) {
            context.init.headers.forEach(function(value, key) {
              headers_1.push([key, value]);
            });
          } else if (Array.isArray(context.init.headers)) {
            context.init.headers.forEach(function(header) {
              headers_1.push(header);
            });
          } else if (context.init.headers) {
            Object.keys(context.init.headers).forEach(function(key) {
              headers_1.push([key, context.init.headers[key]]);
            });
          }
          context.init.headers = headers_1.concat(objectEntries(tracingHeaders));
        }
      });
    },
    traceXhr: function(context, xhr) {
      return injectHeadersIfTracingAllowed(configuration, context, sessionManager, function(tracingHeaders) {
        Object.keys(tracingHeaders).forEach(function(name) {
          xhr.setRequestHeader(name, tracingHeaders[name]);
        });
      });
    }
  };
}
function injectHeadersIfTracingAllowed(configuration, context, sessionManager, inject) {
  if (!isTracingSupported() || !sessionManager.findTrackedSession()) {
    return;
  }
  var tracingOption = find(configuration.allowedTracingUrls, function(tracingOption2) {
    return matchList([tracingOption2.match], context.url, true);
  });
  if (!tracingOption) {
    return;
  }
  context.traceId = new TraceIdentifier();
  context.spanId = new TraceIdentifier();
  context.traceSampled = !isNumber(configuration.traceSampleRate) || performDraw(configuration.traceSampleRate);
  inject(makeTracingHeaders(context.traceId, context.spanId, context.traceSampled, tracingOption.propagatorTypes));
}
function isTracingSupported() {
  return getCrypto() !== void 0;
}
function getCrypto() {
  return window.crypto || window.msCrypto;
}
function makeTracingHeaders(traceId, spanId, traceSampled, propagatorTypes) {
  var tracingHeaders = {};
  propagatorTypes.forEach(function(propagatorType) {
    switch (propagatorType) {
      case "datadog": {
        assign(tracingHeaders, {
          "x-datadog-origin": "rum",
          "x-datadog-parent-id": spanId.toDecimalString(),
          "x-datadog-sampling-priority": traceSampled ? "1" : "0",
          "x-datadog-trace-id": traceId.toDecimalString()
        });
        break;
      }
      case "tracecontext": {
        assign(tracingHeaders, {
          traceparent: "00-0000000000000000".concat(traceId.toPaddedHexadecimalString(), "-").concat(spanId.toPaddedHexadecimalString(), "-0").concat(traceSampled ? "1" : "0")
        });
        break;
      }
      case "b3": {
        assign(tracingHeaders, {
          b3: "".concat(traceId.toPaddedHexadecimalString(), "-").concat(spanId.toPaddedHexadecimalString(), "-").concat(traceSampled ? "1" : "0")
        });
        break;
      }
      case "b3multi": {
        assign(tracingHeaders, {
          "X-B3-TraceId": traceId.toPaddedHexadecimalString(),
          "X-B3-SpanId": spanId.toPaddedHexadecimalString(),
          "X-B3-Sampled": traceSampled ? "1" : "0"
        });
        break;
      }
    }
  });
  return tracingHeaders;
}
var TraceIdentifier = (
  /** @class */
  function() {
    function TraceIdentifier2() {
      this.buffer = new Uint8Array(8);
      getCrypto().getRandomValues(this.buffer);
      this.buffer[0] = this.buffer[0] & 127;
    }
    TraceIdentifier2.prototype.toString = function(radix) {
      var high = this.readInt32(0);
      var low = this.readInt32(4);
      var str = "";
      do {
        var mod = high % radix * 4294967296 + low;
        high = Math.floor(high / radix);
        low = Math.floor(mod / radix);
        str = (mod % radix).toString(radix) + str;
      } while (high || low);
      return str;
    };
    TraceIdentifier2.prototype.toDecimalString = function() {
      return this.toString(10);
    };
    TraceIdentifier2.prototype.toPaddedHexadecimalString = function() {
      var traceId = this.toString(16);
      return Array(17 - traceId.length).join("0") + traceId;
    };
    TraceIdentifier2.prototype.readInt32 = function(offset) {
      return this.buffer[offset] * 16777216 + (this.buffer[offset + 1] << 16) + (this.buffer[offset + 2] << 8) + this.buffer[offset + 3];
    };
    return TraceIdentifier2;
  }()
);

// ../../node_modules/@datadog/browser-rum-core/esm/domain/configuration.js
function validateAndBuildRumConfiguration(initConfiguration) {
  var _a2, _b, _c, _d, _e, _f;
  if (!initConfiguration.applicationId) {
    display.error("Application ID is not configured, no RUM data will be collected.");
    return;
  }
  if (initConfiguration.sessionReplaySampleRate !== void 0 && !isPercentage(initConfiguration.sessionReplaySampleRate)) {
    display.error("Session Replay Sample Rate should be a number between 0 and 100");
    return;
  }
  var premiumSampleRate = (_a2 = initConfiguration.premiumSampleRate) !== null && _a2 !== void 0 ? _a2 : initConfiguration.replaySampleRate;
  if (premiumSampleRate !== void 0 && initConfiguration.sessionReplaySampleRate !== void 0) {
    display.warn("Ignoring Premium Sample Rate because Session Replay Sample Rate is set");
    premiumSampleRate = void 0;
  }
  if (premiumSampleRate !== void 0 && !isPercentage(premiumSampleRate)) {
    display.error("Premium Sample Rate should be a number between 0 and 100");
    return;
  }
  var traceSampleRate = (_b = initConfiguration.traceSampleRate) !== null && _b !== void 0 ? _b : initConfiguration.tracingSampleRate;
  if (traceSampleRate !== void 0 && !isPercentage(traceSampleRate)) {
    display.error("Trace Sample Rate should be a number between 0 and 100");
    return;
  }
  if (initConfiguration.excludedActivityUrls !== void 0 && !Array.isArray(initConfiguration.excludedActivityUrls)) {
    display.error("Excluded Activity Urls should be an array");
    return;
  }
  var allowedTracingUrls = validateAndBuildTracingOptions(initConfiguration);
  if (!allowedTracingUrls) {
    return;
  }
  var baseConfiguration = validateAndBuildConfiguration(initConfiguration);
  if (!baseConfiguration) {
    return;
  }
  var trackUserInteractions = !!((_c = initConfiguration.trackUserInteractions) !== null && _c !== void 0 ? _c : initConfiguration.trackInteractions);
  var trackFrustrations = !!initConfiguration.trackFrustrations;
  return assign({
    applicationId: initConfiguration.applicationId,
    version: initConfiguration.version,
    actionNameAttribute: initConfiguration.actionNameAttribute,
    sessionReplaySampleRate: (_e = (_d = initConfiguration.sessionReplaySampleRate) !== null && _d !== void 0 ? _d : premiumSampleRate) !== null && _e !== void 0 ? _e : 100,
    oldPlansBehavior: initConfiguration.sessionReplaySampleRate === void 0,
    traceSampleRate,
    allowedTracingUrls,
    excludedActivityUrls: (_f = initConfiguration.excludedActivityUrls) !== null && _f !== void 0 ? _f : [],
    trackUserInteractions: trackUserInteractions || trackFrustrations,
    trackFrustrations,
    trackViewsManually: !!initConfiguration.trackViewsManually,
    trackResources: initConfiguration.trackResources,
    trackLongTasks: initConfiguration.trackLongTasks,
    subdomain: initConfiguration.subdomain,
    defaultPrivacyLevel: objectHasValue(DefaultPrivacyLevel, initConfiguration.defaultPrivacyLevel) ? initConfiguration.defaultPrivacyLevel : DefaultPrivacyLevel.MASK_USER_INPUT,
    customerDataTelemetrySampleRate: 1
  }, baseConfiguration);
}
function validateAndBuildTracingOptions(initConfiguration) {
  if (initConfiguration.allowedTracingUrls !== void 0 && initConfiguration.allowedTracingOrigins !== void 0) {
    display.warn("Both allowedTracingUrls and allowedTracingOrigins (deprecated) have been defined. The parameter allowedTracingUrls will override allowedTracingOrigins.");
  }
  if (initConfiguration.allowedTracingUrls !== void 0) {
    if (!Array.isArray(initConfiguration.allowedTracingUrls)) {
      display.error("Allowed Tracing URLs should be an array");
      return;
    }
    if (initConfiguration.allowedTracingUrls.length !== 0 && initConfiguration.service === void 0) {
      display.error("Service needs to be configured when tracing is enabled");
      return;
    }
    var tracingOptions_1 = [];
    initConfiguration.allowedTracingUrls.forEach(function(option) {
      if (isMatchOption(option)) {
        tracingOptions_1.push({ match: option, propagatorTypes: ["datadog"] });
      } else if (isTracingOption(option)) {
        tracingOptions_1.push(option);
      } else {
        display.warn("Allowed Tracing Urls parameters should be a string, RegExp, function, or an object. Ignoring parameter", option);
      }
    });
    return tracingOptions_1;
  }
  if (initConfiguration.allowedTracingOrigins !== void 0) {
    if (!Array.isArray(initConfiguration.allowedTracingOrigins)) {
      display.error("Allowed Tracing Origins should be an array");
      return;
    }
    if (initConfiguration.allowedTracingOrigins.length !== 0 && initConfiguration.service === void 0) {
      display.error("Service needs to be configured when tracing is enabled");
      return;
    }
    var tracingOptions_2 = [];
    initConfiguration.allowedTracingOrigins.forEach(function(legacyMatchOption) {
      var tracingOption = convertLegacyMatchOptionToTracingOption(legacyMatchOption);
      if (tracingOption) {
        tracingOptions_2.push(tracingOption);
      }
    });
    return tracingOptions_2;
  }
  return [];
}
function convertLegacyMatchOptionToTracingOption(item) {
  var match;
  if (typeof item === "string") {
    match = item;
  } else if (item instanceof RegExp) {
    match = function(url) {
      return item.test(getOrigin(url));
    };
  } else if (typeof item === "function") {
    match = function(url) {
      return item(getOrigin(url));
    };
  }
  if (match === void 0) {
    display.warn("Allowed Tracing Origins parameters should be a string, RegExp or function. Ignoring parameter", item);
    return void 0;
  }
  return { match, propagatorTypes: ["datadog"] };
}
function getSelectedTracingPropagators(configuration) {
  var usedTracingPropagators = /* @__PURE__ */ new Set();
  if (Array.isArray(configuration.allowedTracingUrls) && configuration.allowedTracingUrls.length > 0) {
    configuration.allowedTracingUrls.forEach(function(option) {
      if (isMatchOption(option)) {
        usedTracingPropagators.add("datadog");
      } else if (getType(option) === "object" && Array.isArray(option.propagatorTypes)) {
        option.propagatorTypes.forEach(function(propagatorType) {
          return usedTracingPropagators.add(propagatorType);
        });
      }
    });
  }
  if (Array.isArray(configuration.allowedTracingOrigins) && configuration.allowedTracingOrigins.length > 0) {
    usedTracingPropagators.add("datadog");
  }
  return arrayFrom(usedTracingPropagators);
}
function serializeRumConfiguration(configuration) {
  var _a2, _b;
  var baseSerializedConfiguration = serializeConfiguration(configuration);
  return assign({
    premium_sample_rate: configuration.premiumSampleRate,
    replay_sample_rate: configuration.replaySampleRate,
    session_replay_sample_rate: configuration.sessionReplaySampleRate,
    trace_sample_rate: (_a2 = configuration.traceSampleRate) !== null && _a2 !== void 0 ? _a2 : configuration.tracingSampleRate,
    action_name_attribute: configuration.actionNameAttribute,
    use_allowed_tracing_origins: Array.isArray(configuration.allowedTracingOrigins) && configuration.allowedTracingOrigins.length > 0,
    use_allowed_tracing_urls: Array.isArray(configuration.allowedTracingUrls) && configuration.allowedTracingUrls.length > 0,
    selected_tracing_propagators: getSelectedTracingPropagators(configuration),
    default_privacy_level: configuration.defaultPrivacyLevel,
    use_excluded_activity_urls: Array.isArray(configuration.excludedActivityUrls) && configuration.excludedActivityUrls.length > 0,
    track_frustrations: configuration.trackFrustrations,
    track_views_manually: configuration.trackViewsManually,
    track_user_interactions: (_b = configuration.trackUserInteractions) !== null && _b !== void 0 ? _b : configuration.trackInteractions
  }, baseSerializedConfiguration);
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/contexts/commonContext.js
function buildCommonContext(globalContextManager, userContextManager, recorderApi2) {
  return {
    context: globalContextManager.getContext(),
    user: userContextManager.getContext(),
    hasReplay: recorderApi2.isRecording() ? true : void 0
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/boot/rumPublicApi.js
function makeRumPublicApi(startRumImpl, recorderApi2, _a2) {
  var _b = _a2 === void 0 ? {} : _a2, _c = _b.ignoreInitIfSyntheticsWillInjectRum, ignoreInitIfSyntheticsWillInjectRum = _c === void 0 ? true : _c;
  var isAlreadyInitialized = false;
  var globalContextManager = createContextManager(
    "global context"
    /* CustomerDataType.GlobalContext */
  );
  var userContextManager = createContextManager(
    "user"
    /* CustomerDataType.User */
  );
  var getInternalContextStrategy = function() {
    return void 0;
  };
  var getInitConfigurationStrategy = function() {
    return void 0;
  };
  var stopSessionStrategy = noop;
  var getSessionReplayLinkStrategy = function() {
    return void 0;
  };
  var bufferApiCalls = new BoundedBuffer();
  var addTimingStrategy = function(name, time) {
    if (time === void 0) {
      time = timeStampNow();
    }
    bufferApiCalls.add(function() {
      return addTimingStrategy(name, time);
    });
  };
  var startViewStrategy = function(options, startClocks) {
    if (startClocks === void 0) {
      startClocks = clocksNow();
    }
    bufferApiCalls.add(function() {
      return startViewStrategy(options, startClocks);
    });
  };
  var addActionStrategy = function(action, commonContext) {
    if (commonContext === void 0) {
      commonContext = buildCommonContext(globalContextManager, userContextManager, recorderApi2);
    }
    bufferApiCalls.add(function() {
      return addActionStrategy(action, commonContext);
    });
  };
  var addErrorStrategy = function(providedError, commonContext) {
    if (commonContext === void 0) {
      commonContext = buildCommonContext(globalContextManager, userContextManager, recorderApi2);
    }
    bufferApiCalls.add(function() {
      return addErrorStrategy(providedError, commonContext);
    });
  };
  var addFeatureFlagEvaluationStrategy = function(key, value) {
    bufferApiCalls.add(function() {
      return addFeatureFlagEvaluationStrategy(key, value);
    });
  };
  function initRum(initConfiguration) {
    getInitConfigurationStrategy = function() {
      return deepClone(initConfiguration);
    };
    if (ignoreInitIfSyntheticsWillInjectRum && willSyntheticsInjectRum()) {
      return;
    }
    var eventBridgeAvailable = canUseEventBridge();
    if (eventBridgeAvailable) {
      initConfiguration = overrideInitConfigurationForBridge(initConfiguration);
    }
    if (!canInitRum(initConfiguration)) {
      return;
    }
    var configuration = validateAndBuildRumConfiguration(initConfiguration);
    if (!configuration) {
      return;
    }
    if (!eventBridgeAvailable && !configuration.sessionStoreStrategyType) {
      display.warn("No storage available for session. We will not send any data.");
      return;
    }
    if (!configuration.trackViewsManually) {
      doStartRum(initConfiguration, configuration);
    } else {
      var beforeInitCalls = bufferApiCalls;
      bufferApiCalls = new BoundedBuffer();
      startViewStrategy = function(options) {
        doStartRum(initConfiguration, configuration, options);
      };
      beforeInitCalls.drain();
    }
    isAlreadyInitialized = true;
  }
  function doStartRum(initConfiguration, configuration, initialViewOptions) {
    var startRumResults = startRumImpl(initConfiguration, configuration, recorderApi2, globalContextManager, userContextManager, initialViewOptions);
    getSessionReplayLinkStrategy = function() {
      return recorderApi2.getSessionReplayLink(configuration, startRumResults.session, startRumResults.viewContexts);
    };
    startViewStrategy = startRumResults.startView, addActionStrategy = startRumResults.addAction, addErrorStrategy = startRumResults.addError, addTimingStrategy = startRumResults.addTiming, addFeatureFlagEvaluationStrategy = startRumResults.addFeatureFlagEvaluation, getInternalContextStrategy = startRumResults.getInternalContext, stopSessionStrategy = startRumResults.stopSession;
    bufferApiCalls.drain();
    recorderApi2.onRumStart(startRumResults.lifeCycle, configuration, startRumResults.session, startRumResults.viewContexts);
  }
  var startView = monitor(function(options) {
    var sanitizedOptions = typeof options === "object" ? options : { name: options };
    startViewStrategy(sanitizedOptions);
  });
  var rumPublicApi = makePublicApi({
    init: monitor(initRum),
    /** @deprecated: use setGlobalContextProperty instead */
    addRumGlobalContext: monitor(globalContextManager.add),
    setGlobalContextProperty: monitor(globalContextManager.setContextProperty),
    /** @deprecated: use removeGlobalContextProperty instead */
    removeRumGlobalContext: monitor(globalContextManager.remove),
    removeGlobalContextProperty: monitor(globalContextManager.removeContextProperty),
    /** @deprecated: use getGlobalContext instead */
    getRumGlobalContext: monitor(globalContextManager.get),
    getGlobalContext: monitor(globalContextManager.getContext),
    /** @deprecated: use setGlobalContext instead */
    setRumGlobalContext: monitor(globalContextManager.set),
    setGlobalContext: monitor(globalContextManager.setContext),
    clearGlobalContext: monitor(globalContextManager.clearContext),
    getInternalContext: monitor(function(startTime) {
      return getInternalContextStrategy(startTime);
    }),
    getInitConfiguration: monitor(function() {
      return getInitConfigurationStrategy();
    }),
    addAction: monitor(function(name, context) {
      addActionStrategy({
        name: sanitize(name),
        context: sanitize(context),
        startClocks: clocksNow(),
        type: "custom"
      });
    }),
    addError: function(error, context) {
      var handlingStack = createHandlingStack();
      callMonitored(function() {
        addErrorStrategy({
          error,
          handlingStack,
          context: sanitize(context),
          startClocks: clocksNow()
        });
      });
    },
    addTiming: monitor(function(name, time) {
      addTimingStrategy(sanitize(name), time);
    }),
    setUser: monitor(function(newUser) {
      if (checkUser(newUser)) {
        userContextManager.setContext(sanitizeUser(newUser));
      }
    }),
    getUser: monitor(userContextManager.getContext),
    setUserProperty: monitor(function(key, property) {
      var _a3;
      var sanitizedProperty = sanitizeUser((_a3 = {}, _a3[key] = property, _a3))[key];
      userContextManager.setContextProperty(key, sanitizedProperty);
    }),
    removeUserProperty: monitor(userContextManager.removeContextProperty),
    /** @deprecated: renamed to clearUser */
    removeUser: monitor(userContextManager.clearContext),
    clearUser: monitor(userContextManager.clearContext),
    startView,
    stopSession: monitor(function() {
      stopSessionStrategy();
    }),
    startSessionReplayRecording: monitor(recorderApi2.start),
    stopSessionReplayRecording: monitor(recorderApi2.stop),
    /**
     * This feature is currently in beta. For more information see the full [feature flag tracking guide](https://docs.datadoghq.com/real_user_monitoring/feature_flag_tracking/).
     */
    addFeatureFlagEvaluation: monitor(function(key, value) {
      addFeatureFlagEvaluationStrategy(sanitize(key), sanitize(value));
    }),
    getSessionReplayLink: monitor(function() {
      return getSessionReplayLinkStrategy();
    })
  });
  return rumPublicApi;
  function canInitRum(initConfiguration) {
    if (isAlreadyInitialized) {
      if (!initConfiguration.silentMultipleInit) {
        display.error("DD_RUM is already initialized.");
      }
      return false;
    }
    return true;
  }
  function overrideInitConfigurationForBridge(initConfiguration) {
    return assign({}, initConfiguration, {
      applicationId: "00000000-aaaa-0000-aaaa-000000000000",
      clientToken: "empty",
      sessionSampleRate: 100
    });
  }
}

// ../../node_modules/@datadog/browser-rum-core/esm/browser/domMutationObservable.js
function createDOMMutationObservable() {
  var MutationObserver = getMutationObserverConstructor();
  var observable = new Observable(function() {
    if (!MutationObserver) {
      return;
    }
    var observer = new MutationObserver(monitor(function() {
      return observable.notify();
    }));
    observer.observe(document, {
      attributes: true,
      characterData: true,
      childList: true,
      subtree: true
    });
    return function() {
      return observer.disconnect();
    };
  });
  return observable;
}
function getMutationObserverConstructor() {
  var constructor;
  var browserWindow = window;
  if (browserWindow.Zone) {
    constructor = getZoneJsOriginalValue(browserWindow, "MutationObserver");
    if (browserWindow.MutationObserver && constructor === browserWindow.MutationObserver) {
      var patchedInstance = new browserWindow.MutationObserver(noop);
      var originalInstance = getZoneJsOriginalValue(patchedInstance, "originalInstance");
      constructor = originalInstance && originalInstance.constructor;
    }
  }
  if (!constructor) {
    constructor = browserWindow.MutationObserver;
  }
  return constructor;
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/resource/resourceUtils.js
var FAKE_INITIAL_DOCUMENT = "initial_document";
var RESOURCE_TYPES = [
  ["document", function(initiatorType) {
    return FAKE_INITIAL_DOCUMENT === initiatorType;
  }],
  ["xhr", function(initiatorType) {
    return "xmlhttprequest" === initiatorType;
  }],
  ["fetch", function(initiatorType) {
    return "fetch" === initiatorType;
  }],
  ["beacon", function(initiatorType) {
    return "beacon" === initiatorType;
  }],
  ["css", function(_, path) {
    return /\.css$/i.test(path);
  }],
  ["js", function(_, path) {
    return /\.js$/i.test(path);
  }],
  [
    "image",
    function(initiatorType, path) {
      return includes(["image", "img", "icon"], initiatorType) || /\.(gif|jpg|jpeg|tiff|png|svg|ico)$/i.exec(path) !== null;
    }
  ],
  ["font", function(_, path) {
    return /\.(woff|eot|woff2|ttf)$/i.exec(path) !== null;
  }],
  [
    "media",
    function(initiatorType, path) {
      return includes(["audio", "video"], initiatorType) || /\.(mp3|mp4)$/i.exec(path) !== null;
    }
  ]
];
function computeResourceKind(timing) {
  var url = timing.name;
  if (!isValidUrl(url)) {
    addTelemetryDebug('Failed to construct URL for "'.concat(timing.name, '"'));
    return "other";
  }
  var path = getPathName(url);
  for (var _i = 0, RESOURCE_TYPES_1 = RESOURCE_TYPES; _i < RESOURCE_TYPES_1.length; _i++) {
    var _a2 = RESOURCE_TYPES_1[_i], type = _a2[0], isType = _a2[1];
    if (isType(timing.initiatorType, path)) {
      return type;
    }
  }
  return "other";
}
function areInOrder() {
  var numbers = [];
  for (var _i = 0; _i < arguments.length; _i++) {
    numbers[_i] = arguments[_i];
  }
  for (var i = 1; i < numbers.length; i += 1) {
    if (numbers[i - 1] > numbers[i]) {
      return false;
    }
  }
  return true;
}
function isRequestKind(timing) {
  return timing.initiatorType === "xmlhttprequest" || timing.initiatorType === "fetch";
}
function computePerformanceResourceDuration(entry) {
  var duration = entry.duration, startTime = entry.startTime, responseEnd = entry.responseEnd;
  if (duration === 0 && startTime < responseEnd) {
    return toServerDuration(elapsed(startTime, responseEnd));
  }
  return toServerDuration(duration);
}
function computePerformanceResourceDetails(entry) {
  var validEntry = toValidEntry(entry);
  if (!validEntry) {
    return void 0;
  }
  var startTime = validEntry.startTime, fetchStart = validEntry.fetchStart, redirectStart = validEntry.redirectStart, redirectEnd = validEntry.redirectEnd, domainLookupStart = validEntry.domainLookupStart, domainLookupEnd = validEntry.domainLookupEnd, connectStart = validEntry.connectStart, secureConnectionStart = validEntry.secureConnectionStart, connectEnd = validEntry.connectEnd, requestStart = validEntry.requestStart, responseStart = validEntry.responseStart, responseEnd = validEntry.responseEnd;
  var details = {
    download: formatTiming(startTime, responseStart, responseEnd),
    first_byte: formatTiming(startTime, requestStart, responseStart)
  };
  if (connectEnd !== fetchStart) {
    details.connect = formatTiming(startTime, connectStart, connectEnd);
    if (areInOrder(connectStart, secureConnectionStart, connectEnd)) {
      details.ssl = formatTiming(startTime, secureConnectionStart, connectEnd);
    }
  }
  if (domainLookupEnd !== fetchStart) {
    details.dns = formatTiming(startTime, domainLookupStart, domainLookupEnd);
  }
  if (hasRedirection(entry)) {
    details.redirect = formatTiming(startTime, redirectStart, redirectEnd);
  }
  return details;
}
function toValidEntry(entry) {
  if (!areInOrder(entry.startTime, entry.fetchStart, entry.domainLookupStart, entry.domainLookupEnd, entry.connectStart, entry.connectEnd, entry.requestStart, entry.responseStart, entry.responseEnd)) {
    return void 0;
  }
  if (!hasRedirection(entry)) {
    return entry;
  }
  var redirectStart = entry.redirectStart, redirectEnd = entry.redirectEnd;
  if (redirectStart < entry.startTime) {
    redirectStart = entry.startTime;
  }
  if (redirectEnd < entry.startTime) {
    redirectEnd = entry.fetchStart;
  }
  if (!areInOrder(entry.startTime, redirectStart, redirectEnd, entry.fetchStart)) {
    return void 0;
  }
  return assign({}, entry, {
    redirectEnd,
    redirectStart
  });
}
function hasRedirection(entry) {
  return entry.fetchStart !== entry.startTime;
}
function formatTiming(origin, start, end) {
  return {
    duration: toServerDuration(elapsed(start, end)),
    start: toServerDuration(elapsed(origin, start))
  };
}
function computeSize(entry) {
  if (entry.startTime < entry.responseStart) {
    return entry.decodedBodySize;
  }
  return void 0;
}
function isAllowedRequestUrl(configuration, url) {
  return url && !configuration.isIntakeUrl(url);
}

// ../../node_modules/@datadog/browser-rum-core/esm/browser/htmlDomUtils.js
function isTextNode(node) {
  return node.nodeType === Node.TEXT_NODE;
}
function isCommentNode(node) {
  return node.nodeType === Node.COMMENT_NODE;
}
function isElementNode(node) {
  return node.nodeType === Node.ELEMENT_NODE;
}
function isNodeShadowHost(node) {
  return isElementNode(node) && Boolean(node.shadowRoot);
}
function isNodeShadowRoot(node) {
  var shadowRoot = node;
  return !!shadowRoot.host && shadowRoot.nodeType === Node.DOCUMENT_FRAGMENT_NODE && isElementNode(shadowRoot.host);
}
function getChildNodes(node) {
  return isNodeShadowHost(node) ? node.shadowRoot.childNodes : node.childNodes;
}
function getParentNode(node) {
  return isNodeShadowRoot(node) ? node.host : node.parentNode;
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/tracing/getDocumentTraceId.js
var INITIAL_DOCUMENT_OUTDATED_TRACE_ID_THRESHOLD = 2 * ONE_MINUTE;
function getDocumentTraceId(document2) {
  var data = getDocumentTraceDataFromMeta(document2) || getDocumentTraceDataFromComment(document2);
  if (!data || data.traceTime <= dateNow() - INITIAL_DOCUMENT_OUTDATED_TRACE_ID_THRESHOLD) {
    return void 0;
  }
  return data.traceId;
}
function getDocumentTraceDataFromMeta(document2) {
  var traceIdMeta = document2.querySelector("meta[name=dd-trace-id]");
  var traceTimeMeta = document2.querySelector("meta[name=dd-trace-time]");
  return createDocumentTraceData(traceIdMeta && traceIdMeta.content, traceTimeMeta && traceTimeMeta.content);
}
function getDocumentTraceDataFromComment(document2) {
  var comment = findTraceComment(document2);
  if (!comment) {
    return void 0;
  }
  return createDocumentTraceData(findCommaSeparatedValue(comment, "trace-id"), findCommaSeparatedValue(comment, "trace-time"));
}
function createDocumentTraceData(traceId, rawTraceTime) {
  var traceTime = rawTraceTime && Number(rawTraceTime);
  if (!traceId || !traceTime) {
    return void 0;
  }
  return {
    traceId,
    traceTime
  };
}
function findTraceComment(document2) {
  for (var i = 0; i < document2.childNodes.length; i += 1) {
    var comment = getTraceCommentFromNode(document2.childNodes[i]);
    if (comment) {
      return comment;
    }
  }
  if (document2.body) {
    for (var i = document2.body.childNodes.length - 1; i >= 0; i -= 1) {
      var node = document2.body.childNodes[i];
      var comment = getTraceCommentFromNode(node);
      if (comment) {
        return comment;
      }
      if (!isTextNode(node)) {
        break;
      }
    }
  }
}
function getTraceCommentFromNode(node) {
  if (node && isCommentNode(node)) {
    var match = /^\s*DATADOG;(.*?)\s*$/.exec(node.data);
    if (match) {
      return match[1];
    }
  }
}

// ../../node_modules/@datadog/browser-rum-core/esm/browser/performanceCollection.js
function supportPerformanceObject() {
  return window.performance !== void 0 && "getEntries" in performance;
}
function supportPerformanceTimingEvent(entryType) {
  return window.PerformanceObserver && PerformanceObserver.supportedEntryTypes !== void 0 && PerformanceObserver.supportedEntryTypes.includes(entryType);
}
function startPerformanceCollection(lifeCycle, configuration) {
  retrieveInitialDocumentResourceTiming(function(timing) {
    handleRumPerformanceEntries(lifeCycle, configuration, [timing]);
  });
  if (supportPerformanceObject()) {
    var performanceEntries_1 = performance.getEntries();
    setTimeout(function() {
      return handleRumPerformanceEntries(lifeCycle, configuration, performanceEntries_1);
    });
  }
  if (window.PerformanceObserver) {
    var handlePerformanceEntryList_1 = monitor(function(entries) {
      return handleRumPerformanceEntries(lifeCycle, configuration, entries.getEntries());
    });
    var mainEntries = ["resource", "navigation", "longtask", "paint"];
    var experimentalEntries = ["largest-contentful-paint", "first-input", "layout-shift"];
    try {
      experimentalEntries.forEach(function(type) {
        var observer = new PerformanceObserver(handlePerformanceEntryList_1);
        observer.observe({ type, buffered: true });
      });
    } catch (e) {
      mainEntries.push.apply(mainEntries, experimentalEntries);
    }
    var mainObserver = new PerformanceObserver(handlePerformanceEntryList_1);
    mainObserver.observe({ entryTypes: mainEntries });
    if (supportPerformanceObject() && "addEventListener" in performance) {
      addEventListener(performance, "resourcetimingbufferfull", function() {
        performance.clearResourceTimings();
      });
    }
  }
  if (!supportPerformanceTimingEvent("navigation")) {
    retrieveNavigationTiming(function(timing) {
      handleRumPerformanceEntries(lifeCycle, configuration, [timing]);
    });
  }
  if (!supportPerformanceTimingEvent("first-input")) {
    retrieveFirstInputTiming(function(timing) {
      handleRumPerformanceEntries(lifeCycle, configuration, [timing]);
    });
  }
}
function retrieveInitialDocumentResourceTiming(callback) {
  runOnReadyState("interactive", function() {
    var timing;
    var forcedAttributes = {
      entryType: "resource",
      initiatorType: FAKE_INITIAL_DOCUMENT,
      traceId: getDocumentTraceId(document)
    };
    if (supportPerformanceTimingEvent("navigation") && performance.getEntriesByType("navigation").length > 0) {
      var navigationEntry = performance.getEntriesByType("navigation")[0];
      timing = assign(navigationEntry.toJSON(), forcedAttributes);
    } else {
      var relativePerformanceTiming = computeRelativePerformanceTiming();
      timing = assign(relativePerformanceTiming, {
        decodedBodySize: 0,
        duration: relativePerformanceTiming.responseEnd,
        name: window.location.href,
        startTime: 0
      }, forcedAttributes);
    }
    callback(timing);
  });
}
function retrieveNavigationTiming(callback) {
  function sendFakeTiming() {
    callback(assign(computeRelativePerformanceTiming(), {
      entryType: "navigation"
    }));
  }
  runOnReadyState("complete", function() {
    setTimeout(sendFakeTiming);
  });
}
function retrieveFirstInputTiming(callback) {
  var startTimeStamp = dateNow();
  var timingSent = false;
  var removeEventListeners = addEventListeners(window, [
    "click",
    "mousedown",
    "keydown",
    "touchstart",
    "pointerdown"
    /* DOM_EVENT.POINTER_DOWN */
  ], function(evt) {
    if (!evt.cancelable) {
      return;
    }
    var timing = {
      entryType: "first-input",
      processingStart: relativeNow(),
      startTime: evt.timeStamp
    };
    if (evt.type === "pointerdown") {
      sendTimingIfPointerIsNotCancelled(timing);
    } else {
      sendTiming(timing);
    }
  }, { passive: true, capture: true }).stop;
  function sendTimingIfPointerIsNotCancelled(timing) {
    addEventListeners(window, [
      "pointerup",
      "pointercancel"
      /* DOM_EVENT.POINTER_CANCEL */
    ], function(event) {
      if (event.type === "pointerup") {
        sendTiming(timing);
      }
    }, { once: true });
  }
  function sendTiming(timing) {
    if (!timingSent) {
      timingSent = true;
      removeEventListeners();
      var delay = timing.processingStart - timing.startTime;
      if (delay >= 0 && delay < dateNow() - startTimeStamp) {
        callback(timing);
      }
    }
  }
}
function computeRelativePerformanceTiming() {
  var result = {};
  var timing = performance.timing;
  for (var key in timing) {
    if (isNumber(timing[key])) {
      var numberKey = key;
      var timingElement = timing[numberKey];
      result[numberKey] = timingElement === 0 ? 0 : getRelativeTime(timingElement);
    }
  }
  return result;
}
function handleRumPerformanceEntries(lifeCycle, configuration, entries) {
  var rumPerformanceEntries = entries.filter(function(entry) {
    return entry.entryType === "resource" || entry.entryType === "navigation" || entry.entryType === "paint" || entry.entryType === "longtask" || entry.entryType === "largest-contentful-paint" || entry.entryType === "first-input" || entry.entryType === "layout-shift";
  });
  var rumAllowedPerformanceEntries = rumPerformanceEntries.filter(function(entry) {
    return !isIncompleteNavigation(entry) && !isForbiddenResource(configuration, entry);
  });
  if (rumAllowedPerformanceEntries.length) {
    lifeCycle.notify(0, rumAllowedPerformanceEntries);
  }
}
function isIncompleteNavigation(entry) {
  return entry.entryType === "navigation" && entry.loadEventEnd <= 0;
}
function isForbiddenResource(configuration, entry) {
  return entry.entryType === "resource" && !isAllowedRequestUrl(configuration, entry.name);
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/contexts/syntheticsContext.js
function getSyntheticsContext() {
  var testId = getSyntheticsTestId();
  var resultId = getSyntheticsResultId();
  if (testId && resultId) {
    return {
      test_id: testId,
      result_id: resultId,
      injected: willSyntheticsInjectRum()
    };
  }
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/contexts/ciTestContext.js
function getCiTestContext() {
  var _a2;
  var testExecutionId = (_a2 = window.Cypress) === null || _a2 === void 0 ? void 0 : _a2.env("traceId");
  if (typeof testExecutionId === "string") {
    return {
      test_execution_id: testExecutionId
    };
  }
}

// ../../node_modules/@datadog/browser-rum-core/esm/browser/viewportObservable.js
var viewportObservable;
function initViewportObservable() {
  if (!viewportObservable) {
    viewportObservable = createViewportObservable();
  }
  return viewportObservable;
}
function createViewportObservable() {
  var observable = new Observable(function() {
    var updateDimension = throttle(function() {
      observable.notify(getViewportDimension());
    }, 200).throttled;
    return addEventListener(window, "resize", updateDimension, { capture: true, passive: true }).stop;
  });
  return observable;
}
function getViewportDimension() {
  var visual = window.visualViewport;
  if (visual) {
    return {
      width: Number(visual.width * visual.scale),
      height: Number(visual.height * visual.scale)
    };
  }
  return {
    width: Number(window.innerWidth || 0),
    height: Number(window.innerHeight || 0)
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/contexts/displayContext.js
var viewport;
var stopListeners;
function getDisplayContext() {
  if (!viewport) {
    viewport = getViewportDimension();
    stopListeners = initViewportObservable().subscribe(function(viewportDimension) {
      viewport = viewportDimension;
    }).unsubscribe;
  }
  return {
    viewport
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/limitModification.js
function limitModification(object, modifiableFieldPaths, modifier) {
  var clone = deepClone(object);
  var result = modifier(clone);
  objectEntries(modifiableFieldPaths).forEach(function(_a2) {
    var fieldPath = _a2[0], fieldType = _a2[1];
    var newValue = get(clone, fieldPath);
    var newType = getType(newValue);
    if (newType === fieldType) {
      set(object, fieldPath, sanitize(newValue));
    } else if (fieldType === "object" && (newType === "undefined" || newType === "null")) {
      set(object, fieldPath, {});
    }
  });
  return result;
}
function get(object, path) {
  var current = object;
  for (var _i = 0, _a2 = path.split("."); _i < _a2.length; _i++) {
    var field = _a2[_i];
    if (!isValidObjectContaining(current, field)) {
      return;
    }
    current = current[field];
  }
  return current;
}
function set(object, path, value) {
  var current = object;
  var fields = path.split(".");
  for (var i = 0; i < fields.length; i += 1) {
    var field = fields[i];
    if (!isValidObject(current)) {
      return;
    }
    if (i !== fields.length - 1) {
      current = current[field];
    } else {
      current[field] = value;
    }
  }
}
function isValidObject(object) {
  return getType(object) === "object";
}
function isValidObjectContaining(object, field) {
  return isValidObject(object) && Object.prototype.hasOwnProperty.call(object, field);
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/assembly.js
var VIEW_MODIFIABLE_FIELD_PATHS = {
  "view.url": "string",
  "view.referrer": "string"
};
var USER_CUSTOMIZABLE_FIELD_PATHS = {
  context: "object"
};
var modifiableFieldPathsByEvent;
function startRumAssembly(configuration, lifeCycle, sessionManager, viewContexts, urlContexts, actionContexts, buildCommonContext2, reportError) {
  var _a2, _b;
  modifiableFieldPathsByEvent = (_a2 = {}, _a2[
    "view"
    /* RumEventType.VIEW */
  ] = VIEW_MODIFIABLE_FIELD_PATHS, _a2[
    "error"
    /* RumEventType.ERROR */
  ] = assign({
    "error.message": "string",
    "error.stack": "string",
    "error.resource.url": "string",
    "error.fingerprint": "string"
  }, USER_CUSTOMIZABLE_FIELD_PATHS, VIEW_MODIFIABLE_FIELD_PATHS), _a2[
    "resource"
    /* RumEventType.RESOURCE */
  ] = assign({
    "resource.url": "string"
  }, USER_CUSTOMIZABLE_FIELD_PATHS, VIEW_MODIFIABLE_FIELD_PATHS), _a2[
    "action"
    /* RumEventType.ACTION */
  ] = assign({
    "action.target.name": "string"
  }, USER_CUSTOMIZABLE_FIELD_PATHS, VIEW_MODIFIABLE_FIELD_PATHS), _a2[
    "long_task"
    /* RumEventType.LONG_TASK */
  ] = assign({}, USER_CUSTOMIZABLE_FIELD_PATHS, VIEW_MODIFIABLE_FIELD_PATHS), _a2);
  var eventRateLimiters = (_b = {}, _b[
    "error"
    /* RumEventType.ERROR */
  ] = createEventRateLimiter("error", configuration.eventRateLimiterThreshold, reportError), _b[
    "action"
    /* RumEventType.ACTION */
  ] = createEventRateLimiter("action", configuration.eventRateLimiterThreshold, reportError), _b);
  var syntheticsContext = getSyntheticsContext();
  var ciTestContext = getCiTestContext();
  lifeCycle.subscribe(10, function(_a3) {
    var startTime = _a3.startTime, rawRumEvent = _a3.rawRumEvent, domainContext = _a3.domainContext, savedCommonContext = _a3.savedCommonContext, customerContext = _a3.customerContext;
    var viewContext = viewContexts.findView(startTime);
    var urlContext = urlContexts.findUrl(startTime);
    var session = sessionManager.findTrackedSession(startTime);
    if (session && viewContext && urlContext) {
      var commonContext = savedCommonContext || buildCommonContext2();
      var actionId = actionContexts.findActionId(startTime);
      var rumContext = {
        _dd: {
          format_version: 2,
          drift: currentDrift(),
          session: {
            plan: session.plan
          },
          configuration: {
            session_sample_rate: round(configuration.sessionSampleRate, 3),
            session_replay_sample_rate: round(configuration.sessionReplaySampleRate, 3)
          },
          browser_sdk_version: canUseEventBridge() ? "4.46.0" : void 0
        },
        application: {
          id: configuration.applicationId
        },
        date: timeStampNow(),
        service: viewContext.service || configuration.service,
        version: viewContext.version || configuration.version,
        source: "browser",
        session: {
          id: session.id,
          type: syntheticsContext ? "synthetics" : ciTestContext ? "ci_test" : "user"
        },
        view: {
          id: viewContext.id,
          name: viewContext.name,
          url: urlContext.url,
          referrer: urlContext.referrer
        },
        action: needToAssembleWithAction(rawRumEvent) && actionId ? { id: actionId } : void 0,
        synthetics: syntheticsContext,
        ci_test: ciTestContext,
        display: getDisplayContext()
      };
      var serverRumEvent = combine(rumContext, rawRumEvent);
      serverRumEvent.context = combine(commonContext.context, customerContext);
      if (!("has_replay" in serverRumEvent.session)) {
        ;
        serverRumEvent.session.has_replay = commonContext.hasReplay;
      }
      if (!isEmptyObject(commonContext.user)) {
        ;
        serverRumEvent.usr = commonContext.user;
      }
      if (shouldSend(serverRumEvent, configuration.beforeSend, domainContext, eventRateLimiters)) {
        if (isEmptyObject(serverRumEvent.context)) {
          delete serverRumEvent.context;
        }
        lifeCycle.notify(11, serverRumEvent);
      }
    }
  });
}
function shouldSend(event, beforeSend, domainContext, eventRateLimiters) {
  var _a2;
  if (beforeSend) {
    var result = limitModification(event, modifiableFieldPathsByEvent[event.type], function(event2) {
      return beforeSend(event2, domainContext);
    });
    if (result === false && event.type !== "view") {
      return false;
    }
    if (result === false) {
      display.warn("Can't dismiss view events using beforeSend!");
    }
  }
  var rateLimitReached = (_a2 = eventRateLimiters[event.type]) === null || _a2 === void 0 ? void 0 : _a2.isLimitReached();
  return !rateLimitReached;
}
function needToAssembleWithAction(event) {
  return [
    "error",
    "resource",
    "long_task"
    /* RumEventType.LONG_TASK */
  ].indexOf(event.type) !== -1;
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/contexts/internalContext.js
function startInternalContext(applicationId, sessionManager, viewContexts, actionContexts, urlContexts) {
  return {
    get: function(startTime) {
      var viewContext = viewContexts.findView(startTime);
      var urlContext = urlContexts.findUrl(startTime);
      var session = sessionManager.findTrackedSession(startTime);
      if (session && viewContext && urlContext) {
        var actionId = actionContexts.findActionId(startTime);
        return {
          application_id: applicationId,
          session_id: session.id,
          user_action: actionId ? { id: actionId } : void 0,
          view: { id: viewContext.id, name: viewContext.name, referrer: urlContext.referrer, url: urlContext.url }
        };
      }
    }
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/lifeCycle.js
var LifeCycle = AbstractLifeCycle;

// ../../node_modules/@datadog/browser-rum-core/esm/domain/contexts/viewContexts.js
var VIEW_CONTEXT_TIME_OUT_DELAY = SESSION_TIME_OUT_DELAY;
function startViewContexts(lifeCycle) {
  var viewContextHistory = new ValueHistory(VIEW_CONTEXT_TIME_OUT_DELAY);
  lifeCycle.subscribe(2, function(view) {
    viewContextHistory.add(buildViewContext(view), view.startClocks.relative);
  });
  lifeCycle.subscribe(4, function(_a2) {
    var endClocks = _a2.endClocks;
    viewContextHistory.closeActive(endClocks.relative);
  });
  lifeCycle.subscribe(8, function() {
    viewContextHistory.reset();
  });
  function buildViewContext(view) {
    return {
      service: view.service,
      version: view.version,
      id: view.id,
      name: view.name,
      startClocks: view.startClocks
    };
  }
  return {
    findView: function(startTime) {
      return viewContextHistory.find(startTime);
    },
    stop: function() {
      viewContextHistory.stop();
    }
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/requestCollection.js
var nextRequestIndex = 1;
function startRequestCollection(lifeCycle, configuration, sessionManager) {
  var tracer = startTracer(configuration, sessionManager);
  trackXhr(lifeCycle, configuration, tracer);
  trackFetch(lifeCycle, configuration, tracer);
}
function trackXhr(lifeCycle, configuration, tracer) {
  var subscription = initXhrObservable().subscribe(function(rawContext) {
    var context = rawContext;
    if (!isAllowedRequestUrl(configuration, context.url)) {
      return;
    }
    switch (context.state) {
      case "start":
        tracer.traceXhr(context, context.xhr);
        context.requestIndex = getNextRequestIndex();
        lifeCycle.notify(5, {
          requestIndex: context.requestIndex,
          url: context.url
        });
        break;
      case "complete":
        tracer.clearTracingIfNeeded(context);
        lifeCycle.notify(6, {
          duration: context.duration,
          method: context.method,
          requestIndex: context.requestIndex,
          spanId: context.spanId,
          startClocks: context.startClocks,
          status: context.status,
          traceId: context.traceId,
          traceSampled: context.traceSampled,
          type: "xhr",
          url: context.url,
          xhr: context.xhr
        });
        break;
    }
  });
  return { stop: function() {
    return subscription.unsubscribe();
  } };
}
function trackFetch(lifeCycle, configuration, tracer) {
  var subscription = initFetchObservable().subscribe(function(rawContext) {
    var context = rawContext;
    if (!isAllowedRequestUrl(configuration, context.url)) {
      return;
    }
    switch (context.state) {
      case "start":
        tracer.traceFetch(context);
        context.requestIndex = getNextRequestIndex();
        lifeCycle.notify(5, {
          requestIndex: context.requestIndex,
          url: context.url
        });
        break;
      case "resolve":
        waitForResponseToComplete(context, function(duration) {
          tracer.clearTracingIfNeeded(context);
          lifeCycle.notify(6, {
            duration,
            method: context.method,
            requestIndex: context.requestIndex,
            responseType: context.responseType,
            spanId: context.spanId,
            startClocks: context.startClocks,
            status: context.status,
            traceId: context.traceId,
            traceSampled: context.traceSampled,
            type: "fetch",
            url: context.url,
            response: context.response,
            init: context.init,
            input: context.input
          });
        });
        break;
    }
  });
  return { stop: function() {
    return subscription.unsubscribe();
  } };
}
function getNextRequestIndex() {
  var result = nextRequestIndex;
  nextRequestIndex += 1;
  return result;
}
function waitForResponseToComplete(context, callback) {
  var clonedResponse = context.response && tryToClone(context.response);
  if (!clonedResponse || !clonedResponse.body) {
    callback(elapsed(context.startClocks.timeStamp, timeStampNow()));
  } else {
    readBytesFromStream(clonedResponse.body, function() {
      callback(elapsed(context.startClocks.timeStamp, timeStampNow()));
    }, {
      bytesLimit: Number.POSITIVE_INFINITY,
      collectStreamBody: false
    });
  }
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/trackEventCounts.js
function trackEventCounts(_a2) {
  var lifeCycle = _a2.lifeCycle, isChildEvent = _a2.isChildEvent, _b = _a2.onChange, callback = _b === void 0 ? noop : _b;
  var eventCounts = {
    errorCount: 0,
    longTaskCount: 0,
    resourceCount: 0,
    actionCount: 0,
    frustrationCount: 0
  };
  var subscription = lifeCycle.subscribe(11, function(event) {
    if (event.type === "view" || !isChildEvent(event)) {
      return;
    }
    switch (event.type) {
      case "error":
        eventCounts.errorCount += 1;
        callback();
        break;
      case "action":
        eventCounts.actionCount += 1;
        if (event.action.frustration) {
          eventCounts.frustrationCount += event.action.frustration.type.length;
        }
        callback();
        break;
      case "long_task":
        eventCounts.longTaskCount += 1;
        callback();
        break;
      case "resource":
        eventCounts.resourceCount += 1;
        callback();
        break;
    }
  });
  return {
    stop: function() {
      subscription.unsubscribe();
    },
    eventCounts
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/waitPageActivityEnd.js
var PAGE_ACTIVITY_VALIDATION_DELAY = 100;
var PAGE_ACTIVITY_END_DELAY = 100;
function waitPageActivityEnd(lifeCycle, domMutationObservable, configuration, pageActivityEndCallback, maxDuration) {
  var pageActivityObservable = createPageActivityObservable(lifeCycle, domMutationObservable, configuration);
  return doWaitPageActivityEnd(pageActivityObservable, pageActivityEndCallback, maxDuration);
}
function doWaitPageActivityEnd(pageActivityObservable, pageActivityEndCallback, maxDuration) {
  var pageActivityEndTimeoutId;
  var hasCompleted = false;
  var validationTimeoutId = setTimeout(monitor(function() {
    return complete({ hadActivity: false });
  }), PAGE_ACTIVITY_VALIDATION_DELAY);
  var maxDurationTimeoutId = maxDuration !== void 0 ? setTimeout(monitor(function() {
    return complete({ hadActivity: true, end: timeStampNow() });
  }), maxDuration) : void 0;
  var pageActivitySubscription = pageActivityObservable.subscribe(function(_a2) {
    var isBusy = _a2.isBusy;
    clearTimeout(validationTimeoutId);
    clearTimeout(pageActivityEndTimeoutId);
    var lastChangeTime = timeStampNow();
    if (!isBusy) {
      pageActivityEndTimeoutId = setTimeout(monitor(function() {
        return complete({ hadActivity: true, end: lastChangeTime });
      }), PAGE_ACTIVITY_END_DELAY);
    }
  });
  var stop = function() {
    hasCompleted = true;
    clearTimeout(validationTimeoutId);
    clearTimeout(pageActivityEndTimeoutId);
    clearTimeout(maxDurationTimeoutId);
    pageActivitySubscription.unsubscribe();
  };
  function complete(event) {
    if (hasCompleted) {
      return;
    }
    stop();
    pageActivityEndCallback(event);
  }
  return { stop };
}
function createPageActivityObservable(lifeCycle, domMutationObservable, configuration) {
  var observable = new Observable(function() {
    var subscriptions = [];
    var firstRequestIndex;
    var pendingRequestsCount = 0;
    subscriptions.push(domMutationObservable.subscribe(notifyPageActivity), lifeCycle.subscribe(0, function(entries) {
      if (entries.some(function(entry) {
        return entry.entryType === "resource" && !isExcludedUrl(configuration, entry.name);
      })) {
        notifyPageActivity();
      }
    }), lifeCycle.subscribe(5, function(startEvent) {
      if (isExcludedUrl(configuration, startEvent.url)) {
        return;
      }
      if (firstRequestIndex === void 0) {
        firstRequestIndex = startEvent.requestIndex;
      }
      pendingRequestsCount += 1;
      notifyPageActivity();
    }), lifeCycle.subscribe(6, function(request) {
      if (isExcludedUrl(configuration, request.url) || firstRequestIndex === void 0 || // If the request started before the tracking start, ignore it
      request.requestIndex < firstRequestIndex) {
        return;
      }
      pendingRequestsCount -= 1;
      notifyPageActivity();
    }));
    var stopTrackingWindowOpen = trackWindowOpen(notifyPageActivity).stop;
    return function() {
      stopTrackingWindowOpen();
      subscriptions.forEach(function(s) {
        return s.unsubscribe();
      });
    };
    function notifyPageActivity() {
      observable.notify({ isBusy: pendingRequestsCount > 0 });
    }
  });
  return observable;
}
function isExcludedUrl(configuration, requestUrl) {
  return matchList(configuration.excludedActivityUrls, requestUrl);
}
function trackWindowOpen(callback) {
  return instrumentMethodAndCallOriginal(window, "open", { before: callback });
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/action/clickChain.js
var MAX_DURATION_BETWEEN_CLICKS = ONE_SECOND;
var MAX_DISTANCE_BETWEEN_CLICKS = 100;
function createClickChain(firstClick, onFinalize) {
  var bufferedClicks = [];
  var status = 0;
  var maxDurationBetweenClicksTimeoutId;
  appendClick(firstClick);
  function appendClick(click) {
    click.stopObservable.subscribe(tryFinalize);
    bufferedClicks.push(click);
    clearTimeout(maxDurationBetweenClicksTimeoutId);
    maxDurationBetweenClicksTimeoutId = setTimeout(dontAcceptMoreClick, MAX_DURATION_BETWEEN_CLICKS);
  }
  function tryFinalize() {
    if (status === 1 && bufferedClicks.every(function(click) {
      return click.isStopped();
    })) {
      status = 2;
      onFinalize(bufferedClicks);
    }
  }
  function dontAcceptMoreClick() {
    clearTimeout(maxDurationBetweenClicksTimeoutId);
    if (status === 0) {
      status = 1;
      tryFinalize();
    }
  }
  return {
    tryAppend: function(click) {
      if (status !== 0) {
        return false;
      }
      if (bufferedClicks.length > 0 && !areEventsSimilar(bufferedClicks[bufferedClicks.length - 1].event, click.event)) {
        dontAcceptMoreClick();
        return false;
      }
      appendClick(click);
      return true;
    },
    stop: function() {
      dontAcceptMoreClick();
    }
  };
}
function areEventsSimilar(first, second) {
  return first.target === second.target && mouseEventDistance(first, second) <= MAX_DISTANCE_BETWEEN_CLICKS && first.timeStamp - second.timeStamp <= MAX_DURATION_BETWEEN_CLICKS;
}
function mouseEventDistance(origin, other) {
  return Math.sqrt(Math.pow(origin.clientX - other.clientX, 2) + Math.pow(origin.clientY - other.clientY, 2));
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/action/getActionNameFromElement.js
var DEFAULT_PROGRAMMATIC_ACTION_NAME_ATTRIBUTE = "data-dd-action-name";
function getActionNameFromElement(element, userProgrammaticAttribute) {
  return getActionNameFromElementProgrammatically(element, DEFAULT_PROGRAMMATIC_ACTION_NAME_ATTRIBUTE) || userProgrammaticAttribute && getActionNameFromElementProgrammatically(element, userProgrammaticAttribute) || getActionNameFromElementForStrategies(element, userProgrammaticAttribute, priorityStrategies) || getActionNameFromElementForStrategies(element, userProgrammaticAttribute, fallbackStrategies) || "";
}
function getActionNameFromElementProgrammatically(targetElement, programmaticAttribute) {
  var elementWithAttribute;
  if (supportsElementClosest()) {
    elementWithAttribute = targetElement.closest("[".concat(programmaticAttribute, "]"));
  } else {
    var element = targetElement;
    while (element) {
      if (element.hasAttribute(programmaticAttribute)) {
        elementWithAttribute = element;
        break;
      }
      element = element.parentElement;
    }
  }
  if (!elementWithAttribute) {
    return;
  }
  var name = elementWithAttribute.getAttribute(programmaticAttribute);
  return truncate(normalizeWhitespace(name.trim()));
}
var priorityStrategies = [
  // associated LABEL text
  function(element, userProgrammaticAttribute) {
    if (supportsLabelProperty()) {
      if ("labels" in element && element.labels && element.labels.length > 0) {
        return getTextualContent(element.labels[0], userProgrammaticAttribute);
      }
    } else if (element.id) {
      var label = element.ownerDocument && find(element.ownerDocument.querySelectorAll("label"), function(label2) {
        return label2.htmlFor === element.id;
      });
      return label && getTextualContent(label, userProgrammaticAttribute);
    }
  },
  // INPUT button (and associated) value
  function(element) {
    if (element.nodeName === "INPUT") {
      var input = element;
      var type = input.getAttribute("type");
      if (type === "button" || type === "submit" || type === "reset") {
        return input.value;
      }
    }
  },
  // BUTTON, LABEL or button-like element text
  function(element, userProgrammaticAttribute) {
    if (element.nodeName === "BUTTON" || element.nodeName === "LABEL" || element.getAttribute("role") === "button") {
      return getTextualContent(element, userProgrammaticAttribute);
    }
  },
  function(element) {
    return element.getAttribute("aria-label");
  },
  // associated element text designated by the aria-labelledby attribute
  function(element, userProgrammaticAttribute) {
    var labelledByAttribute = element.getAttribute("aria-labelledby");
    if (labelledByAttribute) {
      return labelledByAttribute.split(/\s+/).map(function(id) {
        return getElementById(element, id);
      }).filter(function(label) {
        return Boolean(label);
      }).map(function(element2) {
        return getTextualContent(element2, userProgrammaticAttribute);
      }).join(" ");
    }
  },
  function(element) {
    return element.getAttribute("alt");
  },
  function(element) {
    return element.getAttribute("name");
  },
  function(element) {
    return element.getAttribute("title");
  },
  function(element) {
    return element.getAttribute("placeholder");
  },
  // SELECT first OPTION text
  function(element, userProgrammaticAttribute) {
    if ("options" in element && element.options.length > 0) {
      return getTextualContent(element.options[0], userProgrammaticAttribute);
    }
  }
];
var fallbackStrategies = [
  function(element, userProgrammaticAttribute) {
    return getTextualContent(element, userProgrammaticAttribute);
  }
];
var MAX_PARENTS_TO_CONSIDER = 10;
function getActionNameFromElementForStrategies(targetElement, userProgrammaticAttribute, strategies) {
  var element = targetElement;
  var recursionCounter = 0;
  while (recursionCounter <= MAX_PARENTS_TO_CONSIDER && element && element.nodeName !== "BODY" && element.nodeName !== "HTML" && element.nodeName !== "HEAD") {
    for (var _i = 0, strategies_1 = strategies; _i < strategies_1.length; _i++) {
      var strategy = strategies_1[_i];
      var name_1 = strategy(element, userProgrammaticAttribute);
      if (typeof name_1 === "string") {
        var trimmedName = name_1.trim();
        if (trimmedName) {
          return truncate(normalizeWhitespace(trimmedName));
        }
      }
    }
    if (element.nodeName === "FORM") {
      break;
    }
    element = element.parentElement;
    recursionCounter += 1;
  }
}
function normalizeWhitespace(s) {
  return s.replace(/\s+/g, " ");
}
function truncate(s) {
  return s.length > 100 ? "".concat(safeTruncate(s, 100), " [...]") : s;
}
function getElementById(refElement, id) {
  return refElement.ownerDocument ? refElement.ownerDocument.getElementById(id) : null;
}
function getTextualContent(element, userProgrammaticAttribute) {
  if (element.isContentEditable) {
    return;
  }
  if ("innerText" in element) {
    var text_1 = element.innerText;
    var removeTextFromElements = function(query) {
      var list = element.querySelectorAll(query);
      for (var index = 0; index < list.length; index += 1) {
        var element_1 = list[index];
        if ("innerText" in element_1) {
          var textToReplace = element_1.innerText;
          if (textToReplace && textToReplace.trim().length > 0) {
            text_1 = text_1.replace(textToReplace, "");
          }
        }
      }
    };
    if (!supportsInnerTextScriptAndStyleRemoval()) {
      removeTextFromElements("script, style");
    }
    removeTextFromElements("[".concat(DEFAULT_PROGRAMMATIC_ACTION_NAME_ATTRIBUTE, "]"));
    if (userProgrammaticAttribute) {
      removeTextFromElements("[".concat(userProgrammaticAttribute, "]"));
    }
    return text_1;
  }
  return element.textContent;
}
function supportsInnerTextScriptAndStyleRemoval() {
  return !isIE();
}
var supportsLabelPropertyResult;
function supportsLabelProperty() {
  if (supportsLabelPropertyResult === void 0) {
    supportsLabelPropertyResult = "labels" in HTMLInputElement.prototype;
  }
  return supportsLabelPropertyResult;
}
var supportsElementClosestResult;
function supportsElementClosest() {
  if (supportsElementClosestResult === void 0) {
    supportsElementClosestResult = "closest" in HTMLElement.prototype;
  }
  return supportsElementClosestResult;
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/action/getSelectorFromElement.js
var STABLE_ATTRIBUTES = [
  DEFAULT_PROGRAMMATIC_ACTION_NAME_ATTRIBUTE,
  // Common test attributes (list provided by google recorder)
  "data-testid",
  "data-test",
  "data-qa",
  "data-cy",
  "data-test-id",
  "data-qa-id",
  "data-testing",
  // FullStory decorator attributes:
  "data-component",
  "data-element",
  "data-source-file"
];
var GLOBALLY_UNIQUE_SELECTOR_GETTERS = [getStableAttributeSelector, getIDSelector];
var UNIQUE_AMONG_CHILDREN_SELECTOR_GETTERS = [
  getStableAttributeSelector,
  getClassSelector,
  getTagNameSelector
];
function getSelectorFromElement(targetElement, actionNameAttribute) {
  var targetElementSelector = "";
  var element = targetElement;
  while (element && element.nodeName !== "HTML") {
    var globallyUniqueSelector = findSelector(element, GLOBALLY_UNIQUE_SELECTOR_GETTERS, isSelectorUniqueGlobally, actionNameAttribute, targetElementSelector);
    if (globallyUniqueSelector) {
      return globallyUniqueSelector;
    }
    var uniqueSelectorAmongChildren = findSelector(element, UNIQUE_AMONG_CHILDREN_SELECTOR_GETTERS, isSelectorUniqueAmongSiblings, actionNameAttribute, targetElementSelector);
    targetElementSelector = uniqueSelectorAmongChildren || combineSelector(getPositionSelector(element), targetElementSelector);
    element = element.parentElement;
  }
  return targetElementSelector;
}
function isGeneratedValue(value) {
  return /[0-9]/.test(value);
}
function getIDSelector(element) {
  if (element.id && !isGeneratedValue(element.id)) {
    return "#".concat(cssEscape(element.id));
  }
}
function getClassSelector(element) {
  if (element.tagName === "BODY") {
    return;
  }
  if (element.classList.length > 0) {
    for (var i = 0; i < element.classList.length; i += 1) {
      var className = element.classList[i];
      if (isGeneratedValue(className)) {
        continue;
      }
      return "".concat(element.tagName, ".").concat(cssEscape(className));
    }
  }
}
function getTagNameSelector(element) {
  return element.tagName;
}
function getStableAttributeSelector(element, actionNameAttribute) {
  if (actionNameAttribute) {
    var selector = getAttributeSelector(actionNameAttribute);
    if (selector) {
      return selector;
    }
  }
  for (var _i = 0, STABLE_ATTRIBUTES_1 = STABLE_ATTRIBUTES; _i < STABLE_ATTRIBUTES_1.length; _i++) {
    var attributeName = STABLE_ATTRIBUTES_1[_i];
    var selector = getAttributeSelector(attributeName);
    if (selector) {
      return selector;
    }
  }
  function getAttributeSelector(attributeName2) {
    if (element.hasAttribute(attributeName2)) {
      return "".concat(element.tagName, "[").concat(attributeName2, '="').concat(cssEscape(element.getAttribute(attributeName2)), '"]');
    }
  }
}
function getPositionSelector(element) {
  var sibling = element.parentElement.firstElementChild;
  var elementIndex = 1;
  while (sibling && sibling !== element) {
    if (sibling.tagName === element.tagName) {
      elementIndex += 1;
    }
    sibling = sibling.nextElementSibling;
  }
  return "".concat(element.tagName, ":nth-of-type(").concat(elementIndex, ")");
}
function findSelector(element, selectorGetters, predicate, actionNameAttribute, childSelector) {
  for (var _i = 0, selectorGetters_1 = selectorGetters; _i < selectorGetters_1.length; _i++) {
    var selectorGetter = selectorGetters_1[_i];
    var elementSelector = selectorGetter(element, actionNameAttribute);
    if (!elementSelector) {
      continue;
    }
    var fullSelector = combineSelector(elementSelector, childSelector);
    if (predicate(element, fullSelector)) {
      return fullSelector;
    }
  }
}
function isSelectorUniqueGlobally(element, selector) {
  return element.ownerDocument.querySelectorAll(selector).length === 1;
}
function isSelectorUniqueAmongSiblings(element, selector) {
  return element.parentElement.querySelectorAll(supportScopeSelector() ? combineSelector(":scope", selector) : selector).length === 1;
}
function combineSelector(parent, child) {
  return child ? "".concat(parent, ">").concat(child) : parent;
}
var supportScopeSelectorCache;
function supportScopeSelector() {
  if (supportScopeSelectorCache === void 0) {
    try {
      document.querySelector(":scope");
      supportScopeSelectorCache = true;
    } catch (_a2) {
      supportScopeSelectorCache = false;
    }
  }
  return supportScopeSelectorCache;
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/action/listenActionEvents.js
function listenActionEvents(_a2) {
  var onPointerDown = _a2.onPointerDown, onPointerUp = _a2.onPointerUp;
  var selectionEmptyAtPointerDown;
  var userActivity = {
    selection: false,
    input: false
  };
  var clickContext;
  var listeners = [
    addEventListener(window, "pointerdown", function(event) {
      if (isValidPointerEvent(event)) {
        selectionEmptyAtPointerDown = isSelectionEmpty();
        userActivity = {
          selection: false,
          input: false
        };
        clickContext = onPointerDown(event);
      }
    }, { capture: true }),
    addEventListener(window, "selectionchange", function() {
      if (!selectionEmptyAtPointerDown || !isSelectionEmpty()) {
        userActivity.selection = true;
      }
    }, { capture: true }),
    addEventListener(window, "pointerup", function(event) {
      if (isValidPointerEvent(event) && clickContext) {
        var localUserActivity_1 = userActivity;
        onPointerUp(clickContext, event, function() {
          return localUserActivity_1;
        });
        clickContext = void 0;
      }
    }, { capture: true }),
    addEventListener(window, "input", function() {
      userActivity.input = true;
    }, { capture: true })
  ];
  return {
    stop: function() {
      listeners.forEach(function(listener) {
        return listener.stop();
      });
    }
  };
}
function isSelectionEmpty() {
  var selection = window.getSelection();
  return !selection || selection.isCollapsed;
}
function isValidPointerEvent(event) {
  return event.target instanceof Element && // Only consider 'primary' pointer events for now. Multi-touch support could be implemented in
  // the future.
  event.isPrimary !== false;
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/action/computeFrustration.js
var MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE = 3;
function computeFrustration(clicks, rageClick) {
  if (isRage(clicks)) {
    rageClick.addFrustration(
      "rage_click"
      /* FrustrationType.RAGE_CLICK */
    );
    if (clicks.some(isDead)) {
      rageClick.addFrustration(
        "dead_click"
        /* FrustrationType.DEAD_CLICK */
      );
    }
    if (rageClick.hasError) {
      rageClick.addFrustration(
        "error_click"
        /* FrustrationType.ERROR_CLICK */
      );
    }
    return { isRage: true };
  }
  var hasSelectionChanged = clicks.some(function(click) {
    return click.getUserActivity().selection;
  });
  clicks.forEach(function(click) {
    if (click.hasError) {
      click.addFrustration(
        "error_click"
        /* FrustrationType.ERROR_CLICK */
      );
    }
    if (isDead(click) && // Avoid considering clicks part of a double-click or triple-click selections as dead clicks
    !hasSelectionChanged) {
      click.addFrustration(
        "dead_click"
        /* FrustrationType.DEAD_CLICK */
      );
    }
  });
  return { isRage: false };
}
function isRage(clicks) {
  if (clicks.some(function(click) {
    return click.getUserActivity().selection;
  })) {
    return false;
  }
  for (var i = 0; i < clicks.length - (MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE - 1); i += 1) {
    if (clicks[i + MIN_CLICKS_PER_SECOND_TO_CONSIDER_RAGE - 1].event.timeStamp - clicks[i].event.timeStamp <= ONE_SECOND) {
      return true;
    }
  }
  return false;
}
var DEAD_CLICK_EXCLUDE_SELECTOR = (
  // inputs that don't trigger a meaningful event like "input" when clicked, including textual
  // inputs (using a negative selector is shorter here)
  'input:not([type="checkbox"]):not([type="radio"]):not([type="button"]):not([type="submit"]):not([type="reset"]):not([type="range"]),textarea,select,[contenteditable],[contenteditable] *,canvas,a[href],a[href] *'
);
function isDead(click) {
  if (click.hasPageActivity || click.getUserActivity().input) {
    return false;
  }
  return !elementMatches(click.event.target, DEAD_CLICK_EXCLUDE_SELECTOR);
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/action/trackClickActions.js
var CLICK_ACTION_MAX_DURATION = 10 * ONE_SECOND;
var ACTION_CONTEXT_TIME_OUT_DELAY = 5 * ONE_MINUTE;
function trackClickActions(lifeCycle, domMutationObservable, configuration) {
  var history2 = new ValueHistory(ACTION_CONTEXT_TIME_OUT_DELAY);
  var stopObservable = new Observable();
  var currentClickChain;
  lifeCycle.subscribe(8, function() {
    history2.reset();
  });
  lifeCycle.subscribe(4, stopClickChain);
  var stopActionEventsListener = listenActionEvents({
    onPointerDown: function(pointerDownEvent) {
      return processPointerDown(configuration, lifeCycle, domMutationObservable, history2, pointerDownEvent);
    },
    onPointerUp: function(_a2, startEvent, getUserActivity) {
      var clickActionBase = _a2.clickActionBase, hadActivityOnPointerDown = _a2.hadActivityOnPointerDown;
      return startClickAction(configuration, lifeCycle, domMutationObservable, history2, stopObservable, appendClickToClickChain, clickActionBase, startEvent, getUserActivity, hadActivityOnPointerDown);
    }
  }).stop;
  var actionContexts = {
    findActionId: function(startTime) {
      return configuration.trackFrustrations ? history2.findAll(startTime) : history2.find(startTime);
    }
  };
  return {
    stop: function() {
      stopClickChain();
      stopObservable.notify();
      stopActionEventsListener();
    },
    actionContexts
  };
  function appendClickToClickChain(click) {
    if (!currentClickChain || !currentClickChain.tryAppend(click)) {
      var rageClick_1 = click.clone();
      currentClickChain = createClickChain(click, function(clicks) {
        finalizeClicks(clicks, rageClick_1);
      });
    }
  }
  function stopClickChain() {
    if (currentClickChain) {
      currentClickChain.stop();
    }
  }
}
function processPointerDown(configuration, lifeCycle, domMutationObservable, history2, pointerDownEvent) {
  if (!configuration.trackFrustrations && history2.find()) {
    return;
  }
  var clickActionBase = computeClickActionBase(pointerDownEvent, configuration.actionNameAttribute);
  if (!configuration.trackFrustrations && !clickActionBase.name) {
    return;
  }
  var hadActivityOnPointerDown = false;
  waitPageActivityEnd(
    lifeCycle,
    domMutationObservable,
    configuration,
    function(pageActivityEndEvent) {
      hadActivityOnPointerDown = pageActivityEndEvent.hadActivity;
    },
    // We don't care about the activity duration, we just want to know whether an activity did happen
    // within the "validation delay" or not. Limit the duration so the callback is called sooner.
    PAGE_ACTIVITY_VALIDATION_DELAY
  );
  return { clickActionBase, hadActivityOnPointerDown: function() {
    return hadActivityOnPointerDown;
  } };
}
function startClickAction(configuration, lifeCycle, domMutationObservable, history2, stopObservable, appendClickToClickChain, clickActionBase, startEvent, getUserActivity, hadActivityOnPointerDown) {
  var click = newClick(lifeCycle, history2, getUserActivity, clickActionBase, startEvent);
  if (configuration.trackFrustrations) {
    appendClickToClickChain(click);
  }
  var stopWaitPageActivityEnd = waitPageActivityEnd(lifeCycle, domMutationObservable, configuration, function(pageActivityEndEvent) {
    if (pageActivityEndEvent.hadActivity && pageActivityEndEvent.end < click.startClocks.timeStamp) {
      click.discard();
    } else {
      if (pageActivityEndEvent.hadActivity) {
        click.stop(pageActivityEndEvent.end);
      } else if (hadActivityOnPointerDown()) {
        click.stop(
          // using the click start as activity end, so the click will have some activity but its
          // duration will be 0 (as the activity started before the click start)
          click.startClocks.timeStamp
        );
      } else {
        click.stop();
      }
      if (!configuration.trackFrustrations) {
        if (!pageActivityEndEvent.hadActivity) {
          click.discard();
        } else {
          click.validate();
        }
      }
    }
  }, CLICK_ACTION_MAX_DURATION).stop;
  var viewEndedSubscription = lifeCycle.subscribe(4, function(_a2) {
    var endClocks = _a2.endClocks;
    click.stop(endClocks.timeStamp);
  });
  var stopSubscription = stopObservable.subscribe(function() {
    click.stop();
  });
  click.stopObservable.subscribe(function() {
    viewEndedSubscription.unsubscribe();
    stopWaitPageActivityEnd();
    stopSubscription.unsubscribe();
  });
}
function computeClickActionBase(event, actionNameAttribute) {
  var rect = event.target.getBoundingClientRect();
  return {
    type: "click",
    target: {
      width: Math.round(rect.width),
      height: Math.round(rect.height),
      selector: getSelectorFromElement(event.target, actionNameAttribute)
    },
    position: {
      // Use clientX and Y because for SVG element offsetX and Y are relatives to the <svg> element
      x: Math.round(event.clientX - rect.left),
      y: Math.round(event.clientY - rect.top)
    },
    name: getActionNameFromElement(event.target, actionNameAttribute)
  };
}
function newClick(lifeCycle, history2, getUserActivity, clickActionBase, startEvent) {
  var id = generateUUID();
  var startClocks = clocksNow();
  var historyEntry = history2.add(id, startClocks.relative);
  var eventCountsSubscription = trackEventCounts({
    lifeCycle,
    isChildEvent: function(event) {
      return event.action !== void 0 && (Array.isArray(event.action.id) ? includes(event.action.id, id) : event.action.id === id);
    }
  });
  var status = 0;
  var activityEndTime;
  var frustrationTypes = [];
  var stopObservable = new Observable();
  function stop(newActivityEndTime) {
    if (status !== 0) {
      return;
    }
    activityEndTime = newActivityEndTime;
    status = 1;
    if (activityEndTime) {
      historyEntry.close(getRelativeTime(activityEndTime));
    } else {
      historyEntry.remove();
    }
    eventCountsSubscription.stop();
    stopObservable.notify();
  }
  return {
    event: startEvent,
    stop,
    stopObservable,
    get hasError() {
      return eventCountsSubscription.eventCounts.errorCount > 0;
    },
    get hasPageActivity() {
      return activityEndTime !== void 0;
    },
    getUserActivity,
    addFrustration: function(frustrationType) {
      frustrationTypes.push(frustrationType);
    },
    startClocks,
    isStopped: function() {
      return status === 1 || status === 2;
    },
    clone: function() {
      return newClick(lifeCycle, history2, getUserActivity, clickActionBase, startEvent);
    },
    validate: function(domEvents) {
      stop();
      if (status !== 1) {
        return;
      }
      var _a2 = eventCountsSubscription.eventCounts, resourceCount = _a2.resourceCount, errorCount = _a2.errorCount, longTaskCount = _a2.longTaskCount;
      var clickAction = assign({
        type: "click",
        duration: activityEndTime && elapsed(startClocks.timeStamp, activityEndTime),
        startClocks,
        id,
        frustrationTypes,
        counts: {
          resourceCount,
          errorCount,
          longTaskCount
        },
        events: domEvents !== null && domEvents !== void 0 ? domEvents : [startEvent],
        event: startEvent
      }, clickActionBase);
      lifeCycle.notify(1, clickAction);
      status = 2;
    },
    discard: function() {
      stop();
      status = 2;
    }
  };
}
function finalizeClicks(clicks, rageClick) {
  var isRage2 = computeFrustration(clicks, rageClick).isRage;
  if (isRage2) {
    clicks.forEach(function(click) {
      return click.discard();
    });
    rageClick.stop(timeStampNow());
    rageClick.validate(clicks.map(function(click) {
      return click.event;
    }));
  } else {
    rageClick.discard();
    clicks.forEach(function(click) {
      return click.validate();
    });
  }
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/action/actionCollection.js
function startActionCollection(lifeCycle, domMutationObservable, configuration, pageStateHistory) {
  lifeCycle.subscribe(1, function(action) {
    return lifeCycle.notify(10, processAction(action, pageStateHistory));
  });
  var actionContexts = { findActionId: noop };
  if (configuration.trackUserInteractions) {
    actionContexts = trackClickActions(lifeCycle, domMutationObservable, configuration).actionContexts;
  }
  return {
    addAction: function(action, savedCommonContext) {
      lifeCycle.notify(10, assign({
        savedCommonContext
      }, processAction(action, pageStateHistory)));
    },
    actionContexts
  };
}
function processAction(action, pageStateHistory) {
  var autoActionProperties = isAutoAction(action) ? {
    action: {
      id: action.id,
      loading_time: toServerDuration(action.duration),
      frustration: {
        type: action.frustrationTypes
      },
      error: {
        count: action.counts.errorCount
      },
      long_task: {
        count: action.counts.longTaskCount
      },
      resource: {
        count: action.counts.resourceCount
      }
    },
    _dd: {
      action: {
        target: action.target,
        position: action.position
      }
    }
  } : void 0;
  var customerContext = !isAutoAction(action) ? action.context : void 0;
  var actionEvent = combine({
    action: {
      id: generateUUID(),
      target: {
        name: action.name
      },
      type: action.type
    },
    date: action.startClocks.timeStamp,
    type: "action",
    view: { in_foreground: pageStateHistory.isInActivePageStateAt(action.startClocks.relative) }
  }, autoActionProperties);
  return {
    customerContext,
    rawRumEvent: actionEvent,
    startTime: action.startClocks.relative,
    domainContext: isAutoAction(action) ? { event: action.event, events: action.events } : {}
  };
}
function isAutoAction(action) {
  return action.type !== "custom";
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/error/trackConsoleError.js
function trackConsoleError(errorObservable) {
  var subscription = initConsoleObservable([ConsoleApiName.error]).subscribe(function(consoleError) {
    return errorObservable.notify({
      startClocks: clocksNow(),
      message: consoleError.message,
      stack: consoleError.stack,
      fingerprint: consoleError.fingerprint,
      source: ErrorSource.CONSOLE,
      handling: "handled",
      handlingStack: consoleError.handlingStack
    });
  });
  return {
    stop: function() {
      subscription.unsubscribe();
    }
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/error/trackReportError.js
function trackReportError(errorObservable) {
  var subscription = initReportObservable([RawReportType.cspViolation, RawReportType.intervention]).subscribe(function(reportError) {
    return errorObservable.notify({
      startClocks: clocksNow(),
      message: reportError.message,
      stack: reportError.stack,
      type: reportError.subtype,
      source: ErrorSource.REPORT,
      handling: "unhandled"
    });
  });
  return {
    stop: function() {
      subscription.unsubscribe();
    }
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/error/errorCollection.js
function startErrorCollection(lifeCycle, pageStateHistory, featureFlagContexts) {
  var errorObservable = new Observable();
  trackConsoleError(errorObservable);
  trackRuntimeError(errorObservable);
  trackReportError(errorObservable);
  errorObservable.subscribe(function(error) {
    return lifeCycle.notify(12, { error });
  });
  return doStartErrorCollection(lifeCycle, pageStateHistory, featureFlagContexts);
}
function doStartErrorCollection(lifeCycle, pageStateHistory, featureFlagContexts) {
  lifeCycle.subscribe(12, function(_a2) {
    var error = _a2.error, customerContext = _a2.customerContext, savedCommonContext = _a2.savedCommonContext;
    lifeCycle.notify(10, assign({
      customerContext,
      savedCommonContext
    }, processError(error, pageStateHistory, featureFlagContexts)));
  });
  return {
    addError: function(_a2, savedCommonContext) {
      var error = _a2.error, handlingStack = _a2.handlingStack, startClocks = _a2.startClocks, customerContext = _a2.context;
      var stackTrace = error instanceof Error ? computeStackTrace(error) : void 0;
      var rawError = computeRawError({
        stackTrace,
        originalError: error,
        handlingStack,
        startClocks,
        nonErrorPrefix: "Provided",
        source: ErrorSource.CUSTOM,
        handling: "handled"
      });
      lifeCycle.notify(12, {
        customerContext,
        savedCommonContext,
        error: rawError
      });
    }
  };
}
function processError(error, pageStateHistory, featureFlagContexts) {
  var rawRumEvent = {
    date: error.startClocks.timeStamp,
    error: {
      id: generateUUID(),
      message: error.message,
      source: error.source,
      stack: error.stack,
      handling_stack: error.handlingStack,
      type: error.type,
      handling: error.handling,
      causes: error.causes,
      source_type: "browser",
      fingerprint: error.fingerprint
    },
    type: "error",
    view: { in_foreground: pageStateHistory.isInActivePageStateAt(error.startClocks.relative) }
  };
  var featureFlagContext = featureFlagContexts.findFeatureFlagEvaluations(error.startClocks.relative);
  if (featureFlagContext && !isEmptyObject(featureFlagContext)) {
    rawRumEvent.feature_flags = featureFlagContext;
  }
  return {
    rawRumEvent,
    startTime: error.startClocks.relative,
    domainContext: {
      error: error.originalError
    }
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/longTask/longTaskCollection.js
function startLongTaskCollection(lifeCycle, sessionManager) {
  lifeCycle.subscribe(0, function(entries) {
    for (var _i = 0, entries_1 = entries; _i < entries_1.length; _i++) {
      var entry = entries_1[_i];
      if (entry.entryType !== "longtask") {
        break;
      }
      var session = sessionManager.findTrackedSession(entry.startTime);
      if (!session || !session.longTaskAllowed) {
        break;
      }
      var startClocks = relativeToClocks(entry.startTime);
      var rawRumEvent = {
        date: startClocks.timeStamp,
        long_task: {
          id: generateUUID(),
          duration: toServerDuration(entry.duration)
        },
        type: "long_task",
        _dd: {
          discarded: false
        }
      };
      lifeCycle.notify(10, {
        rawRumEvent,
        startTime: startClocks.relative,
        domainContext: { performanceEntry: entry.toJSON() }
      });
    }
  });
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/resource/matchRequestTiming.js
function matchRequestTiming(request) {
  if (!performance || !("getEntriesByName" in performance)) {
    return;
  }
  var sameNameEntries = performance.getEntriesByName(request.url, "resource");
  if (!sameNameEntries.length || !("toJSON" in sameNameEntries[0])) {
    return;
  }
  var candidates = sameNameEntries.map(function(entry) {
    return entry.toJSON();
  }).filter(toValidEntry).filter(function(entry) {
    return isBetween(entry, request.startClocks.relative, endTime({ startTime: request.startClocks.relative, duration: request.duration }));
  });
  if (candidates.length === 1) {
    return candidates[0];
  }
  return;
}
function endTime(timing) {
  return addDuration(timing.startTime, timing.duration);
}
function isBetween(timing, start, end) {
  var errorMargin = 1;
  return timing.startTime >= start - errorMargin && endTime(timing) <= addDuration(end, errorMargin);
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/resource/resourceCollection.js
function startResourceCollection(lifeCycle, configuration, sessionManager, pageStateHistory) {
  lifeCycle.subscribe(6, function(request) {
    lifeCycle.notify(10, processRequest(request, configuration, sessionManager, pageStateHistory));
  });
  lifeCycle.subscribe(0, function(entries) {
    for (var _i = 0, entries_1 = entries; _i < entries_1.length; _i++) {
      var entry = entries_1[_i];
      if (entry.entryType === "resource" && !isRequestKind(entry)) {
        lifeCycle.notify(10, processResourceEntry(entry, configuration, sessionManager, pageStateHistory));
      }
    }
  });
}
function processRequest(request, configuration, sessionManager, pageStateHistory) {
  var _a2;
  var type = request.type === "xhr" ? "xhr" : "fetch";
  var matchingTiming = matchRequestTiming(request);
  var startClocks = matchingTiming ? relativeToClocks(matchingTiming.startTime) : request.startClocks;
  var correspondingTimingOverrides = matchingTiming ? computePerformanceEntryMetrics(matchingTiming) : void 0;
  var tracingInfo = computeRequestTracingInfo(request, configuration);
  var indexingInfo = computeIndexingInfo(sessionManager, startClocks);
  var duration = computeRequestDuration(pageStateHistory, startClocks, request.duration);
  var pageStateInfo = computePageStateInfo(pageStateHistory, startClocks, (_a2 = matchingTiming === null || matchingTiming === void 0 ? void 0 : matchingTiming.duration) !== null && _a2 !== void 0 ? _a2 : request.duration);
  var resourceEvent = combine({
    date: startClocks.timeStamp,
    resource: {
      id: generateUUID(),
      type,
      duration,
      method: request.method,
      status_code: request.status,
      url: request.url
    },
    type: "resource"
  }, tracingInfo, correspondingTimingOverrides, indexingInfo, pageStateInfo);
  return {
    startTime: startClocks.relative,
    rawRumEvent: resourceEvent,
    domainContext: {
      performanceEntry: matchingTiming && toPerformanceEntryRepresentation(matchingTiming),
      xhr: request.xhr,
      response: request.response,
      requestInput: request.input,
      requestInit: request.init,
      error: request.error
    }
  };
}
function processResourceEntry(entry, configuration, sessionManager, pageStateHistory) {
  var type = computeResourceKind(entry);
  var entryMetrics = computePerformanceEntryMetrics(entry);
  var startClocks = relativeToClocks(entry.startTime);
  var tracingInfo = computeEntryTracingInfo(entry, configuration);
  var indexingInfo = computeIndexingInfo(sessionManager, startClocks);
  var pageStateInfo = computePageStateInfo(pageStateHistory, startClocks, entry.duration);
  var resourceEvent = combine({
    date: startClocks.timeStamp,
    resource: {
      id: generateUUID(),
      type,
      url: entry.name
    },
    type: "resource"
  }, tracingInfo, entryMetrics, indexingInfo, pageStateInfo);
  return {
    startTime: startClocks.relative,
    rawRumEvent: resourceEvent,
    domainContext: {
      performanceEntry: toPerformanceEntryRepresentation(entry)
    }
  };
}
function computePerformanceEntryMetrics(timing) {
  return {
    resource: assign({
      duration: computePerformanceResourceDuration(timing),
      size: computeSize(timing)
    }, computePerformanceResourceDetails(timing))
  };
}
function computeRequestTracingInfo(request, configuration) {
  var hasBeenTraced = request.traceSampled && request.traceId && request.spanId;
  if (!hasBeenTraced) {
    return void 0;
  }
  return {
    _dd: {
      span_id: request.spanId.toDecimalString(),
      trace_id: request.traceId.toDecimalString(),
      rule_psr: getRulePsr(configuration)
    }
  };
}
function computeEntryTracingInfo(entry, configuration) {
  var hasBeenTraced = entry.traceId;
  if (!hasBeenTraced) {
    return void 0;
  }
  return {
    _dd: {
      trace_id: entry.traceId,
      rule_psr: getRulePsr(configuration)
    }
  };
}
function toPerformanceEntryRepresentation(entry) {
  return entry;
}
function getRulePsr(configuration) {
  return isNumber(configuration.traceSampleRate) ? configuration.traceSampleRate / 100 : void 0;
}
function computeIndexingInfo(sessionManager, resourceStart) {
  var session = sessionManager.findTrackedSession(resourceStart.relative);
  return {
    _dd: {
      discarded: !session || !session.resourceAllowed
    }
  };
}
function computePageStateInfo(pageStateHistory, startClocks, duration) {
  if (!isExperimentalFeatureEnabled(ExperimentalFeature.RESOURCE_PAGE_STATES)) {
    return;
  }
  return {
    _dd: {
      page_states: pageStateHistory.findAll(startClocks.relative, duration),
      page_was_discarded: String(document.wasDiscarded)
    }
  };
}
function computeRequestDuration(pageStateHistory, startClocks, duration) {
  var _a2;
  if (!isExperimentalFeatureEnabled(ExperimentalFeature.NO_RESOURCE_DURATION_FROZEN_STATE)) {
    return toServerDuration(duration);
  }
  var requestCrossedFrozenState = (_a2 = pageStateHistory.findAll(startClocks.relative, duration)) === null || _a2 === void 0 ? void 0 : _a2.some(function(pageState) {
    return pageState.state === "frozen";
  });
  return !requestCrossedFrozenState ? toServerDuration(duration) : void 0;
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/contexts/foregroundContexts.js
function mapToForegroundPeriods(pageStateServerEntries, duration) {
  var foregroundPeriods = [];
  for (var i = 0; i < pageStateServerEntries.length; i++) {
    var current = pageStateServerEntries[i];
    var next = pageStateServerEntries[i + 1];
    if (current.state === "active") {
      var start = current.start >= 0 ? current.start : 0;
      var end = next ? next.start : toServerDuration(duration);
      foregroundPeriods.push({
        start,
        duration: end - start
      });
    }
  }
  return foregroundPeriods;
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/view/trackFirstHidden.js
var trackFirstHiddenSingleton;
var stopListeners2;
function trackFirstHidden(eventTarget) {
  if (eventTarget === void 0) {
    eventTarget = window;
  }
  if (!trackFirstHiddenSingleton) {
    if (document.visibilityState === "hidden") {
      trackFirstHiddenSingleton = {
        timeStamp: 0
      };
    } else {
      trackFirstHiddenSingleton = {
        timeStamp: Infinity
      };
      stopListeners2 = addEventListeners(eventTarget, [
        "pagehide",
        "visibilitychange"
        /* DOM_EVENT.VISIBILITY_CHANGE */
      ], function(event) {
        if (event.type === "pagehide" || document.visibilityState === "hidden") {
          trackFirstHiddenSingleton.timeStamp = event.timeStamp;
          stopListeners2();
        }
      }, { capture: true }).stop;
    }
  }
  return trackFirstHiddenSingleton;
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/view/trackInitialViewTimings.js
var TIMING_MAXIMUM_DELAY = 10 * ONE_MINUTE;
var KEEP_TRACKING_TIMINGS_AFTER_VIEW_DELAY = 5 * ONE_MINUTE;
function trackInitialViewTimings(lifeCycle, webVitalTelemetryDebug, setLoadEvent, scheduleViewUpdate) {
  var timings = {};
  function setTimings(newTimings) {
    assign(timings, newTimings);
    scheduleViewUpdate();
  }
  var stopNavigationTracking = trackNavigationTimings(lifeCycle, function(newTimings) {
    setLoadEvent(newTimings.loadEvent);
    setTimings(newTimings);
  }).stop;
  var stopFCPTracking = trackFirstContentfulPaintTiming(lifeCycle, function(firstContentfulPaint) {
    return setTimings({ firstContentfulPaint });
  }).stop;
  var stopLCPTracking = trackLargestContentfulPaintTiming(lifeCycle, window, function(largestContentfulPaint, lcpElement) {
    webVitalTelemetryDebug.addWebVitalTelemetryDebug("LCP", lcpElement, largestContentfulPaint);
    setTimings({
      largestContentfulPaint
    });
  }).stop;
  var stopFIDTracking = trackFirstInputTimings(lifeCycle, function(_a2) {
    var firstInputDelay = _a2.firstInputDelay, firstInputTime = _a2.firstInputTime, firstInputTarget = _a2.firstInputTarget;
    webVitalTelemetryDebug.addWebVitalTelemetryDebug("FID", firstInputTarget, firstInputTime);
    setTimings({
      firstInputDelay,
      firstInputTime
    });
  }).stop;
  function stop() {
    stopNavigationTracking();
    stopFCPTracking();
    stopLCPTracking();
    stopFIDTracking();
  }
  return {
    stop,
    timings,
    scheduleStop: function() {
      setTimeout(stop, KEEP_TRACKING_TIMINGS_AFTER_VIEW_DELAY);
    }
  };
}
function trackNavigationTimings(lifeCycle, callback) {
  var stop = lifeCycle.subscribe(0, function(entries) {
    for (var _i = 0, entries_1 = entries; _i < entries_1.length; _i++) {
      var entry = entries_1[_i];
      if (entry.entryType === "navigation") {
        callback({
          domComplete: entry.domComplete,
          domContentLoaded: entry.domContentLoadedEventEnd,
          domInteractive: entry.domInteractive,
          loadEvent: entry.loadEventEnd,
          // In some cases the value reported is negative or is larger
          // than the current page time. Ignore these cases:
          // https://github.com/GoogleChrome/web-vitals/issues/137
          // https://github.com/GoogleChrome/web-vitals/issues/162
          firstByte: entry.responseStart >= 0 && entry.responseStart <= relativeNow() ? entry.responseStart : void 0
        });
      }
    }
  }).unsubscribe;
  return { stop };
}
function trackFirstContentfulPaintTiming(lifeCycle, callback) {
  var firstHidden = trackFirstHidden();
  var stop = lifeCycle.subscribe(0, function(entries) {
    var fcpEntry = find(entries, function(entry) {
      return entry.entryType === "paint" && entry.name === "first-contentful-paint" && entry.startTime < firstHidden.timeStamp && entry.startTime < TIMING_MAXIMUM_DELAY;
    });
    if (fcpEntry) {
      callback(fcpEntry.startTime);
    }
  }).unsubscribe;
  return { stop };
}
function trackLargestContentfulPaintTiming(lifeCycle, eventTarget, callback) {
  var firstHidden = trackFirstHidden();
  var firstInteractionTimestamp = Infinity;
  var stopEventListener = addEventListeners(eventTarget, [
    "pointerdown",
    "keydown"
    /* DOM_EVENT.KEY_DOWN */
  ], function(event) {
    firstInteractionTimestamp = event.timeStamp;
  }, { capture: true, once: true }).stop;
  var unsubscribeLifeCycle = lifeCycle.subscribe(0, function(entries) {
    var lcpEntry = findLast(entries, function(entry) {
      return entry.entryType === "largest-contentful-paint" && entry.startTime < firstInteractionTimestamp && entry.startTime < firstHidden.timeStamp && entry.startTime < TIMING_MAXIMUM_DELAY;
    });
    if (lcpEntry) {
      callback(lcpEntry.startTime, lcpEntry.element);
    }
  }).unsubscribe;
  return {
    stop: function() {
      stopEventListener();
      unsubscribeLifeCycle();
    }
  };
}
function trackFirstInputTimings(lifeCycle, callback) {
  var firstHidden = trackFirstHidden();
  var stop = lifeCycle.subscribe(0, function(entries) {
    var firstInputEntry = find(entries, function(entry) {
      return entry.entryType === "first-input" && entry.startTime < firstHidden.timeStamp;
    });
    if (firstInputEntry) {
      var firstInputDelay = elapsed(firstInputEntry.startTime, firstInputEntry.processingStart);
      callback({
        // Ensure firstInputDelay to be positive, see
        // https://bugs.chromium.org/p/chromium/issues/detail?id=1185815
        firstInputDelay: firstInputDelay >= 0 ? firstInputDelay : 0,
        firstInputTime: firstInputEntry.startTime,
        firstInputTarget: firstInputEntry.target
      });
    }
  }).unsubscribe;
  return {
    stop
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/browser/scroll.js
function getScrollX() {
  var scrollX;
  var visual = window.visualViewport;
  if (visual) {
    scrollX = visual.pageLeft - visual.offsetLeft;
  } else if (window.scrollX !== void 0) {
    scrollX = window.scrollX;
  } else {
    scrollX = window.pageXOffset || 0;
  }
  return Math.round(scrollX);
}
function getScrollY() {
  var scrollY;
  var visual = window.visualViewport;
  if (visual) {
    scrollY = visual.pageTop - visual.offsetTop;
  } else if (window.scrollY !== void 0) {
    scrollY = window.scrollY;
  } else {
    scrollY = window.pageYOffset || 0;
  }
  return Math.round(scrollY);
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/view/trackViewMetrics.js
var THROTTLE_SCROLL_DURATION = ONE_SECOND;
function trackViewMetrics(lifeCycle, domMutationObservable, configuration, scheduleViewUpdate, loadingType, viewStart, webVitalTelemetryDebug) {
  var viewMetrics = {};
  var scrollMetrics;
  var _a2 = trackLoadingTime(lifeCycle, domMutationObservable, configuration, loadingType, viewStart, function(newLoadingTime) {
    viewMetrics.loadingTime = newLoadingTime;
    if (isExperimentalFeatureEnabled(ExperimentalFeature.SCROLLMAP)) {
      var _a3 = computeScrollValues(), scrollHeight = _a3.scrollHeight, scrollDepth = _a3.scrollDepth, scrollTop = _a3.scrollTop;
      scrollMetrics = {
        maxDepth: scrollDepth,
        maxDepthScrollHeight: scrollHeight,
        maxDepthTime: newLoadingTime,
        maxDepthScrollTop: scrollTop
      };
    }
    scheduleViewUpdate();
  }), stopLoadingTimeTracking = _a2.stop, setLoadEvent = _a2.setLoadEvent;
  var stopScrollMetricsTracking = trackScrollMetrics(viewStart, function(newScrollMetrics) {
    scrollMetrics = newScrollMetrics;
  }, computeScrollValues).stop;
  var stopCLSTracking;
  var clsAttributionCollected = false;
  if (isLayoutShiftSupported()) {
    viewMetrics.cumulativeLayoutShift = 0;
    stopCLSTracking = trackCumulativeLayoutShift(lifeCycle, function(cumulativeLayoutShift, largestLayoutShiftNode, largestLayoutShiftTime) {
      viewMetrics.cumulativeLayoutShift = cumulativeLayoutShift;
      if (!clsAttributionCollected) {
        clsAttributionCollected = true;
        webVitalTelemetryDebug.addWebVitalTelemetryDebug("CLS", largestLayoutShiftNode, largestLayoutShiftTime);
      }
      scheduleViewUpdate();
    }).stop;
  } else {
    stopCLSTracking = noop;
  }
  return {
    stop: function() {
      stopLoadingTimeTracking();
      stopCLSTracking();
      stopScrollMetricsTracking();
    },
    setLoadEvent,
    viewMetrics,
    getScrollMetrics: function() {
      return scrollMetrics;
    }
  };
}
function trackScrollMetrics(viewStart, callback, getScrollValues) {
  if (getScrollValues === void 0) {
    getScrollValues = computeScrollValues;
  }
  if (!isExperimentalFeatureEnabled(ExperimentalFeature.SCROLLMAP)) {
    return { stop: noop };
  }
  var maxDepth = 0;
  var handleScrollEvent = throttle(function() {
    var _a2 = getScrollValues(), scrollHeight = _a2.scrollHeight, scrollDepth = _a2.scrollDepth, scrollTop = _a2.scrollTop;
    if (scrollDepth > maxDepth) {
      var now = relativeNow();
      var maxDepthTime = elapsed(viewStart.relative, now);
      maxDepth = scrollDepth;
      callback({
        maxDepth,
        maxDepthScrollHeight: scrollHeight,
        maxDepthTime,
        maxDepthScrollTop: scrollTop
      });
    }
  }, THROTTLE_SCROLL_DURATION, { leading: false, trailing: true });
  var stop = addEventListener(window, "scroll", handleScrollEvent.throttled, { passive: true }).stop;
  return {
    stop: function() {
      handleScrollEvent.cancel();
      stop();
    }
  };
}
function computeScrollValues() {
  var scrollTop = getScrollY();
  var height = getViewportDimension().height;
  var scrollHeight = Math.round((document.scrollingElement || document.documentElement).scrollHeight);
  var scrollDepth = Math.round(height + scrollTop);
  return {
    scrollHeight,
    scrollDepth,
    scrollTop
  };
}
function trackLoadingTime(lifeCycle, domMutationObservable, configuration, loadType, viewStart, callback) {
  var isWaitingForLoadEvent = loadType === "initial_load";
  var isWaitingForActivityLoadingTime = true;
  var loadingTimeCandidates = [];
  function invokeCallbackIfAllCandidatesAreReceived() {
    if (!isWaitingForActivityLoadingTime && !isWaitingForLoadEvent && loadingTimeCandidates.length > 0) {
      callback(Math.max.apply(Math, loadingTimeCandidates));
    }
  }
  var stop = waitPageActivityEnd(lifeCycle, domMutationObservable, configuration, function(event) {
    if (isWaitingForActivityLoadingTime) {
      isWaitingForActivityLoadingTime = false;
      if (event.hadActivity) {
        loadingTimeCandidates.push(elapsed(viewStart.timeStamp, event.end));
      }
      invokeCallbackIfAllCandidatesAreReceived();
    }
  }).stop;
  return {
    stop,
    setLoadEvent: function(loadEvent) {
      if (isWaitingForLoadEvent) {
        isWaitingForLoadEvent = false;
        loadingTimeCandidates.push(loadEvent);
        invokeCallbackIfAllCandidatesAreReceived();
      }
    }
  };
}
function trackCumulativeLayoutShift(lifeCycle, callback) {
  var maxClsValue = 0;
  var window2 = slidingSessionWindow();
  var stop = lifeCycle.subscribe(0, function(entries) {
    for (var _i = 0, entries_1 = entries; _i < entries_1.length; _i++) {
      var entry = entries_1[_i];
      if (entry.entryType === "layout-shift" && !entry.hadRecentInput) {
        window2.update(entry);
        if (window2.value() > maxClsValue) {
          maxClsValue = window2.value();
          callback(round(maxClsValue, 4), window2.largestLayoutShiftNode(), window2.largestLayoutShiftTime());
        }
      }
    }
  }).unsubscribe;
  return {
    stop
  };
}
function slidingSessionWindow() {
  var value = 0;
  var startTime;
  var endTime2;
  var largestLayoutShift = 0;
  var largestLayoutShiftNode;
  var largestLayoutShiftTime;
  return {
    update: function(entry) {
      var _a2;
      var shouldCreateNewWindow = startTime === void 0 || entry.startTime - endTime2 >= ONE_SECOND || entry.startTime - startTime >= 5 * ONE_SECOND;
      if (shouldCreateNewWindow) {
        startTime = endTime2 = entry.startTime;
        value = entry.value;
        largestLayoutShift = 0;
        largestLayoutShiftNode = void 0;
      } else {
        value += entry.value;
        endTime2 = entry.startTime;
      }
      if (entry.value > largestLayoutShift) {
        largestLayoutShift = entry.value;
        largestLayoutShiftTime = entry.startTime;
        if ((_a2 = entry.sources) === null || _a2 === void 0 ? void 0 : _a2.length) {
          var largestLayoutShiftSource = find(entry.sources, function(s) {
            var _a3;
            return ((_a3 = s.node) === null || _a3 === void 0 ? void 0 : _a3.nodeType) === 1;
          }) || entry.sources[0];
          largestLayoutShiftNode = largestLayoutShiftSource.node;
        } else {
          largestLayoutShiftNode = void 0;
        }
      }
    },
    value: function() {
      return value;
    },
    largestLayoutShiftNode: function() {
      return largestLayoutShiftNode;
    },
    largestLayoutShiftTime: function() {
      return largestLayoutShiftTime;
    }
  };
}
function isLayoutShiftSupported() {
  return supportPerformanceTimingEvent("layout-shift");
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/view/trackViewEventCounts.js
var KEEP_TRACKING_EVENT_COUNTS_AFTER_VIEW_DELAY = 5 * ONE_MINUTE;
function trackViewEventCounts(lifeCycle, viewId, onChange) {
  var _a2 = trackEventCounts({
    lifeCycle,
    isChildEvent: function(event) {
      return event.view.id === viewId;
    },
    onChange
  }), stop = _a2.stop, eventCounts = _a2.eventCounts;
  return {
    scheduleStop: function() {
      setTimeout(stop, KEEP_TRACKING_EVENT_COUNTS_AFTER_VIEW_DELAY);
    },
    eventCounts
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/view/trackViews.js
var THROTTLE_VIEW_UPDATE_PERIOD = 3e3;
var SESSION_KEEP_ALIVE_INTERVAL = 5 * ONE_MINUTE;
function trackViews(location2, lifeCycle, domMutationObservable, configuration, locationChangeObservable, areViewsTrackedAutomatically, webVitalTelemetryDebug, initialViewOptions) {
  var currentView = startNewView("initial_load", clocksOrigin(), initialViewOptions);
  startViewLifeCycle();
  var locationChangeSubscription;
  if (areViewsTrackedAutomatically) {
    locationChangeSubscription = renewViewOnLocationChange(locationChangeObservable);
  }
  function startNewView(loadingType, startClocks, viewOptions) {
    return newView(lifeCycle, domMutationObservable, configuration, location2, loadingType, webVitalTelemetryDebug, startClocks, viewOptions);
  }
  function startViewLifeCycle() {
    lifeCycle.subscribe(8, function() {
      currentView = startNewView("route_change", void 0, {
        name: currentView.name,
        service: currentView.service,
        version: currentView.version
      });
    });
    lifeCycle.subscribe(7, function() {
      currentView.end({ sessionIsActive: false });
    });
    lifeCycle.subscribe(9, function(pageExitEvent) {
      if (pageExitEvent.reason === PageExitReason.UNLOADING || pageExitEvent.reason === PageExitReason.PAGEHIDE) {
        currentView.end();
      }
    });
  }
  function renewViewOnLocationChange(locationChangeObservable2) {
    return locationChangeObservable2.subscribe(function(_a2) {
      var oldLocation = _a2.oldLocation, newLocation = _a2.newLocation;
      if (areDifferentLocation(oldLocation, newLocation)) {
        currentView.end();
        currentView = startNewView(
          "route_change"
          /* ViewLoadingType.ROUTE_CHANGE */
        );
      }
    });
  }
  return {
    addTiming: function(name, time) {
      if (time === void 0) {
        time = timeStampNow();
      }
      currentView.addTiming(name, time);
    },
    startView: function(options, startClocks) {
      currentView.end({ endClocks: startClocks });
      currentView = startNewView("route_change", startClocks, options);
    },
    stop: function() {
      locationChangeSubscription === null || locationChangeSubscription === void 0 ? void 0 : locationChangeSubscription.unsubscribe();
      currentView.end();
    }
  };
}
function newView(lifeCycle, domMutationObservable, configuration, initialLocation, loadingType, webVitalTelemetryDebug, startClocks, viewOptions) {
  if (startClocks === void 0) {
    startClocks = clocksNow();
  }
  var id = generateUUID();
  var customTimings = {};
  var documentVersion = 0;
  var endClocks;
  var location2 = shallowClone(initialLocation);
  var sessionIsActive = true;
  var name;
  var service;
  var version;
  if (viewOptions) {
    name = viewOptions.name;
    service = viewOptions.service;
    version = viewOptions.version;
  }
  lifeCycle.notify(2, {
    id,
    name,
    startClocks,
    service,
    version
  });
  var _a2 = throttle(triggerViewUpdate, THROTTLE_VIEW_UPDATE_PERIOD, {
    leading: false
  }), scheduleViewUpdate = _a2.throttled, cancelScheduleViewUpdate = _a2.cancel;
  var _b = trackViewMetrics(lifeCycle, domMutationObservable, configuration, scheduleViewUpdate, loadingType, startClocks, webVitalTelemetryDebug), setLoadEvent = _b.setLoadEvent, stopViewMetricsTracking = _b.stop, viewMetrics = _b.viewMetrics, getScrollMetrics = _b.getScrollMetrics;
  var _c = loadingType === "initial_load" ? trackInitialViewTimings(lifeCycle, webVitalTelemetryDebug, setLoadEvent, scheduleViewUpdate) : { scheduleStop: noop, timings: {} }, scheduleStopInitialViewTimingsTracking = _c.scheduleStop, timings = _c.timings;
  var _d = trackViewEventCounts(lifeCycle, id, scheduleViewUpdate), scheduleStopEventCountsTracking = _d.scheduleStop, eventCounts = _d.eventCounts;
  var keepAliveIntervalId = setInterval(triggerViewUpdate, SESSION_KEEP_ALIVE_INTERVAL);
  triggerViewUpdate();
  function triggerViewUpdate() {
    cancelScheduleViewUpdate();
    documentVersion += 1;
    var currentEnd = endClocks === void 0 ? timeStampNow() : endClocks.timeStamp;
    lifeCycle.notify(3, assign({
      customTimings,
      documentVersion,
      id,
      name,
      service,
      version,
      loadingType,
      location: location2,
      startClocks,
      timings,
      duration: elapsed(startClocks.timeStamp, currentEnd),
      isActive: endClocks === void 0,
      sessionIsActive,
      eventCounts,
      scrollMetrics: getScrollMetrics()
    }, viewMetrics));
  }
  return {
    name,
    service,
    version,
    end: function(options) {
      var _a3, _b2;
      if (options === void 0) {
        options = {};
      }
      if (endClocks) {
        return;
      }
      endClocks = (_a3 = options.endClocks) !== null && _a3 !== void 0 ? _a3 : clocksNow();
      sessionIsActive = (_b2 = options.sessionIsActive) !== null && _b2 !== void 0 ? _b2 : true;
      lifeCycle.notify(4, { endClocks });
      clearInterval(keepAliveIntervalId);
      stopViewMetricsTracking();
      scheduleStopInitialViewTimingsTracking();
      scheduleStopEventCountsTracking();
      triggerViewUpdate();
    },
    addTiming: function(name2, time) {
      if (endClocks) {
        return;
      }
      var relativeTime = looksLikeRelativeTime(time) ? time : elapsed(startClocks.timeStamp, time);
      customTimings[sanitizeTiming(name2)] = relativeTime;
      scheduleViewUpdate();
    }
  };
}
function sanitizeTiming(name) {
  var sanitized = name.replace(/[^a-zA-Z0-9-_.@$]/g, "_");
  if (sanitized !== name) {
    display.warn("Invalid timing name: ".concat(name, ", sanitized to: ").concat(sanitized));
  }
  return sanitized;
}
function areDifferentLocation(currentLocation, otherLocation) {
  return currentLocation.pathname !== otherLocation.pathname || !isHashAnAnchor(otherLocation.hash) && getPathFromHash(otherLocation.hash) !== getPathFromHash(currentLocation.hash);
}
function isHashAnAnchor(hash) {
  var correspondingId = hash.substr(1);
  return !!document.getElementById(correspondingId);
}
function getPathFromHash(hash) {
  var index = hash.indexOf("?");
  return index < 0 ? hash : hash.slice(0, index);
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/view/viewCollection.js
function startViewCollection(lifeCycle, configuration, location2, domMutationObservable, locationChangeObservable, featureFlagContexts, pageStateHistory, recorderApi2, webVitalTelemetryDebug, initialViewOptions) {
  lifeCycle.subscribe(3, function(view) {
    return lifeCycle.notify(10, processViewUpdate(view, configuration, featureFlagContexts, recorderApi2, pageStateHistory));
  });
  var trackViewResult = trackViews(location2, lifeCycle, domMutationObservable, configuration, locationChangeObservable, !configuration.trackViewsManually, webVitalTelemetryDebug, initialViewOptions);
  return trackViewResult;
}
function processViewUpdate(view, configuration, featureFlagContexts, recorderApi2, pageStateHistory) {
  var replayStats = recorderApi2.getReplayStats(view.id);
  var featureFlagContext = featureFlagContexts.findFeatureFlagEvaluations(view.startClocks.relative);
  var pageStatesEnabled = isExperimentalFeatureEnabled(ExperimentalFeature.PAGE_STATES);
  var pageStates = pageStateHistory.findAll(view.startClocks.relative, view.duration);
  var viewEvent = {
    _dd: {
      document_version: view.documentVersion,
      replay_stats: replayStats,
      page_states: pageStatesEnabled ? pageStates : void 0
    },
    date: view.startClocks.timeStamp,
    type: "view",
    view: {
      action: {
        count: view.eventCounts.actionCount
      },
      frustration: {
        count: view.eventCounts.frustrationCount
      },
      cumulative_layout_shift: view.cumulativeLayoutShift,
      first_byte: toServerDuration(view.timings.firstByte),
      dom_complete: toServerDuration(view.timings.domComplete),
      dom_content_loaded: toServerDuration(view.timings.domContentLoaded),
      dom_interactive: toServerDuration(view.timings.domInteractive),
      error: {
        count: view.eventCounts.errorCount
      },
      first_contentful_paint: toServerDuration(view.timings.firstContentfulPaint),
      first_input_delay: toServerDuration(view.timings.firstInputDelay),
      first_input_time: toServerDuration(view.timings.firstInputTime),
      is_active: view.isActive,
      name: view.name,
      largest_contentful_paint: toServerDuration(view.timings.largestContentfulPaint),
      load_event: toServerDuration(view.timings.loadEvent),
      loading_time: discardNegativeDuration(toServerDuration(view.loadingTime)),
      loading_type: view.loadingType,
      long_task: {
        count: view.eventCounts.longTaskCount
      },
      resource: {
        count: view.eventCounts.resourceCount
      },
      time_spent: toServerDuration(view.duration),
      in_foreground_periods: !pageStatesEnabled && pageStates ? mapToForegroundPeriods(pageStates, view.duration) : void 0
      // Todo: Remove in the next major release
    },
    feature_flags: featureFlagContext && !isEmptyObject(featureFlagContext) ? featureFlagContext : void 0,
    display: view.scrollMetrics ? {
      scroll: {
        max_depth: view.scrollMetrics.maxDepth,
        max_depth_scroll_height: view.scrollMetrics.maxDepthScrollHeight,
        max_depth_scroll_top: view.scrollMetrics.maxDepthScrollTop,
        max_depth_time: toServerDuration(view.scrollMetrics.maxDepthTime)
      }
    } : void 0,
    session: {
      has_replay: replayStats ? true : void 0,
      is_active: view.sessionIsActive ? void 0 : false
    },
    privacy: {
      replay_level: configuration.defaultPrivacyLevel
    }
  };
  if (!isEmptyObject(view.customTimings)) {
    viewEvent.view.custom_timings = mapValues(view.customTimings, toServerDuration);
  }
  return {
    rawRumEvent: viewEvent,
    startTime: view.startClocks.relative,
    domainContext: {
      location: view.location
    }
  };
}
function discardNegativeDuration(duration) {
  return isNumber(duration) && duration < 0 ? void 0 : duration;
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumSessionManager.js
var RUM_SESSION_KEY = "rum";
function startRumSessionManager(configuration, lifeCycle) {
  var sessionManager = startSessionManager(
    // TODO - Improve configuration type and remove assertion
    configuration.sessionStoreStrategyType,
    RUM_SESSION_KEY,
    function(rawTrackingType) {
      return computeSessionState(configuration, rawTrackingType);
    }
  );
  sessionManager.expireObservable.subscribe(function() {
    lifeCycle.notify(
      7
      /* LifeCycleEventType.SESSION_EXPIRED */
    );
  });
  sessionManager.renewObservable.subscribe(function() {
    lifeCycle.notify(
      8
      /* LifeCycleEventType.SESSION_RENEWED */
    );
  });
  return {
    findTrackedSession: function(startTime) {
      var session = sessionManager.findActiveSession(startTime);
      if (!session || !isTypeTracked(session.trackingType)) {
        return;
      }
      var plan = session.trackingType === "1" ? 2 : 1;
      return {
        id: session.id,
        plan,
        sessionReplayAllowed: plan === 2,
        longTaskAllowed: configuration.trackLongTasks !== void 0 ? configuration.trackLongTasks : configuration.oldPlansBehavior && plan === 2,
        resourceAllowed: configuration.trackResources !== void 0 ? configuration.trackResources : configuration.oldPlansBehavior && plan === 2
      };
    },
    expire: sessionManager.expire,
    expireObservable: sessionManager.expireObservable
  };
}
function startRumSessionManagerStub() {
  var session = {
    id: "00000000-aaaa-0000-aaaa-000000000000",
    plan: 1,
    sessionReplayAllowed: false,
    longTaskAllowed: true,
    resourceAllowed: true
  };
  return {
    findTrackedSession: function() {
      return session;
    },
    expire: noop,
    expireObservable: new Observable()
  };
}
function computeSessionState(configuration, rawTrackingType) {
  var trackingType;
  if (hasValidRumSession(rawTrackingType)) {
    trackingType = rawTrackingType;
  } else if (!performDraw(configuration.sessionSampleRate)) {
    trackingType = "0";
  } else if (!performDraw(configuration.sessionReplaySampleRate)) {
    trackingType = "2";
  } else {
    trackingType = "1";
  }
  return {
    trackingType,
    isTracked: isTypeTracked(trackingType)
  };
}
function hasValidRumSession(trackingType) {
  return trackingType === "0" || trackingType === "1" || trackingType === "2";
}
function isTypeTracked(rumSessionType) {
  return rumSessionType === "2" || rumSessionType === "1";
}

// ../../node_modules/@datadog/browser-rum-core/esm/transport/startRumBatch.js
function startRumBatch(configuration, lifeCycle, telemetryEventObservable, reportError, pageExitObservable, sessionExpireObservable) {
  var batch = makeRumBatch(configuration, reportError, pageExitObservable, sessionExpireObservable);
  lifeCycle.subscribe(11, function(serverRumEvent) {
    if (serverRumEvent.type === "view") {
      batch.upsert(serverRumEvent, serverRumEvent.view.id);
    } else {
      batch.add(serverRumEvent);
    }
  });
  telemetryEventObservable.subscribe(function(event) {
    return batch.add(event, isTelemetryReplicationAllowed(configuration));
  });
  return batch;
}
function makeRumBatch(configuration, reportError, pageExitObservable, sessionExpireObservable) {
  var _a2 = createRumBatch(configuration.rumEndpointBuilder), primaryBatch = _a2.batch, primaryFlushController = _a2.flushController;
  var replicaBatch;
  var replica = configuration.replica;
  if (replica !== void 0) {
    replicaBatch = createRumBatch(replica.rumEndpointBuilder).batch;
  }
  function createRumBatch(endpointBuilder) {
    var flushController = createFlushController({
      messagesLimit: configuration.batchMessagesLimit,
      bytesLimit: configuration.batchBytesLimit,
      durationLimit: configuration.flushTimeout,
      pageExitObservable,
      sessionExpireObservable
    });
    var batch = new Batch(createHttpRequest(endpointBuilder, configuration.batchBytesLimit, reportError), flushController, configuration.messageBytesLimit);
    return {
      batch,
      flushController
    };
  }
  function withReplicaApplicationId(message) {
    return combine(message, { application: { id: replica.applicationId } });
  }
  return {
    flushObservable: primaryFlushController.flushObservable,
    add: function(message, replicated) {
      if (replicated === void 0) {
        replicated = true;
      }
      primaryBatch.add(message);
      if (replicaBatch && replicated) {
        replicaBatch.add(withReplicaApplicationId(message));
      }
    },
    upsert: function(message, key) {
      primaryBatch.upsert(message, key);
      if (replicaBatch) {
        replicaBatch.upsert(withReplicaApplicationId(message), key);
      }
    }
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/transport/startRumEventBridge.js
function startRumEventBridge(lifeCycle) {
  var bridge = getEventBridge();
  lifeCycle.subscribe(11, function(serverRumEvent) {
    bridge.send("rum", serverRumEvent);
  });
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/contexts/urlContexts.js
var URL_CONTEXT_TIME_OUT_DELAY = SESSION_TIME_OUT_DELAY;
function startUrlContexts(lifeCycle, locationChangeObservable, location2) {
  var urlContextHistory = new ValueHistory(URL_CONTEXT_TIME_OUT_DELAY);
  var previousViewUrl;
  lifeCycle.subscribe(4, function(_a2) {
    var endClocks = _a2.endClocks;
    urlContextHistory.closeActive(endClocks.relative);
  });
  lifeCycle.subscribe(2, function(_a2) {
    var startClocks = _a2.startClocks;
    var viewUrl = location2.href;
    urlContextHistory.add(buildUrlContext({
      url: viewUrl,
      referrer: !previousViewUrl ? document.referrer : previousViewUrl
    }), startClocks.relative);
    previousViewUrl = viewUrl;
  });
  var locationChangeSubscription = locationChangeObservable.subscribe(function(_a2) {
    var newLocation = _a2.newLocation;
    var current = urlContextHistory.find();
    if (current) {
      var changeTime = relativeNow();
      urlContextHistory.closeActive(changeTime);
      urlContextHistory.add(buildUrlContext({
        url: newLocation.href,
        referrer: current.referrer
      }), changeTime);
    }
  });
  function buildUrlContext(_a2) {
    var url = _a2.url, referrer = _a2.referrer;
    return {
      url,
      referrer
    };
  }
  return {
    findUrl: function(startTime) {
      return urlContextHistory.find(startTime);
    },
    stop: function() {
      locationChangeSubscription.unsubscribe();
      urlContextHistory.stop();
    }
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/browser/locationChangeObservable.js
function createLocationChangeObservable(location2) {
  var currentLocation = shallowClone(location2);
  var observable = new Observable(function() {
    var stopHistoryTracking = trackHistory(onLocationChange).stop;
    var stopHashTracking = trackHash(onLocationChange).stop;
    return function() {
      stopHistoryTracking();
      stopHashTracking();
    };
  });
  function onLocationChange() {
    if (currentLocation.href === location2.href) {
      return;
    }
    var newLocation = shallowClone(location2);
    observable.notify({
      newLocation,
      oldLocation: currentLocation
    });
    currentLocation = newLocation;
  }
  return observable;
}
function trackHistory(onHistoryChange) {
  var stopInstrumentingPushState = instrumentMethodAndCallOriginal(history, "pushState", {
    after: onHistoryChange
  }).stop;
  var stopInstrumentingReplaceState = instrumentMethodAndCallOriginal(history, "replaceState", {
    after: onHistoryChange
  }).stop;
  var removeListener = addEventListener(window, "popstate", onHistoryChange).stop;
  return {
    stop: function() {
      stopInstrumentingPushState();
      stopInstrumentingReplaceState();
      removeListener();
    }
  };
}
function trackHash(onHashChange) {
  return addEventListener(window, "hashchange", onHashChange);
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/contexts/featureFlagContext.js
var FEATURE_FLAG_CONTEXT_TIME_OUT_DELAY = SESSION_TIME_OUT_DELAY;
var BYTES_COMPUTATION_THROTTLING_DELAY = 200;
function startFeatureFlagContexts(lifeCycle, computeBytesCountImpl) {
  if (computeBytesCountImpl === void 0) {
    computeBytesCountImpl = computeBytesCount;
  }
  if (!isExperimentalFeatureEnabled(ExperimentalFeature.FEATURE_FLAGS)) {
    return {
      findFeatureFlagEvaluations: function() {
        return void 0;
      },
      getFeatureFlagBytesCount: function() {
        return 0;
      },
      addFeatureFlagEvaluation: noop,
      stop: noop
    };
  }
  var featureFlagContexts = new ValueHistory(FEATURE_FLAG_CONTEXT_TIME_OUT_DELAY);
  var bytesCountCache = 0;
  var alreadyWarned = false;
  lifeCycle.subscribe(4, function(_a3) {
    var endClocks = _a3.endClocks;
    featureFlagContexts.closeActive(endClocks.relative);
  });
  lifeCycle.subscribe(2, function(_a3) {
    var startClocks = _a3.startClocks;
    featureFlagContexts.add({}, startClocks.relative);
    bytesCountCache = 0;
  });
  var _a2 = throttle(function(context) {
    bytesCountCache = computeBytesCountImpl(jsonStringify(context));
    if (!alreadyWarned) {
      alreadyWarned = warnIfCustomerDataLimitReached(
        bytesCountCache,
        "feature flag evaluation"
        /* CustomerDataType.FeatureFlag */
      );
    }
  }, BYTES_COMPUTATION_THROTTLING_DELAY), computeBytesCountThrottled = _a2.throttled, cancelPendingComputation = _a2.cancel;
  return {
    findFeatureFlagEvaluations: function(startTime) {
      return featureFlagContexts.find(startTime);
    },
    getFeatureFlagBytesCount: function() {
      var currentContext = featureFlagContexts.find();
      if (!currentContext) {
        return 0;
      }
      return bytesCountCache;
    },
    addFeatureFlagEvaluation: function(key, value) {
      var currentContext = featureFlagContexts.find();
      if (currentContext) {
        currentContext[key] = value;
        computeBytesCountThrottled(currentContext);
      }
    },
    stop: cancelPendingComputation
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/startCustomerDataTelemetry.js
var MEASURES_PERIOD_DURATION = 10 * ONE_SECOND;
var currentPeriodMeasures;
var currentBatchMeasures;
var batchHasRumEvent;
function startCustomerDataTelemetry(configuration, telemetry, lifeCycle, globalContextManager, userContextManager, featureFlagContexts, batchFlushObservable) {
  var customerDataTelemetryEnabled = telemetry.enabled && performDraw(configuration.customerDataTelemetrySampleRate);
  if (!customerDataTelemetryEnabled) {
    return;
  }
  initCurrentPeriodMeasures();
  initCurrentBatchMeasures();
  lifeCycle.subscribe(11, function(event) {
    batchHasRumEvent = true;
    updateMeasure(currentBatchMeasures.globalContextBytes, !isEmptyObject(globalContextManager.get()) ? globalContextManager.getBytesCount() : 0);
    updateMeasure(currentBatchMeasures.userContextBytes, !isEmptyObject(userContextManager.get()) ? userContextManager.getBytesCount() : 0);
    var featureFlagContext = featureFlagContexts.findFeatureFlagEvaluations();
    var hasFeatureFlagContext = includes([
      "view",
      "error"
      /* RumEventType.ERROR */
    ], event.type) && featureFlagContext && !isEmptyObject(featureFlagContext);
    updateMeasure(currentBatchMeasures.featureFlagBytes, hasFeatureFlagContext ? featureFlagContexts.getFeatureFlagBytesCount() : 0);
  });
  batchFlushObservable.subscribe(function(_a2) {
    var bytesCount = _a2.bytesCount, messagesCount = _a2.messagesCount;
    if (!batchHasRumEvent) {
      return;
    }
    currentPeriodMeasures.batchCount += 1;
    updateMeasure(currentPeriodMeasures.batchBytesCount, bytesCount);
    updateMeasure(currentPeriodMeasures.batchMessagesCount, messagesCount);
    mergeMeasure(currentPeriodMeasures.globalContextBytes, currentBatchMeasures.globalContextBytes);
    mergeMeasure(currentPeriodMeasures.userContextBytes, currentBatchMeasures.userContextBytes);
    mergeMeasure(currentPeriodMeasures.featureFlagBytes, currentBatchMeasures.featureFlagBytes);
    initCurrentBatchMeasures();
  });
  setInterval(sendCurrentPeriodMeasures, MEASURES_PERIOD_DURATION);
}
function sendCurrentPeriodMeasures() {
  if (currentPeriodMeasures.batchCount === 0) {
    return;
  }
  addTelemetryDebug("Customer data measures", currentPeriodMeasures);
  initCurrentPeriodMeasures();
}
function createMeasure() {
  return { min: Infinity, max: 0, sum: 0 };
}
function updateMeasure(measure, value) {
  measure.sum += value;
  measure.min = Math.min(measure.min, value);
  measure.max = Math.max(measure.max, value);
}
function mergeMeasure(target, source) {
  target.sum += source.sum;
  target.min = Math.min(target.min, source.min);
  target.max = Math.max(target.max, source.max);
}
function initCurrentPeriodMeasures() {
  currentPeriodMeasures = {
    batchCount: 0,
    batchBytesCount: createMeasure(),
    batchMessagesCount: createMeasure(),
    globalContextBytes: createMeasure(),
    userContextBytes: createMeasure(),
    featureFlagBytes: createMeasure()
  };
}
function initCurrentBatchMeasures() {
  batchHasRumEvent = false;
  currentBatchMeasures = {
    globalContextBytes: createMeasure(),
    userContextBytes: createMeasure(),
    featureFlagBytes: createMeasure()
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/contexts/pageStateHistory.js
var MAX_PAGE_STATE_ENTRIES = 4e3;
var MAX_PAGE_STATE_ENTRIES_SELECTABLE = 500;
var PAGE_STATE_CONTEXT_TIME_OUT_DELAY = SESSION_TIME_OUT_DELAY;
function startPageStateHistory(maxPageStateEntriesSelectable) {
  if (maxPageStateEntriesSelectable === void 0) {
    maxPageStateEntriesSelectable = MAX_PAGE_STATE_ENTRIES_SELECTABLE;
  }
  var pageStateHistory = new ValueHistory(PAGE_STATE_CONTEXT_TIME_OUT_DELAY, MAX_PAGE_STATE_ENTRIES);
  var currentPageState;
  addPageState(getPageState(), relativeNow());
  var stopEventListeners = addEventListeners(window, [
    "pageshow",
    "focus",
    "blur",
    "visibilitychange",
    "resume",
    "freeze",
    "pagehide"
  ], function(event) {
    if (event.isTrusted) {
      addPageState(computePageState(event), event.timeStamp);
    }
  }, { capture: true }).stop;
  function addPageState(nextPageState, startTime) {
    if (startTime === void 0) {
      startTime = relativeNow();
    }
    if (nextPageState === currentPageState) {
      return;
    }
    currentPageState = nextPageState;
    pageStateHistory.closeActive(startTime);
    pageStateHistory.add({ state: currentPageState, startTime }, startTime);
  }
  return {
    findAll: function(eventStartTime, duration) {
      var pageStateEntries = pageStateHistory.findAll(eventStartTime, duration);
      if (pageStateEntries.length === 0) {
        return;
      }
      var pageStateServerEntries = [];
      var limit = Math.max(0, pageStateEntries.length - maxPageStateEntriesSelectable);
      for (var index = pageStateEntries.length - 1; index >= limit; index--) {
        var pageState = pageStateEntries[index];
        var relativeStartTime = elapsed(eventStartTime, pageState.startTime);
        pageStateServerEntries.push({
          state: pageState.state,
          start: toServerDuration(relativeStartTime)
        });
      }
      return pageStateServerEntries;
    },
    isInActivePageStateAt: function(startTime) {
      var pageStateEntry = pageStateHistory.find(startTime);
      return pageStateEntry !== void 0 && pageStateEntry.state === "active";
    },
    addPageState,
    stop: function() {
      stopEventListeners();
      pageStateHistory.stop();
    }
  };
}
function computePageState(event) {
  if (event.type === "freeze") {
    return "frozen";
  } else if (event.type === "pagehide") {
    return event.persisted ? "frozen" : "terminated";
  }
  return getPageState();
}
function getPageState() {
  if (document.visibilityState === "hidden") {
    return "hidden";
  }
  if (document.hasFocus()) {
    return "active";
  }
  return "passive";
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/rumEventsCollection/view/startWebVitalTelemetryDebug.js
function startWebVitalTelemetryDebug(configuration, telemetry, recorderApi2, session) {
  var webVitalTelemetryEnabled = telemetry.enabled && performDraw(configuration.customerDataTelemetrySampleRate);
  if (!webVitalTelemetryEnabled) {
    return {
      addWebVitalTelemetryDebug: noop
    };
  }
  return {
    addWebVitalTelemetryDebug: function(webVitalName, webVitalNode, webVitalTime) {
      var _a2;
      var computationTime = relativeNow();
      if (!recorderApi2.isRecording()) {
        recorderApi2.recorderStartObservable.subscribe(function(recordingStartTime) {
          addTelemetryDebug("".concat(webVitalName, " attribution recording delay"), {
            computationDelay: toServerDuration(elapsed(webVitalTime, computationTime)),
            recordingDelay: toServerDuration(elapsed(webVitalTime, recordingStartTime)),
            hasNode: !!webVitalNode,
            serializedDomNode: webVitalNode ? recorderApi2.getSerializedNodeId(webVitalNode) : void 0
          });
        });
      }
      addTelemetryDebug("".concat(webVitalName, " attribution"), {
        computationDelay: toServerDuration(elapsed(webVitalTime, computationTime)),
        hasNode: !!webVitalNode,
        replayRecording: recorderApi2.isRecording(),
        replaySampled: (_a2 = session.findTrackedSession()) === null || _a2 === void 0 ? void 0 : _a2.sessionReplayAllowed,
        serializedDomNode: webVitalNode ? recorderApi2.getSerializedNodeId(webVitalNode) : void 0
      });
    }
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/boot/startRum.js
function startRum(initConfiguration, configuration, recorderApi2, globalContextManager, userContextManager, initialViewOptions) {
  var lifeCycle = new LifeCycle();
  lifeCycle.subscribe(11, function(event) {
    return sendToExtension("rum", event);
  });
  var telemetry = startRumTelemetry(configuration);
  telemetry.setContextProvider(function() {
    var _a3, _b2;
    return {
      application: {
        id: configuration.applicationId
      },
      session: {
        id: (_a3 = session.findTrackedSession()) === null || _a3 === void 0 ? void 0 : _a3.id
      },
      view: {
        id: (_b2 = viewContexts.findView()) === null || _b2 === void 0 ? void 0 : _b2.id
      },
      action: {
        id: actionContexts.findActionId()
      }
    };
  });
  var reportError = function(error) {
    lifeCycle.notify(12, { error });
    addTelemetryDebug("Error reported to customer", { "error.message": error.message });
  };
  var featureFlagContexts = startFeatureFlagContexts(lifeCycle);
  var pageExitObservable = createPageExitObservable();
  pageExitObservable.subscribe(function(event) {
    lifeCycle.notify(9, event);
  });
  var session = !canUseEventBridge() ? startRumSessionManager(configuration, lifeCycle) : startRumSessionManagerStub();
  if (!canUseEventBridge()) {
    var batch = startRumBatch(configuration, lifeCycle, telemetry.observable, reportError, pageExitObservable, session.expireObservable);
    startCustomerDataTelemetry(configuration, telemetry, lifeCycle, globalContextManager, userContextManager, featureFlagContexts, batch.flushObservable);
  } else {
    startRumEventBridge(lifeCycle);
  }
  var domMutationObservable = createDOMMutationObservable();
  var locationChangeObservable = createLocationChangeObservable(location);
  var _a2 = startRumEventCollection(lifeCycle, configuration, location, session, locationChangeObservable, domMutationObservable, function() {
    return buildCommonContext(globalContextManager, userContextManager, recorderApi2);
  }, reportError), viewContexts = _a2.viewContexts, pageStateHistory = _a2.pageStateHistory, urlContexts = _a2.urlContexts, actionContexts = _a2.actionContexts, addAction = _a2.addAction;
  addTelemetryConfiguration(serializeRumConfiguration(initConfiguration));
  startLongTaskCollection(lifeCycle, session);
  startResourceCollection(lifeCycle, configuration, session, pageStateHistory);
  var webVitalTelemetryDebug = startWebVitalTelemetryDebug(configuration, telemetry, recorderApi2, session);
  var _b = startViewCollection(lifeCycle, configuration, location, domMutationObservable, locationChangeObservable, featureFlagContexts, pageStateHistory, recorderApi2, webVitalTelemetryDebug, initialViewOptions), addTiming = _b.addTiming, startView = _b.startView;
  var addError = startErrorCollection(lifeCycle, pageStateHistory, featureFlagContexts).addError;
  startRequestCollection(lifeCycle, configuration, session);
  startPerformanceCollection(lifeCycle, configuration);
  var internalContext = startInternalContext(configuration.applicationId, session, viewContexts, actionContexts, urlContexts);
  return {
    addAction,
    addError,
    addTiming,
    addFeatureFlagEvaluation: featureFlagContexts.addFeatureFlagEvaluation,
    startView,
    lifeCycle,
    viewContexts,
    session,
    stopSession: function() {
      return session.expire();
    },
    getInternalContext: internalContext.get
  };
}
function startRumTelemetry(configuration) {
  var telemetry = startTelemetry("browser-rum-sdk", configuration);
  if (canUseEventBridge()) {
    var bridge_1 = getEventBridge();
    telemetry.observable.subscribe(function(event) {
      return bridge_1.send("internal_telemetry", event);
    });
  }
  return telemetry;
}
function startRumEventCollection(lifeCycle, configuration, location2, sessionManager, locationChangeObservable, domMutationObservable, buildCommonContext2, reportError) {
  var viewContexts = startViewContexts(lifeCycle);
  var urlContexts = startUrlContexts(lifeCycle, locationChangeObservable, location2);
  var pageStateHistory = startPageStateHistory();
  var _a2 = startActionCollection(lifeCycle, domMutationObservable, configuration, pageStateHistory), addAction = _a2.addAction, actionContexts = _a2.actionContexts;
  startRumAssembly(configuration, lifeCycle, sessionManager, viewContexts, urlContexts, actionContexts, buildCommonContext2, reportError);
  return {
    viewContexts,
    pageStateHistory,
    urlContexts,
    addAction,
    actionContexts,
    stop: function() {
      viewContexts.stop();
      pageStateHistory.stop();
    }
  };
}

// ../../node_modules/@datadog/browser-rum-core/esm/domain/getSessionReplayUrl.js
function getSessionReplayUrl(configuration, _a2) {
  var session = _a2.session, viewContext = _a2.viewContext, errorType = _a2.errorType;
  var sessionId = session ? session.id : "no-session-id";
  var parameters = [];
  if (errorType !== void 0) {
    parameters.push("error-type=".concat(errorType));
  }
  if (viewContext) {
    parameters.push("seed=".concat(viewContext.id));
    parameters.push("from=".concat(viewContext.startClocks.timeStamp));
  }
  var origin = getDatadogSiteUrl(configuration);
  var path = "/rum/replay/sessions/".concat(sessionId);
  return "".concat(origin).concat(path, "?").concat(parameters.join("&"));
}
function getDatadogSiteUrl(rumConfiguration) {
  var site = rumConfiguration.site;
  var subdomain = rumConfiguration.subdomain || getSiteDefaultSubdomain(rumConfiguration);
  return "https://".concat(subdomain ? "".concat(subdomain, ".") : "").concat(site);
}
function getSiteDefaultSubdomain(configuration) {
  switch (configuration.site) {
    case INTAKE_SITE_US1:
    case INTAKE_SITE_EU1:
      return "app";
    case INTAKE_SITE_STAGING:
      return "dd";
    default:
      return void 0;
  }
}

// ../../node_modules/@datadog/browser-rum/esm/types/sessionReplayConstants.js
var RecordType = {
  FullSnapshot: 2,
  IncrementalSnapshot: 3,
  Meta: 4,
  Focus: 6,
  ViewEnd: 7,
  VisualViewport: 8,
  FrustrationRecord: 9
};
var NodeType = {
  Document: 0,
  DocumentType: 1,
  Element: 2,
  Text: 3,
  CDATA: 4,
  DocumentFragment: 11
};
var IncrementalSource = {
  Mutation: 0,
  MouseMove: 1,
  MouseInteraction: 2,
  Scroll: 3,
  ViewportResize: 4,
  Input: 5,
  TouchMove: 6,
  MediaInteraction: 7,
  StyleSheetRule: 8
  // CanvasMutation : 9,
  // Font : 10,
};
var MouseInteractionType = {
  MouseUp: 0,
  MouseDown: 1,
  Click: 2,
  ContextMenu: 3,
  DblClick: 4,
  Focus: 5,
  Blur: 6,
  TouchStart: 7,
  TouchEnd: 9
};
var MediaInteractionType = {
  Play: 0,
  Pause: 1
};

// ../../node_modules/@datadog/browser-rum/esm/domain/record/assembly.js
function assembleIncrementalSnapshot(source, data) {
  return {
    data: assign({
      source
    }, data),
    type: RecordType.IncrementalSnapshot,
    timestamp: timeStampNow()
  };
}

// ../../node_modules/@datadog/browser-rum/esm/constants.js
var NodePrivacyLevel = {
  IGNORE: "ignore",
  HIDDEN: "hidden",
  ALLOW: DefaultPrivacyLevel.ALLOW,
  MASK: DefaultPrivacyLevel.MASK,
  MASK_USER_INPUT: DefaultPrivacyLevel.MASK_USER_INPUT
};
var PRIVACY_ATTR_NAME = "data-dd-privacy";
var PRIVACY_ATTR_VALUE_ALLOW = "allow";
var PRIVACY_ATTR_VALUE_MASK = "mask";
var PRIVACY_ATTR_VALUE_MASK_USER_INPUT = "mask-user-input";
var PRIVACY_ATTR_VALUE_HIDDEN = "hidden";
var PRIVACY_CLASS_ALLOW = "dd-privacy-allow";
var PRIVACY_CLASS_MASK = "dd-privacy-mask";
var PRIVACY_CLASS_MASK_USER_INPUT = "dd-privacy-mask-user-input";
var PRIVACY_CLASS_HIDDEN = "dd-privacy-hidden";
var CENSORED_STRING_MARK = "***";
var CENSORED_IMG_MARK = "data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==";
var FORM_PRIVATE_TAG_NAMES = {
  INPUT: true,
  OUTPUT: true,
  TEXTAREA: true,
  SELECT: true,
  OPTION: true,
  DATALIST: true,
  OPTGROUP: true
};

// ../../node_modules/@datadog/browser-rum/esm/domain/record/privacy.js
var MAX_ATTRIBUTE_VALUE_CHAR_LENGTH = 1e5;
var TEXT_MASKING_CHAR = "x";
function getNodePrivacyLevel(node, defaultPrivacyLevel) {
  var parentNode = getParentNode(node);
  var parentNodePrivacyLevel = parentNode ? getNodePrivacyLevel(parentNode, defaultPrivacyLevel) : defaultPrivacyLevel;
  var selfNodePrivacyLevel = getNodeSelfPrivacyLevel(node);
  return reducePrivacyLevel(selfNodePrivacyLevel, parentNodePrivacyLevel);
}
function reducePrivacyLevel(childPrivacyLevel, parentNodePrivacyLevel) {
  switch (parentNodePrivacyLevel) {
    case NodePrivacyLevel.HIDDEN:
    case NodePrivacyLevel.IGNORE:
      return parentNodePrivacyLevel;
  }
  switch (childPrivacyLevel) {
    case NodePrivacyLevel.ALLOW:
    case NodePrivacyLevel.MASK:
    case NodePrivacyLevel.MASK_USER_INPUT:
    case NodePrivacyLevel.HIDDEN:
    case NodePrivacyLevel.IGNORE:
      return childPrivacyLevel;
    default:
      return parentNodePrivacyLevel;
  }
}
function getNodeSelfPrivacyLevel(node) {
  if (!isElementNode(node)) {
    return;
  }
  var privAttr = node.getAttribute(PRIVACY_ATTR_NAME);
  if (node.tagName === "BASE") {
    return NodePrivacyLevel.ALLOW;
  }
  if (node.tagName === "INPUT") {
    var inputElement = node;
    if (inputElement.type === "password" || inputElement.type === "email" || inputElement.type === "tel") {
      return NodePrivacyLevel.MASK;
    }
    if (inputElement.type === "hidden") {
      return NodePrivacyLevel.MASK;
    }
    var autocomplete = inputElement.getAttribute("autocomplete");
    if (autocomplete && autocomplete.indexOf("cc-") === 0) {
      return NodePrivacyLevel.MASK;
    }
  }
  if (privAttr === PRIVACY_ATTR_VALUE_HIDDEN || node.classList.contains(PRIVACY_CLASS_HIDDEN)) {
    return NodePrivacyLevel.HIDDEN;
  }
  if (privAttr === PRIVACY_ATTR_VALUE_MASK || node.classList.contains(PRIVACY_CLASS_MASK)) {
    return NodePrivacyLevel.MASK;
  }
  if (privAttr === PRIVACY_ATTR_VALUE_MASK_USER_INPUT || node.classList.contains(PRIVACY_CLASS_MASK_USER_INPUT)) {
    return NodePrivacyLevel.MASK_USER_INPUT;
  }
  if (privAttr === PRIVACY_ATTR_VALUE_ALLOW || node.classList.contains(PRIVACY_CLASS_ALLOW)) {
    return NodePrivacyLevel.ALLOW;
  }
  if (shouldIgnoreElement(node)) {
    return NodePrivacyLevel.IGNORE;
  }
}
function shouldMaskNode(node, privacyLevel) {
  switch (privacyLevel) {
    case NodePrivacyLevel.MASK:
    case NodePrivacyLevel.HIDDEN:
    case NodePrivacyLevel.IGNORE:
      return true;
    case NodePrivacyLevel.MASK_USER_INPUT:
      return isTextNode(node) ? isFormElement(node.parentNode) : isFormElement(node);
    default:
      return false;
  }
}
function isFormElement(node) {
  if (!node || node.nodeType !== node.ELEMENT_NODE) {
    return false;
  }
  var element = node;
  if (element.tagName === "INPUT") {
    switch (element.type) {
      case "button":
      case "color":
      case "reset":
      case "submit":
        return false;
    }
  }
  return !!FORM_PRIVATE_TAG_NAMES[element.tagName];
}
var censorText = function(text) {
  return text.replace(/\S/g, TEXT_MASKING_CHAR);
};
function getTextContent(textNode, ignoreWhiteSpace, parentNodePrivacyLevel) {
  var _a2;
  var parentTagName = (_a2 = textNode.parentElement) === null || _a2 === void 0 ? void 0 : _a2.tagName;
  var textContent = textNode.textContent || "";
  if (ignoreWhiteSpace && !textContent.trim()) {
    return;
  }
  var nodePrivacyLevel = parentNodePrivacyLevel;
  var isStyle = parentTagName === "STYLE" ? true : void 0;
  var isScript = parentTagName === "SCRIPT";
  if (isScript) {
    textContent = CENSORED_STRING_MARK;
  } else if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {
    textContent = CENSORED_STRING_MARK;
  } else if (shouldMaskNode(textNode, nodePrivacyLevel) && // Style tags are `overruled` (Use `hide` to enforce privacy)
  !isStyle) {
    if (
      // Scrambling the child list breaks text nodes for DATALIST/SELECT/OPTGROUP
      parentTagName === "DATALIST" || parentTagName === "SELECT" || parentTagName === "OPTGROUP"
    ) {
      if (!textContent.trim()) {
        return;
      }
    } else if (parentTagName === "OPTION") {
      textContent = CENSORED_STRING_MARK;
    } else {
      textContent = censorText(textContent);
    }
  }
  return textContent;
}
function shouldIgnoreElement(element) {
  if (element.nodeName === "SCRIPT") {
    return true;
  }
  if (element.nodeName === "LINK") {
    var relAttribute = getLowerCaseAttribute("rel");
    return (
      // Link as script - Ignore only when rel=preload, modulepreload or prefetch
      /preload|prefetch/i.test(relAttribute) && getLowerCaseAttribute("as") === "script" || // Favicons
      relAttribute === "shortcut icon" || relAttribute === "icon"
    );
  }
  if (element.nodeName === "META") {
    var nameAttribute = getLowerCaseAttribute("name");
    var relAttribute = getLowerCaseAttribute("rel");
    var propertyAttribute = getLowerCaseAttribute("property");
    return (
      // Favicons
      /^msapplication-tile(image|color)$/.test(nameAttribute) || nameAttribute === "application-name" || relAttribute === "icon" || relAttribute === "apple-touch-icon" || relAttribute === "shortcut icon" || // Description
      nameAttribute === "keywords" || nameAttribute === "description" || // Social
      /^(og|twitter|fb):/.test(propertyAttribute) || /^(og|twitter):/.test(nameAttribute) || nameAttribute === "pinterest" || // Robots
      nameAttribute === "robots" || nameAttribute === "googlebot" || nameAttribute === "bingbot" || // Http headers. Ex: X-UA-Compatible, Content-Type, Content-Language, cache-control,
      // X-Translated-By
      element.hasAttribute("http-equiv") || // Authorship
      nameAttribute === "author" || nameAttribute === "generator" || nameAttribute === "framework" || nameAttribute === "publisher" || nameAttribute === "progid" || /^article:/.test(propertyAttribute) || /^product:/.test(propertyAttribute) || // Verification
      nameAttribute === "google-site-verification" || nameAttribute === "yandex-verification" || nameAttribute === "csrf-token" || nameAttribute === "p:domain_verify" || nameAttribute === "verify-v1" || nameAttribute === "verification" || nameAttribute === "shopify-checkout-api-token"
    );
  }
  function getLowerCaseAttribute(name) {
    return (element.getAttribute(name) || "").toLowerCase();
  }
  return false;
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/serialization/serializationUtils.js
var serializedNodeIds = /* @__PURE__ */ new WeakMap();
function hasSerializedNode(node) {
  return serializedNodeIds.has(node);
}
function nodeAndAncestorsHaveSerializedNode(node) {
  var current = node;
  while (current) {
    if (!hasSerializedNode(current) && !isNodeShadowRoot(current)) {
      return false;
    }
    current = getParentNode(current);
  }
  return true;
}
function getSerializedNodeId(node) {
  return serializedNodeIds.get(node);
}
function setSerializedNodeId(node, serializeNodeId) {
  serializedNodeIds.set(node, serializeNodeId);
}
function getElementInputValue(element, nodePrivacyLevel) {
  var tagName = element.tagName;
  var value = element.value;
  if (shouldMaskNode(element, nodePrivacyLevel)) {
    var type = element.type;
    if (tagName === "INPUT" && (type === "button" || type === "submit" || type === "reset")) {
      return value;
    } else if (!value || tagName === "OPTION") {
      return;
    }
    return CENSORED_STRING_MARK;
  }
  if (tagName === "OPTION" || tagName === "SELECT") {
    return element.value;
  }
  if (tagName !== "INPUT" && tagName !== "TEXTAREA") {
    return;
  }
  return value;
}
var URL_IN_CSS_REF = /url\((?:(')([^']*)'|(")([^"]*)"|([^)]*))\)/gm;
var ABSOLUTE_URL = /^[A-Za-z]+:|^\/\//;
var DATA_URI = /^data:.*,/i;
function switchToAbsoluteUrl(cssText, cssHref) {
  return cssText.replace(URL_IN_CSS_REF, function(matchingSubstring, singleQuote, urlWrappedInSingleQuotes, doubleQuote, urlWrappedInDoubleQuotes, urlNotWrappedInQuotes) {
    var url = urlWrappedInSingleQuotes || urlWrappedInDoubleQuotes || urlNotWrappedInQuotes;
    if (!cssHref || !url || ABSOLUTE_URL.test(url) || DATA_URI.test(url)) {
      return matchingSubstring;
    }
    var quote = singleQuote || doubleQuote || "";
    return "url(".concat(quote).concat(makeUrlAbsolute(url, cssHref)).concat(quote, ")");
  });
}
function makeUrlAbsolute(url, baseUrl) {
  try {
    return buildUrl(url, baseUrl).href;
  } catch (_) {
    return url;
  }
}
var TAG_NAME_REGEX = /[^a-z1-6-_]/;
function getValidTagName(tagName) {
  var processedTagName = tagName.toLowerCase().trim();
  if (TAG_NAME_REGEX.test(processedTagName)) {
    return "div";
  }
  return processedTagName;
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/serialization/serializeStyleSheets.js
function serializeStyleSheets(cssStyleSheets) {
  if (cssStyleSheets === void 0 || cssStyleSheets.length === 0) {
    return void 0;
  }
  return cssStyleSheets.map(function(cssStyleSheet) {
    var rules = cssStyleSheet.cssRules || cssStyleSheet.rules;
    var cssRules = Array.from(rules, function(cssRule) {
      return cssRule.cssText;
    });
    var styleSheet = {
      cssRules,
      disabled: cssStyleSheet.disabled || void 0,
      media: cssStyleSheet.media.length > 0 ? Array.from(cssStyleSheet.media) : void 0
    };
    return styleSheet;
  });
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/serialization/serializeAttribute.js
function serializeAttribute(element, nodePrivacyLevel, attributeName, configuration) {
  if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {
    return null;
  }
  var attributeValue = element.getAttribute(attributeName);
  if (nodePrivacyLevel === NodePrivacyLevel.MASK && attributeName !== PRIVACY_ATTR_NAME && !STABLE_ATTRIBUTES.includes(attributeName) && attributeName !== configuration.actionNameAttribute) {
    var tagName = element.tagName;
    switch (attributeName) {
      case "title":
      case "alt":
      case "placeholder":
        return CENSORED_STRING_MARK;
    }
    if (tagName === "IMG" || tagName === "SOURCE") {
      if (attributeName === "src" || attributeName === "srcset") {
        return CENSORED_IMG_MARK;
      }
    }
    if (tagName === "A" && attributeName === "href") {
      return CENSORED_STRING_MARK;
    }
    if (attributeValue && startsWith(attributeName, "data-")) {
      return CENSORED_STRING_MARK;
    }
  }
  if (!attributeValue || typeof attributeValue !== "string") {
    return attributeValue;
  }
  if (attributeValue.length > MAX_ATTRIBUTE_VALUE_CHAR_LENGTH && attributeValue.slice(0, 5) === "data:") {
    return "data:truncated";
  }
  return attributeValue;
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/serialization/serializeAttributes.js
function serializeAttributes(element, nodePrivacyLevel, options) {
  var _a2;
  if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {
    return {};
  }
  var safeAttrs = {};
  var tagName = getValidTagName(element.tagName);
  var doc = element.ownerDocument;
  for (var i = 0; i < element.attributes.length; i += 1) {
    var attribute = element.attributes.item(i);
    var attributeName = attribute.name;
    var attributeValue = serializeAttribute(element, nodePrivacyLevel, attributeName, options.configuration);
    if (attributeValue !== null) {
      safeAttrs[attributeName] = attributeValue;
    }
  }
  if (element.value && (tagName === "textarea" || tagName === "select" || tagName === "option" || tagName === "input")) {
    var formValue = getElementInputValue(element, nodePrivacyLevel);
    if (formValue !== void 0) {
      safeAttrs.value = formValue;
    }
  }
  if (tagName === "option" && nodePrivacyLevel === NodePrivacyLevel.ALLOW) {
    var optionElement = element;
    if (optionElement.selected) {
      safeAttrs.selected = optionElement.selected;
    }
  }
  if (tagName === "link") {
    var stylesheet = Array.from(doc.styleSheets).find(function(s) {
      return s.href === element.href;
    });
    var cssText = getCssRulesString(stylesheet);
    if (cssText && stylesheet && !isExperimentalFeatureEnabled(ExperimentalFeature.DISABLE_REPLAY_INLINE_CSS)) {
      safeAttrs._cssText = cssText;
    }
  }
  if (tagName === "style" && element.sheet && // TODO: Currently we only try to get dynamic stylesheet when it is an empty style element
  !(element.innerText || element.textContent || "").trim().length) {
    var cssText = getCssRulesString(element.sheet);
    if (cssText) {
      safeAttrs._cssText = cssText;
    }
  }
  var inputElement = element;
  if (tagName === "input" && (inputElement.type === "radio" || inputElement.type === "checkbox")) {
    if (nodePrivacyLevel === NodePrivacyLevel.ALLOW) {
      safeAttrs.checked = !!inputElement.checked;
    } else if (shouldMaskNode(inputElement, nodePrivacyLevel)) {
      delete safeAttrs.checked;
    }
  }
  if (tagName === "audio" || tagName === "video") {
    var mediaElement = element;
    safeAttrs.rr_mediaState = mediaElement.paused ? "paused" : "played";
  }
  var scrollTop;
  var scrollLeft;
  var serializationContext = options.serializationContext;
  switch (serializationContext.status) {
    case 0:
      scrollTop = Math.round(element.scrollTop);
      scrollLeft = Math.round(element.scrollLeft);
      if (scrollTop || scrollLeft) {
        serializationContext.elementsScrollPositions.set(element, { scrollTop, scrollLeft });
      }
      break;
    case 1:
      if (serializationContext.elementsScrollPositions.has(element)) {
        ;
        _a2 = serializationContext.elementsScrollPositions.get(element), scrollTop = _a2.scrollTop, scrollLeft = _a2.scrollLeft;
      }
      break;
  }
  if (scrollLeft) {
    safeAttrs.rr_scrollLeft = scrollLeft;
  }
  if (scrollTop) {
    safeAttrs.rr_scrollTop = scrollTop;
  }
  return safeAttrs;
}
function getCssRulesString(cssStyleSheet) {
  if (!cssStyleSheet) {
    return null;
  }
  var rules;
  try {
    rules = cssStyleSheet.rules || cssStyleSheet.cssRules;
  } catch (_a2) {
  }
  if (!rules) {
    return null;
  }
  var styleSheetCssText = Array.from(rules, getCssRuleString).join("");
  return switchToAbsoluteUrl(styleSheetCssText, cssStyleSheet.href);
}
function getCssRuleString(rule) {
  return isCSSImportRule(rule) ? getCssRulesString(rule.styleSheet) || "" : rule.cssText;
}
function isCSSImportRule(rule) {
  return "styleSheet" in rule;
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/serialization/serializeNode.js
function serializeNodeWithId(node, options) {
  var serializedNode = serializeNode(node, options);
  if (!serializedNode) {
    return null;
  }
  var id = getSerializedNodeId(node) || generateNextId();
  var serializedNodeWithId = serializedNode;
  serializedNodeWithId.id = id;
  setSerializedNodeId(node, id);
  if (options.serializedNodeIds) {
    options.serializedNodeIds.add(id);
  }
  return serializedNodeWithId;
}
var _nextId = 1;
function generateNextId() {
  return _nextId++;
}
function serializeChildNodes(node, options) {
  var result = [];
  node.childNodes.forEach(function(childNode) {
    var serializedChildNode = serializeNodeWithId(childNode, options);
    if (serializedChildNode) {
      result.push(serializedChildNode);
    }
  });
  return result;
}
function serializeNode(node, options) {
  switch (node.nodeType) {
    case node.DOCUMENT_NODE:
      return serializeDocumentNode(node, options);
    case node.DOCUMENT_FRAGMENT_NODE:
      return serializeDocumentFragmentNode(node, options);
    case node.DOCUMENT_TYPE_NODE:
      return serializeDocumentTypeNode(node);
    case node.ELEMENT_NODE:
      return serializeElementNode(node, options);
    case node.TEXT_NODE:
      return serializeTextNode(node, options);
    case node.CDATA_SECTION_NODE:
      return serializeCDataNode();
  }
}
function serializeDocumentNode(document2, options) {
  return {
    type: NodeType.Document,
    childNodes: serializeChildNodes(document2, options),
    adoptedStyleSheets: serializeStyleSheets(document2.adoptedStyleSheets)
  };
}
function serializeDocumentFragmentNode(element, options) {
  var childNodes = [];
  if (element.childNodes.length) {
    childNodes = serializeChildNodes(element, options);
  }
  var isShadowRoot = isNodeShadowRoot(element);
  if (isShadowRoot) {
    options.serializationContext.shadowRootsController.addShadowRoot(element);
  }
  return {
    type: NodeType.DocumentFragment,
    childNodes,
    isShadowRoot,
    adoptedStyleSheets: isShadowRoot ? serializeStyleSheets(element.adoptedStyleSheets) : void 0
  };
}
function serializeDocumentTypeNode(documentType) {
  return {
    type: NodeType.DocumentType,
    name: documentType.name,
    publicId: documentType.publicId,
    systemId: documentType.systemId
  };
}
function serializeElementNode(element, options) {
  var _a2;
  var tagName = getValidTagName(element.tagName);
  var isSVG = isSVGElement(element) || void 0;
  var nodePrivacyLevel = reducePrivacyLevel(getNodeSelfPrivacyLevel(element), options.parentNodePrivacyLevel);
  if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {
    var _b = element.getBoundingClientRect(), width = _b.width, height = _b.height;
    return {
      type: NodeType.Element,
      tagName,
      attributes: (_a2 = {
        rr_width: "".concat(width, "px"),
        rr_height: "".concat(height, "px")
      }, _a2[PRIVACY_ATTR_NAME] = PRIVACY_ATTR_VALUE_HIDDEN, _a2),
      childNodes: [],
      isSVG
    };
  }
  if (nodePrivacyLevel === NodePrivacyLevel.IGNORE) {
    return;
  }
  var attributes = serializeAttributes(element, nodePrivacyLevel, options);
  var childNodes = [];
  if (element.childNodes.length) {
    var childNodesSerializationOptions = void 0;
    if (options.parentNodePrivacyLevel === nodePrivacyLevel && options.ignoreWhiteSpace === (tagName === "head")) {
      childNodesSerializationOptions = options;
    } else {
      childNodesSerializationOptions = assign({}, options, {
        parentNodePrivacyLevel: nodePrivacyLevel,
        ignoreWhiteSpace: tagName === "head"
      });
    }
    childNodes = serializeChildNodes(element, childNodesSerializationOptions);
  }
  if (isNodeShadowHost(element)) {
    var shadowRoot = serializeNodeWithId(element.shadowRoot, options);
    if (shadowRoot !== null) {
      childNodes.push(shadowRoot);
    }
  }
  return {
    type: NodeType.Element,
    tagName,
    attributes,
    childNodes,
    isSVG
  };
}
function isSVGElement(el) {
  return el.tagName === "svg" || el instanceof SVGElement;
}
function serializeTextNode(textNode, options) {
  var _a2;
  var parentTagName = (_a2 = textNode.parentElement) === null || _a2 === void 0 ? void 0 : _a2.tagName;
  var textContent = getTextContent(textNode, options.ignoreWhiteSpace || false, options.parentNodePrivacyLevel);
  if (textContent === void 0) {
    return;
  }
  return {
    type: NodeType.Text,
    textContent,
    isStyle: parentTagName === "STYLE" ? true : void 0
  };
}
function serializeCDataNode() {
  return {
    type: NodeType.CDATA,
    textContent: ""
  };
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/serialization/serializeDocument.js
function serializeDocument(document2, configuration, serializationContext) {
  return serializeNodeWithId(document2, {
    serializationContext,
    parentNodePrivacyLevel: configuration.defaultPrivacyLevel,
    configuration
  });
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/eventsUtils.js
function isTouchEvent(event) {
  return Boolean(event.changedTouches);
}
function getEventTarget(event) {
  if (event.composed === true && isNodeShadowHost(event.target)) {
    return event.composedPath()[0];
  }
  return event.target;
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/viewports.js
var TOLERANCE = 25;
function isVisualViewportFactoredIn(visualViewport) {
  return Math.abs(visualViewport.pageTop - visualViewport.offsetTop - window.scrollY) > TOLERANCE || Math.abs(visualViewport.pageLeft - visualViewport.offsetLeft - window.scrollX) > TOLERANCE;
}
var convertMouseEventToLayoutCoordinates = function(clientX, clientY) {
  var visualViewport = window.visualViewport;
  var normalized = {
    layoutViewportX: clientX,
    layoutViewportY: clientY,
    visualViewportX: clientX,
    visualViewportY: clientY
  };
  if (!visualViewport) {
    return normalized;
  } else if (isVisualViewportFactoredIn(visualViewport)) {
    normalized.layoutViewportX = Math.round(clientX + visualViewport.offsetLeft);
    normalized.layoutViewportY = Math.round(clientY + visualViewport.offsetTop);
  } else {
    normalized.visualViewportX = Math.round(clientX - visualViewport.offsetLeft);
    normalized.visualViewportY = Math.round(clientY - visualViewport.offsetTop);
  }
  return normalized;
};
var getVisualViewport = function(visualViewport) {
  return {
    scale: visualViewport.scale,
    offsetLeft: visualViewport.offsetLeft,
    offsetTop: visualViewport.offsetTop,
    pageLeft: visualViewport.pageLeft,
    pageTop: visualViewport.pageTop,
    height: visualViewport.height,
    width: visualViewport.width
  };
};

// ../../node_modules/@datadog/browser-rum/esm/domain/record/observers/moveObserver.js
var MOUSE_MOVE_OBSERVER_THRESHOLD = 50;
function initMoveObserver(cb) {
  var updatePosition = throttle(function(event) {
    var target = getEventTarget(event);
    if (hasSerializedNode(target)) {
      var coordinates = tryToComputeCoordinates(event);
      if (!coordinates) {
        return;
      }
      var position = {
        id: getSerializedNodeId(target),
        timeOffset: 0,
        x: coordinates.x,
        y: coordinates.y
      };
      cb([position], isTouchEvent(event) ? IncrementalSource.TouchMove : IncrementalSource.MouseMove);
    }
  }, MOUSE_MOVE_OBSERVER_THRESHOLD, {
    trailing: false
  }).throttled;
  return addEventListeners(document, [
    "mousemove",
    "touchmove"
    /* DOM_EVENT.TOUCH_MOVE */
  ], updatePosition, {
    capture: true,
    passive: true
  }).stop;
}
function tryToComputeCoordinates(event) {
  var _a2 = isTouchEvent(event) ? event.changedTouches[0] : event, x = _a2.clientX, y = _a2.clientY;
  if (window.visualViewport) {
    var _b = convertMouseEventToLayoutCoordinates(x, y), visualViewportX = _b.visualViewportX, visualViewportY = _b.visualViewportY;
    x = visualViewportX;
    y = visualViewportY;
  }
  if (!Number.isFinite(x) || !Number.isFinite(y)) {
    if (event.isTrusted) {
      addTelemetryDebug("mouse/touch event without x/y");
    }
    return void 0;
  }
  return { x, y };
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/observers/scrollObserver.js
var SCROLL_OBSERVER_THRESHOLD = 100;
function initScrollObserver(cb, defaultPrivacyLevel, elementsScrollPositions) {
  var updatePosition = throttle(function(event) {
    var target = getEventTarget(event);
    if (!target || getNodePrivacyLevel(target, defaultPrivacyLevel) === NodePrivacyLevel.HIDDEN || !hasSerializedNode(target)) {
      return;
    }
    var id = getSerializedNodeId(target);
    var scrollPositions = target === document ? {
      scrollTop: getScrollY(),
      scrollLeft: getScrollX()
    } : {
      scrollTop: Math.round(target.scrollTop),
      scrollLeft: Math.round(target.scrollLeft)
    };
    elementsScrollPositions.set(target, scrollPositions);
    cb({
      id,
      x: scrollPositions.scrollLeft,
      y: scrollPositions.scrollTop
    });
  }, SCROLL_OBSERVER_THRESHOLD).throttled;
  return addEventListener(document, "scroll", updatePosition, { capture: true, passive: true }).stop;
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/observers/mouseInteractionObserver.js
var _a;
var eventTypeToMouseInteraction = (_a = {}, // Listen for pointerup DOM events instead of mouseup for MouseInteraction/MouseUp records. This
// allows to reference such records from Frustration records.
//
// In the context of supporting Mobile Session Replay, we introduced `PointerInteraction` records
// used by the Mobile SDKs in place of `MouseInteraction`. In the future, we should replace
// `MouseInteraction` by `PointerInteraction` in the Browser SDK so we have an uniform way to
// convey such interaction. This would cleanly solve the issue since we would have
// `PointerInteraction/Up` records that we could reference from `Frustration` records.
_a[
  "pointerup"
  /* DOM_EVENT.POINTER_UP */
] = MouseInteractionType.MouseUp, _a[
  "mousedown"
  /* DOM_EVENT.MOUSE_DOWN */
] = MouseInteractionType.MouseDown, _a[
  "click"
  /* DOM_EVENT.CLICK */
] = MouseInteractionType.Click, _a[
  "contextmenu"
  /* DOM_EVENT.CONTEXT_MENU */
] = MouseInteractionType.ContextMenu, _a[
  "dblclick"
  /* DOM_EVENT.DBL_CLICK */
] = MouseInteractionType.DblClick, _a[
  "focus"
  /* DOM_EVENT.FOCUS */
] = MouseInteractionType.Focus, _a[
  "blur"
  /* DOM_EVENT.BLUR */
] = MouseInteractionType.Blur, _a[
  "touchstart"
  /* DOM_EVENT.TOUCH_START */
] = MouseInteractionType.TouchStart, _a[
  "touchend"
  /* DOM_EVENT.TOUCH_END */
] = MouseInteractionType.TouchEnd, _a);
function initMouseInteractionObserver(cb, defaultPrivacyLevel, recordIds) {
  var handler = function(event) {
    var target = getEventTarget(event);
    if (getNodePrivacyLevel(target, defaultPrivacyLevel) === NodePrivacyLevel.HIDDEN || !hasSerializedNode(target)) {
      return;
    }
    var id = getSerializedNodeId(target);
    var type = eventTypeToMouseInteraction[event.type];
    var interaction;
    if (type !== MouseInteractionType.Blur && type !== MouseInteractionType.Focus) {
      var coordinates = tryToComputeCoordinates(event);
      if (!coordinates) {
        return;
      }
      interaction = { id, type, x: coordinates.x, y: coordinates.y };
    } else {
      interaction = { id, type };
    }
    var record2 = assign({ id: recordIds.getIdForEvent(event) }, assembleIncrementalSnapshot(IncrementalSource.MouseInteraction, interaction));
    cb(record2);
  };
  return addEventListeners(document, Object.keys(eventTypeToMouseInteraction), handler, {
    capture: true,
    passive: true
  }).stop;
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/observers/inputObserver.js
function initInputObserver(cb, defaultPrivacyLevel, target) {
  if (target === void 0) {
    target = document;
  }
  var lastInputStateMap = /* @__PURE__ */ new WeakMap();
  var isShadowRoot = target !== document;
  var stopEventListeners = addEventListeners(
    target,
    // The 'input' event bubbles across shadow roots, so we don't have to listen for it on shadow
    // roots since it will be handled by the event listener that we did add to the document. Only
    // the 'change' event is blocked and needs to be handled on shadow roots.
    isShadowRoot ? [
      "change"
      /* DOM_EVENT.CHANGE */
    ] : [
      "input",
      "change"
      /* DOM_EVENT.CHANGE */
    ],
    function(event) {
      var target2 = getEventTarget(event);
      if (target2 instanceof HTMLInputElement || target2 instanceof HTMLTextAreaElement || target2 instanceof HTMLSelectElement) {
        onElementChange(target2);
      }
    },
    {
      capture: true,
      passive: true
    }
  ).stop;
  var stopPropertySetterInstrumentation;
  if (!isShadowRoot) {
    var instrumentationStoppers_1 = [
      instrumentSetter(HTMLInputElement.prototype, "value", onElementChange),
      instrumentSetter(HTMLInputElement.prototype, "checked", onElementChange),
      instrumentSetter(HTMLSelectElement.prototype, "value", onElementChange),
      instrumentSetter(HTMLTextAreaElement.prototype, "value", onElementChange),
      instrumentSetter(HTMLSelectElement.prototype, "selectedIndex", onElementChange)
    ];
    stopPropertySetterInstrumentation = function() {
      instrumentationStoppers_1.forEach(function(stopper) {
        return stopper.stop();
      });
    };
  } else {
    stopPropertySetterInstrumentation = noop;
  }
  return function() {
    stopPropertySetterInstrumentation();
    stopEventListeners();
  };
  function onElementChange(target2) {
    var nodePrivacyLevel = getNodePrivacyLevel(target2, defaultPrivacyLevel);
    if (nodePrivacyLevel === NodePrivacyLevel.HIDDEN) {
      return;
    }
    var type = target2.type;
    var inputState;
    if (type === "radio" || type === "checkbox") {
      if (shouldMaskNode(target2, nodePrivacyLevel)) {
        return;
      }
      inputState = { isChecked: target2.checked };
    } else {
      var value = getElementInputValue(target2, nodePrivacyLevel);
      if (value === void 0) {
        return;
      }
      inputState = { text: value };
    }
    cbWithDedup(target2, inputState);
    var name = target2.name;
    if (type === "radio" && name && target2.checked) {
      forEach(document.querySelectorAll('input[type="radio"][name="'.concat(name, '"]')), function(el) {
        if (el !== target2) {
          cbWithDedup(el, { isChecked: false });
        }
      });
    }
  }
  function cbWithDedup(target2, inputState) {
    if (!hasSerializedNode(target2)) {
      return;
    }
    var lastInputState = lastInputStateMap.get(target2);
    if (!lastInputState || lastInputState.text !== inputState.text || lastInputState.isChecked !== inputState.isChecked) {
      lastInputStateMap.set(target2, inputState);
      cb(assign({
        id: getSerializedNodeId(target2)
      }, inputState));
    }
  }
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/observers/styleSheetObserver.js
function initStyleSheetObserver(cb) {
  function checkStyleSheetAndCallback(styleSheet, callback) {
    if (styleSheet && hasSerializedNode(styleSheet.ownerNode)) {
      callback(getSerializedNodeId(styleSheet.ownerNode));
    }
  }
  var instrumentationStoppers = [
    instrumentMethodAndCallOriginal(CSSStyleSheet.prototype, "insertRule", {
      before: function(rule, index) {
        checkStyleSheetAndCallback(this, function(id) {
          return cb({ id, adds: [{ rule, index }] });
        });
      }
    }),
    instrumentMethodAndCallOriginal(CSSStyleSheet.prototype, "deleteRule", {
      before: function(index) {
        checkStyleSheetAndCallback(this, function(id) {
          return cb({ id, removes: [{ index }] });
        });
      }
    })
  ];
  if (typeof CSSGroupingRule !== "undefined") {
    instrumentGroupingCSSRuleClass(CSSGroupingRule);
  } else {
    instrumentGroupingCSSRuleClass(CSSMediaRule);
    instrumentGroupingCSSRuleClass(CSSSupportsRule);
  }
  function instrumentGroupingCSSRuleClass(cls) {
    instrumentationStoppers.push(instrumentMethodAndCallOriginal(cls.prototype, "insertRule", {
      before: function(rule, index) {
        var _this = this;
        checkStyleSheetAndCallback(this.parentStyleSheet, function(id) {
          var path = getPathToNestedCSSRule(_this);
          if (path) {
            path.push(index || 0);
            cb({ id, adds: [{ rule, index: path }] });
          }
        });
      }
    }), instrumentMethodAndCallOriginal(cls.prototype, "deleteRule", {
      before: function(index) {
        var _this = this;
        checkStyleSheetAndCallback(this.parentStyleSheet, function(id) {
          var path = getPathToNestedCSSRule(_this);
          if (path) {
            path.push(index);
            cb({ id, removes: [{ index: path }] });
          }
        });
      }
    }));
  }
  return function() {
    return instrumentationStoppers.forEach(function(stopper) {
      return stopper.stop();
    });
  };
}
function getPathToNestedCSSRule(rule) {
  var path = [];
  var currentRule = rule;
  while (currentRule.parentRule) {
    var rules_1 = Array.from(currentRule.parentRule.cssRules);
    var index_1 = rules_1.indexOf(currentRule);
    path.unshift(index_1);
    currentRule = currentRule.parentRule;
  }
  if (!currentRule.parentStyleSheet) {
    return;
  }
  var rules = Array.from(currentRule.parentStyleSheet.cssRules);
  var index = rules.indexOf(currentRule);
  path.unshift(index);
  return path;
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/observers/mediaInteractionObserver.js
function initMediaInteractionObserver(mediaInteractionCb, defaultPrivacyLevel) {
  var handler = function(event) {
    var target = getEventTarget(event);
    if (!target || getNodePrivacyLevel(target, defaultPrivacyLevel) === NodePrivacyLevel.HIDDEN || !hasSerializedNode(target)) {
      return;
    }
    mediaInteractionCb({
      id: getSerializedNodeId(target),
      type: event.type === "play" ? MediaInteractionType.Play : MediaInteractionType.Pause
    });
  };
  return addEventListeners(document, [
    "play",
    "pause"
    /* DOM_EVENT.PAUSE */
  ], handler, { capture: true, passive: true }).stop;
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/observers/frustrationObserver.js
function initFrustrationObserver(lifeCycle, frustrationCb, recordIds) {
  return lifeCycle.subscribe(10, function(data) {
    var _a2, _b, _c;
    if (data.rawRumEvent.type === "action" && data.rawRumEvent.action.type === "click" && ((_b = (_a2 = data.rawRumEvent.action.frustration) === null || _a2 === void 0 ? void 0 : _a2.type) === null || _b === void 0 ? void 0 : _b.length) && "events" in data.domainContext && ((_c = data.domainContext.events) === null || _c === void 0 ? void 0 : _c.length)) {
      frustrationCb({
        timestamp: data.rawRumEvent.date,
        type: RecordType.FrustrationRecord,
        data: {
          frustrationTypes: data.rawRumEvent.action.frustration.type,
          recordIds: data.domainContext.events.map(function(e) {
            return recordIds.getIdForEvent(e);
          })
        }
      });
    }
  }).unsubscribe;
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/observers/viewportResizeObserver.js
var VISUAL_VIEWPORT_OBSERVER_THRESHOLD = 200;
function initViewportResizeObserver(cb) {
  return initViewportObservable().subscribe(cb).unsubscribe;
}
function initVisualViewportResizeObserver(cb) {
  var visualViewport = window.visualViewport;
  if (!visualViewport) {
    return noop;
  }
  var _a2 = throttle(function() {
    cb(getVisualViewport(visualViewport));
  }, VISUAL_VIEWPORT_OBSERVER_THRESHOLD, {
    trailing: false
  }), updateDimension = _a2.throttled, cancelThrottle = _a2.cancel;
  var removeListener = addEventListeners(visualViewport, [
    "resize",
    "scroll"
    /* DOM_EVENT.SCROLL */
  ], updateDimension, {
    capture: true,
    passive: true
  }).stop;
  return function stop() {
    removeListener();
    cancelThrottle();
  };
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/mutationBatch.js
var MUTATION_PROCESS_MAX_DELAY = 100;
function createMutationBatch(processMutationBatch) {
  var cancelScheduledFlush = noop;
  var pendingMutations = [];
  function flush() {
    cancelScheduledFlush();
    processMutationBatch(pendingMutations);
    pendingMutations = [];
  }
  return {
    addMutations: function(mutations) {
      if (pendingMutations.length === 0) {
        cancelScheduledFlush = requestIdleCallback(flush, { timeout: MUTATION_PROCESS_MAX_DELAY });
      }
      pendingMutations.push.apply(pendingMutations, mutations);
    },
    flush,
    stop: function() {
      cancelScheduledFlush();
    }
  };
}
function requestIdleCallback(callback, opts) {
  if (window.requestIdleCallback && window.cancelIdleCallback) {
    var id_1 = window.requestIdleCallback(monitor(callback), opts);
    return function() {
      return window.cancelIdleCallback(id_1);
    };
  }
  var id = window.requestAnimationFrame(monitor(callback));
  return function() {
    return window.cancelAnimationFrame(id);
  };
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/observers/mutationObserver.js
function initMutationObserver(mutationCallback, configuration, shadowRootsController, target) {
  var MutationObserver = getMutationObserverConstructor();
  if (!MutationObserver) {
    return { stop: noop, flush: noop };
  }
  var mutationBatch = createMutationBatch(function(mutations) {
    processMutations(mutations.concat(observer.takeRecords()), mutationCallback, configuration, shadowRootsController, target);
  });
  var observer = new MutationObserver(monitor(mutationBatch.addMutations));
  observer.observe(target, {
    attributeOldValue: true,
    attributes: true,
    characterData: true,
    characterDataOldValue: true,
    childList: true,
    subtree: true
  });
  return {
    stop: function() {
      observer.disconnect();
      mutationBatch.stop();
    },
    flush: function() {
      mutationBatch.flush();
    }
  };
}
function processMutations(mutations, mutationCallback, configuration, shadowRootsController, target) {
  mutations.filter(function(mutation) {
    return mutation.type === "childList";
  }).forEach(function(mutation) {
    mutation.removedNodes.forEach(function(removedNode) {
      traverseRemovedShadowDom(removedNode, shadowRootsController.removeShadowRoot);
    });
  });
  var filteredMutations = mutations.filter(function(mutation) {
    return target.contains(mutation.target) && nodeAndAncestorsHaveSerializedNode(mutation.target) && getNodePrivacyLevel(mutation.target, configuration.defaultPrivacyLevel) !== NodePrivacyLevel.HIDDEN;
  });
  var _a2 = processChildListMutations(filteredMutations.filter(function(mutation) {
    return mutation.type === "childList";
  }), configuration, shadowRootsController), adds = _a2.adds, removes = _a2.removes, hasBeenSerialized = _a2.hasBeenSerialized;
  var texts = processCharacterDataMutations(filteredMutations.filter(function(mutation) {
    return mutation.type === "characterData" && !hasBeenSerialized(mutation.target);
  }), configuration);
  var attributes = processAttributesMutations(filteredMutations.filter(function(mutation) {
    return mutation.type === "attributes" && !hasBeenSerialized(mutation.target);
  }), configuration);
  if (!texts.length && !attributes.length && !removes.length && !adds.length) {
    return;
  }
  mutationCallback({
    adds,
    removes,
    texts,
    attributes
  });
}
function processChildListMutations(mutations, configuration, shadowRootsController) {
  var addedAndMovedNodes = /* @__PURE__ */ new Set();
  var removedNodes = /* @__PURE__ */ new Map();
  var _loop_1 = function(mutation2) {
    mutation2.addedNodes.forEach(function(node2) {
      addedAndMovedNodes.add(node2);
    });
    mutation2.removedNodes.forEach(function(node2) {
      if (!addedAndMovedNodes.has(node2)) {
        removedNodes.set(node2, mutation2.target);
      }
      addedAndMovedNodes.delete(node2);
    });
  };
  for (var _i = 0, mutations_1 = mutations; _i < mutations_1.length; _i++) {
    var mutation = mutations_1[_i];
    _loop_1(mutation);
  }
  var sortedAddedAndMovedNodes = Array.from(addedAndMovedNodes);
  sortAddedAndMovedNodes(sortedAddedAndMovedNodes);
  var serializedNodeIds2 = /* @__PURE__ */ new Set();
  var addedNodeMutations = [];
  for (var _a2 = 0, sortedAddedAndMovedNodes_1 = sortedAddedAndMovedNodes; _a2 < sortedAddedAndMovedNodes_1.length; _a2++) {
    var node = sortedAddedAndMovedNodes_1[_a2];
    if (hasBeenSerialized(node)) {
      continue;
    }
    var parentNodePrivacyLevel = getNodePrivacyLevel(node.parentNode, configuration.defaultPrivacyLevel);
    if (parentNodePrivacyLevel === NodePrivacyLevel.HIDDEN || parentNodePrivacyLevel === NodePrivacyLevel.IGNORE) {
      continue;
    }
    var serializedNode = serializeNodeWithId(node, {
      serializedNodeIds: serializedNodeIds2,
      parentNodePrivacyLevel,
      serializationContext: { status: 2, shadowRootsController },
      configuration
    });
    if (!serializedNode) {
      continue;
    }
    var parentNode = getParentNode(node);
    addedNodeMutations.push({
      nextId: getNextSibling(node),
      parentId: getSerializedNodeId(parentNode),
      node: serializedNode
    });
  }
  var removedNodeMutations = [];
  removedNodes.forEach(function(parent, node2) {
    if (hasSerializedNode(node2)) {
      removedNodeMutations.push({
        parentId: getSerializedNodeId(parent),
        id: getSerializedNodeId(node2)
      });
    }
  });
  return { adds: addedNodeMutations, removes: removedNodeMutations, hasBeenSerialized };
  function hasBeenSerialized(node2) {
    return hasSerializedNode(node2) && serializedNodeIds2.has(getSerializedNodeId(node2));
  }
  function getNextSibling(node2) {
    var nextSibling = node2.nextSibling;
    while (nextSibling) {
      if (hasSerializedNode(nextSibling)) {
        return getSerializedNodeId(nextSibling);
      }
      nextSibling = nextSibling.nextSibling;
    }
    return null;
  }
}
function processCharacterDataMutations(mutations, configuration) {
  var _a2;
  var textMutations = [];
  var handledNodes = /* @__PURE__ */ new Set();
  var filteredMutations = mutations.filter(function(mutation2) {
    if (handledNodes.has(mutation2.target)) {
      return false;
    }
    handledNodes.add(mutation2.target);
    return true;
  });
  for (var _i = 0, filteredMutations_1 = filteredMutations; _i < filteredMutations_1.length; _i++) {
    var mutation = filteredMutations_1[_i];
    var value = mutation.target.textContent;
    if (value === mutation.oldValue) {
      continue;
    }
    var parentNodePrivacyLevel = getNodePrivacyLevel(getParentNode(mutation.target), configuration.defaultPrivacyLevel);
    if (parentNodePrivacyLevel === NodePrivacyLevel.HIDDEN || parentNodePrivacyLevel === NodePrivacyLevel.IGNORE) {
      continue;
    }
    textMutations.push({
      id: getSerializedNodeId(mutation.target),
      // TODO: pass a valid "ignoreWhiteSpace" argument
      value: (_a2 = getTextContent(mutation.target, false, parentNodePrivacyLevel)) !== null && _a2 !== void 0 ? _a2 : null
    });
  }
  return textMutations;
}
function processAttributesMutations(mutations, configuration) {
  var attributeMutations = [];
  var handledElements = /* @__PURE__ */ new Map();
  var filteredMutations = mutations.filter(function(mutation2) {
    var handledAttributes = handledElements.get(mutation2.target);
    if (handledAttributes === null || handledAttributes === void 0 ? void 0 : handledAttributes.has(mutation2.attributeName)) {
      return false;
    }
    if (!handledAttributes) {
      handledElements.set(mutation2.target, /* @__PURE__ */ new Set([mutation2.attributeName]));
    } else {
      handledAttributes.add(mutation2.attributeName);
    }
    return true;
  });
  var emittedMutations = /* @__PURE__ */ new Map();
  for (var _i = 0, filteredMutations_2 = filteredMutations; _i < filteredMutations_2.length; _i++) {
    var mutation = filteredMutations_2[_i];
    var uncensoredValue = mutation.target.getAttribute(mutation.attributeName);
    if (uncensoredValue === mutation.oldValue) {
      continue;
    }
    var privacyLevel = getNodePrivacyLevel(mutation.target, configuration.defaultPrivacyLevel);
    var attributeValue = serializeAttribute(mutation.target, privacyLevel, mutation.attributeName, configuration);
    var transformedValue = void 0;
    if (mutation.attributeName === "value") {
      var inputValue = getElementInputValue(mutation.target, privacyLevel);
      if (inputValue === void 0) {
        continue;
      }
      transformedValue = inputValue;
    } else if (typeof attributeValue === "string") {
      transformedValue = attributeValue;
    } else {
      transformedValue = null;
    }
    var emittedMutation = emittedMutations.get(mutation.target);
    if (!emittedMutation) {
      emittedMutation = {
        id: getSerializedNodeId(mutation.target),
        attributes: {}
      };
      attributeMutations.push(emittedMutation);
      emittedMutations.set(mutation.target, emittedMutation);
    }
    emittedMutation.attributes[mutation.attributeName] = transformedValue;
  }
  return attributeMutations;
}
function sortAddedAndMovedNodes(nodes) {
  nodes.sort(function(a, b) {
    var position = a.compareDocumentPosition(b);
    if (position & Node.DOCUMENT_POSITION_CONTAINED_BY) {
      return -1;
    } else if (position & Node.DOCUMENT_POSITION_CONTAINS) {
      return 1;
    } else if (position & Node.DOCUMENT_POSITION_FOLLOWING) {
      return 1;
    } else if (position & Node.DOCUMENT_POSITION_PRECEDING) {
      return -1;
    }
    return 0;
  });
}
function traverseRemovedShadowDom(removedNode, shadowDomRemovedCallback) {
  if (isNodeShadowHost(removedNode)) {
    shadowDomRemovedCallback(removedNode.shadowRoot);
  }
  getChildNodes(removedNode).forEach(function(child) {
    return traverseRemovedShadowDom(child, shadowDomRemovedCallback);
  });
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/observers/focusObserver.js
function initFocusObserver(focusCb) {
  return addEventListeners(window, [
    "focus",
    "blur"
    /* DOM_EVENT.BLUR */
  ], function() {
    focusCb({ has_focus: document.hasFocus() });
  }).stop;
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/observers/recordIds.js
function initRecordIds() {
  var recordIds = /* @__PURE__ */ new WeakMap();
  var nextId2 = 1;
  return {
    getIdForEvent: function(event) {
      if (!recordIds.has(event)) {
        recordIds.set(event, nextId2++);
      }
      return recordIds.get(event);
    }
  };
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/observers/observers.js
function initObservers(o) {
  var recordIds = initRecordIds();
  var mutationHandler = initMutationObserver(o.mutationCb, o.configuration, o.shadowRootsController, document);
  var mousemoveHandler = initMoveObserver(o.mousemoveCb);
  var mouseInteractionHandler = initMouseInteractionObserver(o.mouseInteractionCb, o.configuration.defaultPrivacyLevel, recordIds);
  var scrollHandler = initScrollObserver(o.scrollCb, o.configuration.defaultPrivacyLevel, o.elementsScrollPositions);
  var viewportResizeHandler = initViewportResizeObserver(o.viewportResizeCb);
  var inputHandler = initInputObserver(o.inputCb, o.configuration.defaultPrivacyLevel);
  var mediaInteractionHandler = initMediaInteractionObserver(o.mediaInteractionCb, o.configuration.defaultPrivacyLevel);
  var styleSheetObserver = initStyleSheetObserver(o.styleSheetCb);
  var focusHandler = initFocusObserver(o.focusCb);
  var visualViewportResizeHandler = initVisualViewportResizeObserver(o.visualViewportResizeCb);
  var frustrationHandler = initFrustrationObserver(o.lifeCycle, o.frustrationCb, recordIds);
  return {
    flush: function() {
      mutationHandler.flush();
    },
    stop: function() {
      mutationHandler.stop();
      mousemoveHandler();
      mouseInteractionHandler();
      scrollHandler();
      viewportResizeHandler();
      inputHandler();
      mediaInteractionHandler();
      styleSheetObserver();
      focusHandler();
      visualViewportResizeHandler();
      frustrationHandler();
    }
  };
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/elementsScrollPositions.js
function createElementsScrollPositions() {
  var scrollPositionsByElement = /* @__PURE__ */ new WeakMap();
  return {
    set: function(element, scrollPositions) {
      if (element === document && !document.scrollingElement) {
        return;
      }
      scrollPositionsByElement.set(element === document ? document.scrollingElement : element, scrollPositions);
    },
    get: function(element) {
      return scrollPositionsByElement.get(element);
    },
    has: function(element) {
      return scrollPositionsByElement.has(element);
    }
  };
}

// ../../node_modules/@datadog/browser-rum/esm/domain/record/shadowRootsController.js
var initShadowRootsController = function(configuration, _a2) {
  var mutationCb = _a2.mutationCb, inputCb = _a2.inputCb;
  var controllerByShadowRoot = /* @__PURE__ */ new Map();
  var shadowRootsController = {
    addShadowRoot: function(shadowRoot) {
      var _a3 = initMutationObserver(mutationCb, configuration, shadowRootsController, shadowRoot), stopMutationObserver = _a3.stop, flush = _a3.flush;
      var stopInputObserver = initInputObserver(inputCb, configuration.defaultPrivacyLevel, shadowRoot);
      controllerByShadowRoot.set(shadowRoot, {
        flush,
        stop: function() {
          stopMutationObserver();
          stopInputObserver();
        }
      });
    },
    removeShadowRoot: function(shadowRoot) {
      var entry = controllerByShadowRoot.get(shadowRoot);
      if (!entry) {
        return;
      }
      entry.stop();
      controllerByShadowRoot.delete(shadowRoot);
    },
    stop: function() {
      controllerByShadowRoot.forEach(function(_a3) {
        var stop = _a3.stop;
        return stop();
      });
    },
    flush: function() {
      controllerByShadowRoot.forEach(function(_a3) {
        var flush = _a3.flush;
        return flush();
      });
    }
  };
  return shadowRootsController;
};

// ../../node_modules/@datadog/browser-rum/esm/domain/record/record.js
function record(options) {
  var emit = options.emit;
  if (!emit) {
    throw new Error("emit function is required");
  }
  var elementsScrollPositions = createElementsScrollPositions();
  var mutationCb = function(mutation) {
    emit(assembleIncrementalSnapshot(IncrementalSource.Mutation, mutation));
  };
  var inputCb = function(s) {
    return emit(assembleIncrementalSnapshot(IncrementalSource.Input, s));
  };
  var shadowRootsController = initShadowRootsController(options.configuration, { mutationCb, inputCb });
  var takeFullSnapshot = function(timestamp, serializationContext) {
    if (timestamp === void 0) {
      timestamp = timeStampNow();
    }
    if (serializationContext === void 0) {
      serializationContext = {
        status: 0,
        elementsScrollPositions,
        shadowRootsController
      };
    }
    var _a3 = getViewportDimension(), width = _a3.width, height = _a3.height;
    emit({
      data: {
        height,
        href: window.location.href,
        width
      },
      type: RecordType.Meta,
      timestamp
    });
    emit({
      data: {
        has_focus: document.hasFocus()
      },
      type: RecordType.Focus,
      timestamp
    });
    emit({
      data: {
        node: serializeDocument(document, options.configuration, serializationContext),
        initialOffset: {
          left: getScrollX(),
          top: getScrollY()
        }
      },
      type: RecordType.FullSnapshot,
      timestamp
    });
    if (window.visualViewport) {
      emit({
        data: getVisualViewport(window.visualViewport),
        type: RecordType.VisualViewport,
        timestamp
      });
    }
  };
  takeFullSnapshot();
  var _a2 = initObservers({
    lifeCycle: options.lifeCycle,
    configuration: options.configuration,
    elementsScrollPositions,
    inputCb,
    mediaInteractionCb: function(p) {
      return emit(assembleIncrementalSnapshot(IncrementalSource.MediaInteraction, p));
    },
    mouseInteractionCb: function(mouseInteractionRecord) {
      return emit(mouseInteractionRecord);
    },
    mousemoveCb: function(positions, source) {
      return emit(assembleIncrementalSnapshot(source, { positions }));
    },
    mutationCb,
    scrollCb: function(p) {
      return emit(assembleIncrementalSnapshot(IncrementalSource.Scroll, p));
    },
    styleSheetCb: function(r) {
      return emit(assembleIncrementalSnapshot(IncrementalSource.StyleSheetRule, r));
    },
    viewportResizeCb: function(d) {
      return emit(assembleIncrementalSnapshot(IncrementalSource.ViewportResize, d));
    },
    frustrationCb: function(frustrationRecord) {
      return emit(frustrationRecord);
    },
    focusCb: function(data) {
      return emit({
        data,
        type: RecordType.Focus,
        timestamp: timeStampNow()
      });
    },
    visualViewportResizeCb: function(data) {
      emit({
        data,
        type: RecordType.VisualViewport,
        timestamp: timeStampNow()
      });
    },
    shadowRootsController
  }), stopObservers = _a2.stop, flushMutationsFromObservers = _a2.flush;
  function flushMutations() {
    shadowRootsController.flush();
    flushMutationsFromObservers();
  }
  return {
    stop: function() {
      shadowRootsController.stop();
      stopObservers();
    },
    takeSubsequentFullSnapshot: function(timestamp) {
      flushMutations();
      takeFullSnapshot(timestamp, {
        shadowRootsController,
        status: 1,
        elementsScrollPositions
      });
    },
    flushMutations,
    shadowRootsController
  };
}

// ../../node_modules/@datadog/browser-rum/esm/domain/segmentCollection/buildReplayPayload.js
function buildReplayPayload(data, metadata, rawSegmentBytesCount) {
  var formData = new FormData();
  formData.append("segment", new Blob([data], {
    type: "application/octet-stream"
  }), "".concat(metadata.session.id, "-").concat(metadata.start));
  var metadataAndSegmentSizes = assign({
    raw_segment_size: rawSegmentBytesCount,
    compressed_segment_size: data.byteLength
  }, metadata);
  var serializedMetadataAndSegmentSizes = JSON.stringify(metadataAndSegmentSizes);
  formData.append("event", new Blob([serializedMetadataAndSegmentSizes], { type: "application/json" }));
  return { data: formData, bytesCount: data.byteLength };
}

// ../../node_modules/@datadog/browser-rum/esm/domain/replayStats.js
var MAX_STATS_HISTORY = 10;
var statsPerView;
function getSegmentsCount(viewId) {
  return getOrCreateReplayStats(viewId).segments_count;
}
function addSegment(viewId) {
  getOrCreateReplayStats(viewId).segments_count += 1;
}
function addRecord(viewId) {
  getOrCreateReplayStats(viewId).records_count += 1;
}
function addWroteData(viewId, additionalBytesCount) {
  getOrCreateReplayStats(viewId).segments_total_raw_size += additionalBytesCount;
}
function getReplayStats(viewId) {
  return statsPerView === null || statsPerView === void 0 ? void 0 : statsPerView.get(viewId);
}
function getOrCreateReplayStats(viewId) {
  if (!statsPerView) {
    statsPerView = /* @__PURE__ */ new Map();
  }
  var replayStats;
  if (statsPerView.has(viewId)) {
    replayStats = statsPerView.get(viewId);
  } else {
    replayStats = {
      records_count: 0,
      segments_count: 0,
      segments_total_raw_size: 0
    };
    statsPerView.set(viewId, replayStats);
    if (statsPerView.size > MAX_STATS_HISTORY) {
      deleteOldestStats();
    }
  }
  return replayStats;
}
function deleteOldestStats() {
  if (!statsPerView) {
    return;
  }
  if (statsPerView.keys) {
    statsPerView.delete(statsPerView.keys().next().value);
  } else {
    var isFirst_1 = true;
    statsPerView.forEach(function(_value, key) {
      if (isFirst_1) {
        statsPerView.delete(key);
        isFirst_1 = false;
      }
    });
  }
}

// ../../node_modules/@datadog/browser-rum/esm/domain/segmentCollection/segment.js
var STREAM_ID = 1;
var nextId = 0;
var Segment = (
  /** @class */
  function() {
    function Segment2(worker, context, creationReason, initialRecord, onWrote, onFlushed) {
      var _this = this;
      this.worker = worker;
      this.id = nextId++;
      this.pendingWriteCount = 0;
      var viewId = context.view.id;
      this.metadata = assign({
        start: initialRecord.timestamp,
        end: initialRecord.timestamp,
        creation_reason: creationReason,
        records_count: 1,
        has_full_snapshot: initialRecord.type === RecordType.FullSnapshot,
        index_in_view: getSegmentsCount(viewId),
        source: "browser"
      }, context);
      addSegment(viewId);
      addRecord(viewId);
      var rawBytesCount = 0;
      var compressedBytesCount = 0;
      var compressedData = [];
      var removeMessageListener = addEventListener(worker, "message", function(_a2) {
        var data = _a2.data;
        if (data.type !== "wrote") {
          return;
        }
        if (data.id === _this.id) {
          _this.pendingWriteCount -= 1;
          addWroteData(viewId, data.additionalBytesCount);
          rawBytesCount += data.additionalBytesCount;
          compressedBytesCount += data.result.length;
          compressedData.push(data.result);
          if (_this.flushReason && _this.pendingWriteCount === 0) {
            compressedData.push(data.trailer);
            onFlushed(concatBuffers(compressedData), rawBytesCount);
            removeMessageListener();
          } else {
            onWrote(compressedBytesCount);
          }
        } else if (data.id > _this.id) {
          removeMessageListener();
          addTelemetryDebug("Segment did not receive a 'flush' response before being replaced.");
        }
      }).stop;
      sendToExtension("record", { record: initialRecord, segment: this.metadata });
      this.write('{"records":['.concat(JSON.stringify(initialRecord)));
    }
    Segment2.prototype.addRecord = function(record2) {
      var _a2;
      this.metadata.start = Math.min(this.metadata.start, record2.timestamp);
      this.metadata.end = Math.max(this.metadata.end, record2.timestamp);
      this.metadata.records_count += 1;
      addRecord(this.metadata.view.id);
      (_a2 = this.metadata).has_full_snapshot || (_a2.has_full_snapshot = record2.type === RecordType.FullSnapshot);
      sendToExtension("record", { record: record2, segment: this.metadata });
      this.write(",".concat(JSON.stringify(record2)));
    };
    Segment2.prototype.flush = function(reason) {
      this.write("],".concat(JSON.stringify(this.metadata).slice(1), "\n"));
      this.worker.postMessage({
        action: "reset",
        streamId: STREAM_ID
      });
      this.flushReason = reason;
    };
    Segment2.prototype.write = function(data) {
      this.pendingWriteCount += 1;
      this.worker.postMessage({
        data,
        id: this.id,
        streamId: STREAM_ID,
        action: "write"
      });
    };
    return Segment2;
  }()
);

// ../../node_modules/@datadog/browser-rum/esm/domain/segmentCollection/segmentCollection.js
var SEGMENT_DURATION_LIMIT = 30 * ONE_SECOND;
var SEGMENT_BYTES_LIMIT = 6e4;
function startSegmentCollection(lifeCycle, applicationId, sessionManager, viewContexts, httpRequest, worker) {
  return doStartSegmentCollection(lifeCycle, function() {
    return computeSegmentContext(applicationId, sessionManager, viewContexts);
  }, httpRequest, worker);
}
function doStartSegmentCollection(lifeCycle, getSegmentContext, httpRequest, worker) {
  var state2 = {
    status: 0,
    nextSegmentCreationReason: "init"
  };
  var unsubscribeViewCreated = lifeCycle.subscribe(2, function() {
    flushSegment("view_change");
  }).unsubscribe;
  var unsubscribePageExited = lifeCycle.subscribe(9, function(pageExitEvent) {
    flushSegment(pageExitEvent.reason);
  }).unsubscribe;
  function flushSegment(flushReason) {
    if (state2.status === 1) {
      state2.segment.flush(flushReason);
      clearTimeout(state2.expirationTimeoutId);
    }
    if (flushReason !== "stop") {
      state2 = {
        status: 0,
        nextSegmentCreationReason: flushReason
      };
    } else {
      state2 = {
        status: 2
      };
    }
  }
  function createNewSegment(creationReason, initialRecord) {
    var context = getSegmentContext();
    if (!context) {
      return;
    }
    var segment = new Segment(worker, context, creationReason, initialRecord, function(compressedSegmentBytesCount) {
      if (!segment.flushReason && compressedSegmentBytesCount > SEGMENT_BYTES_LIMIT) {
        flushSegment("segment_bytes_limit");
      }
    }, function(data, rawSegmentBytesCount) {
      var payload = buildReplayPayload(data, segment.metadata, rawSegmentBytesCount);
      if (isPageExitReason(segment.flushReason)) {
        httpRequest.sendOnExit(payload);
      } else {
        httpRequest.send(payload);
      }
    });
    state2 = {
      status: 1,
      segment,
      expirationTimeoutId: setTimeout(function() {
        flushSegment("segment_duration_limit");
      }, SEGMENT_DURATION_LIMIT)
    };
  }
  return {
    addRecord: function(record2) {
      switch (state2.status) {
        case 0:
          createNewSegment(state2.nextSegmentCreationReason, record2);
          break;
        case 1:
          state2.segment.addRecord(record2);
          break;
      }
    },
    stop: function() {
      flushSegment("stop");
      unsubscribeViewCreated();
      unsubscribePageExited();
    }
  };
}
function computeSegmentContext(applicationId, sessionManager, viewContexts) {
  var session = sessionManager.findTrackedSession();
  var viewContext = viewContexts.findView();
  if (!session || !viewContext) {
    return void 0;
  }
  return {
    application: {
      id: applicationId
    },
    session: {
      id: session.id
    },
    view: {
      id: viewContext.id
    }
  };
}

// ../../node_modules/@datadog/browser-worker/esm/entries/string.js
var workerString = '!function(){"use strict";function t(t){for(var e=t.reduce((function(t,e){return t+e.length}),0),a=new Uint8Array(e),n=0,r=0,i=t;r<i.length;r++){var s=i[r];a.set(s,n),n+=s.length}return a}function e(t){for(var e=t.length;--e>=0;)t[e]=0}var a=256,n=286,r=30,i=15,s=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),_=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),l=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=new Array(576);e(o);var d=new Array(60);e(d);var u=new Array(512);e(u);var f=new Array(256);e(f);var c=new Array(29);e(c);var p,g,w,v=new Array(r);function b(t,e,a,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=a,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}function m(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}e(v);var y=function(t){return t<256?u[t]:u[256+(t>>>7)]},k=function(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},z=function(t,e,a){t.bi_valid>16-a?(t.bi_buf|=e<<t.bi_valid&65535,k(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=a-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=a)},x=function(t,e,a){z(t,a[2*e],a[2*e+1])},A=function(t,e){var a=0;do{a|=1&t,t>>>=1,a<<=1}while(--e>0);return a>>>1},E=function(t,e,a){var n,r,s=new Array(16),_=0;for(n=1;n<=i;n++)s[n]=_=_+a[n-1]<<1;for(r=0;r<=e;r++){var h=t[2*r+1];0!==h&&(t[2*r]=A(s[h]++,h))}},Z=function(t){var e;for(e=0;e<n;e++)t.dyn_ltree[2*e]=0;for(e=0;e<r;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},U=function(t){t.bi_valid>8?k(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},S=function(t,e,a,n){var r=2*e,i=2*a;return t[r]<t[i]||t[r]===t[i]&&n[e]<=n[a]},R=function(t,e,a){for(var n=t.heap[a],r=a<<1;r<=t.heap_len&&(r<t.heap_len&&S(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!S(e,n,t.heap[r],t.depth));)t.heap[a]=t.heap[r],a=r,r<<=1;t.heap[a]=n},L=function(t,e,n){var r,i,h,l,o=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],i=t.pending_buf[t.l_buf+o],o++,0===r?x(t,i,e):(h=f[i],x(t,h+a+1,e),0!==(l=s[h])&&(i-=c[h],z(t,i,l)),r--,h=y(r),x(t,h,n),0!==(l=_[h])&&(r-=v[h],z(t,r,l)))}while(o<t.last_lit);x(t,256,e)},F=function(t,e){var a,n,r,s=e.dyn_tree,_=e.stat_desc.static_tree,h=e.stat_desc.has_stree,l=e.stat_desc.elems,o=-1;for(t.heap_len=0,t.heap_max=573,a=0;a<l;a++)0!==s[2*a]?(t.heap[++t.heap_len]=o=a,t.depth[a]=0):s[2*a+1]=0;for(;t.heap_len<2;)s[2*(r=t.heap[++t.heap_len]=o<2?++o:0)]=1,t.depth[r]=0,t.opt_len--,h&&(t.static_len-=_[2*r+1]);for(e.max_code=o,a=t.heap_len>>1;a>=1;a--)R(t,s,a);r=l;do{a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],R(t,s,1),n=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=n,s[2*r]=s[2*a]+s[2*n],t.depth[r]=(t.depth[a]>=t.depth[n]?t.depth[a]:t.depth[n])+1,s[2*a+1]=s[2*n+1]=r,t.heap[1]=r++,R(t,s,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var a,n,r,s,_,h,l=e.dyn_tree,o=e.max_code,d=e.stat_desc.static_tree,u=e.stat_desc.has_stree,f=e.stat_desc.extra_bits,c=e.stat_desc.extra_base,p=e.stat_desc.max_length,g=0;for(s=0;s<=i;s++)t.bl_count[s]=0;for(l[2*t.heap[t.heap_max]+1]=0,a=t.heap_max+1;a<573;a++)(s=l[2*l[2*(n=t.heap[a])+1]+1]+1)>p&&(s=p,g++),l[2*n+1]=s,n>o||(t.bl_count[s]++,_=0,n>=c&&(_=f[n-c]),h=l[2*n],t.opt_len+=h*(s+_),u&&(t.static_len+=h*(d[2*n+1]+_)));if(0!==g){do{for(s=p-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[p]--,g-=2}while(g>0);for(s=p;0!==s;s--)for(n=t.bl_count[s];0!==n;)(r=t.heap[--a])>o||(l[2*r+1]!==s&&(t.opt_len+=(s-l[2*r+1])*l[2*r],l[2*r+1]=s),n--)}}(t,e),E(s,o,t.bl_count)},T=function(t,e,a){var n,r,i=-1,s=e[1],_=0,h=7,l=4;for(0===s&&(h=138,l=3),e[2*(a+1)+1]=65535,n=0;n<=a;n++)r=s,s=e[2*(n+1)+1],++_<h&&r===s||(_<l?t.bl_tree[2*r]+=_:0!==r?(r!==i&&t.bl_tree[2*r]++,t.bl_tree[32]++):_<=10?t.bl_tree[34]++:t.bl_tree[36]++,_=0,i=r,0===s?(h=138,l=3):r===s?(h=6,l=3):(h=7,l=4))},I=function(t,e,a){var n,r,i=-1,s=e[1],_=0,h=7,l=4;for(0===s&&(h=138,l=3),n=0;n<=a;n++)if(r=s,s=e[2*(n+1)+1],!(++_<h&&r===s)){if(_<l)do{x(t,r,t.bl_tree)}while(0!=--_);else 0!==r?(r!==i&&(x(t,r,t.bl_tree),_--),x(t,16,t.bl_tree),z(t,_-3,2)):_<=10?(x(t,17,t.bl_tree),z(t,_-3,3)):(x(t,18,t.bl_tree),z(t,_-11,7));_=0,i=r,0===s?(h=138,l=3):r===s?(h=6,l=3):(h=7,l=4)}},N=!1,O=function(t,e,a,n){z(t,0+(n?1:0),3),function(t,e,a,n){U(t),n&&(k(t,a),k(t,~a)),t.pending_buf.set(t.window.subarray(e,e+a),t.pending),t.pending+=a}(t,e,a,!0)},D=function(t,e,n,r){var i,s,_=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<a;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),F(t,t.l_desc),F(t,t.d_desc),_=function(t){var e;for(T(t,t.dyn_ltree,t.l_desc.max_code),T(t,t.dyn_dtree,t.d_desc.max_code),F(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*l[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),i=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=i&&(i=s)):i=s=n+5,n+4<=i&&-1!==e?O(t,e,n,r):4===t.strategy||s===i?(z(t,2+(r?1:0),3),L(t,o,d)):(z(t,4+(r?1:0),3),function(t,e,a,n){var r;for(z(t,e-257,5),z(t,a-1,5),z(t,n-4,4),r=0;r<n;r++)z(t,t.bl_tree[2*l[r]+1],3);I(t,t.dyn_ltree,e-1),I(t,t.dyn_dtree,a-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,_+1),L(t,t.dyn_ltree,t.dyn_dtree)),Z(t),r&&U(t)},B={_tr_init:function(t){N||(!function(){var t,e,a,l,m,y=new Array(16);for(a=0,l=0;l<28;l++)for(c[l]=a,t=0;t<1<<s[l];t++)f[a++]=l;for(f[a-1]=l,m=0,l=0;l<16;l++)for(v[l]=m,t=0;t<1<<_[l];t++)u[m++]=l;for(m>>=7;l<r;l++)for(v[l]=m<<7,t=0;t<1<<_[l]-7;t++)u[256+m++]=l;for(e=0;e<=i;e++)y[e]=0;for(t=0;t<=143;)o[2*t+1]=8,t++,y[8]++;for(;t<=255;)o[2*t+1]=9,t++,y[9]++;for(;t<=279;)o[2*t+1]=7,t++,y[7]++;for(;t<=287;)o[2*t+1]=8,t++,y[8]++;for(E(o,287,y),t=0;t<r;t++)d[2*t+1]=5,d[2*t]=A(t,5);p=new b(o,s,257,n,i),g=new b(d,_,0,r,i),w=new b(new Array(0),h,0,19,7)}(),N=!0),t.l_desc=new m(t.dyn_ltree,p),t.d_desc=new m(t.dyn_dtree,g),t.bl_desc=new m(t.bl_tree,w),t.bi_buf=0,t.bi_valid=0,Z(t)},_tr_stored_block:O,_tr_flush_block:D,_tr_tally:function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(f[n]+a+1)]++,t.dyn_dtree[2*y(e)]++),t.last_lit===t.lit_bufsize-1},_tr_align:function(t){z(t,2,3),x(t,256,o),function(t){16===t.bi_valid?(k(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},C=function(t,e,a,n){for(var r=65535&t|0,i=t>>>16&65535|0,s=0;0!==a;){a-=s=a>2e3?2e3:a;do{i=i+(r=r+e[n++]|0)|0}while(--s);r%=65521,i%=65521}return r|i<<16|0},H=new Uint32Array(function(){for(var t,e=[],a=0;a<256;a++){t=a;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[a]=t}return e}()),M=function(t,e,a,n){var r=H,i=n+a;t^=-1;for(var s=n;s<i;s++)t=t>>>8^r[255&(t^e[s])];return-1^t},Y={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},K={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},P=B._tr_init,j=B._tr_stored_block,G=B._tr_flush_block,X=B._tr_tally,W=B._tr_align,q=K.Z_NO_FLUSH,J=K.Z_PARTIAL_FLUSH,Q=K.Z_FULL_FLUSH,V=K.Z_FINISH,$=K.Z_BLOCK,tt=K.Z_OK,et=K.Z_STREAM_END,at=K.Z_STREAM_ERROR,nt=K.Z_DATA_ERROR,rt=K.Z_BUF_ERROR,it=K.Z_DEFAULT_COMPRESSION,st=K.Z_FILTERED,_t=K.Z_HUFFMAN_ONLY,ht=K.Z_RLE,lt=K.Z_FIXED,ot=K.Z_DEFAULT_STRATEGY,dt=K.Z_UNKNOWN,ut=K.Z_DEFLATED,ft=258,ct=262,pt=103,gt=113,wt=666,vt=function(t,e){return t.msg=Y[e],e},bt=function(t){return(t<<1)-(t>4?9:0)},mt=function(t){for(var e=t.length;--e>=0;)t[e]=0},yt=function(t,e,a){return(e<<t.hash_shift^a)&t.hash_mask},kt=function(t){var e=t.state,a=e.pending;a>t.avail_out&&(a=t.avail_out),0!==a&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+a),t.next_out),t.next_out+=a,e.pending_out+=a,t.total_out+=a,t.avail_out-=a,e.pending-=a,0===e.pending&&(e.pending_out=0))},zt=function(t,e){G(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,kt(t.strm)},xt=function(t,e){t.pending_buf[t.pending++]=e},At=function(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},Et=function(t,e){var a,n,r=t.max_chain_length,i=t.strstart,s=t.prev_length,_=t.nice_match,h=t.strstart>t.w_size-ct?t.strstart-(t.w_size-ct):0,l=t.window,o=t.w_mask,d=t.prev,u=t.strstart+ft,f=l[i+s-1],c=l[i+s];t.prev_length>=t.good_match&&(r>>=2),_>t.lookahead&&(_=t.lookahead);do{if(l[(a=e)+s]===c&&l[a+s-1]===f&&l[a]===l[i]&&l[++a]===l[i+1]){i+=2,a++;do{}while(l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&l[++i]===l[++a]&&i<u);if(n=ft-(u-i),i=u-ft,n>s){if(t.match_start=e,s=n,n>=_)break;f=l[i+s-1],c=l[i+s]}}}while((e=d[e&o])>h&&0!=--r);return s<=t.lookahead?s:t.lookahead},Zt=function(t){var e,a,n,r,i,s,_,h,l,o,d=t.w_size;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=d+(d-ct)){t.window.set(t.window.subarray(d,d+d),0),t.match_start-=d,t.strstart-=d,t.block_start-=d,e=a=t.hash_size;do{n=t.head[--e],t.head[e]=n>=d?n-d:0}while(--a);e=a=d;do{n=t.prev[--e],t.prev[e]=n>=d?n-d:0}while(--a);r+=d}if(0===t.strm.avail_in)break;if(s=t.strm,_=t.window,h=t.strstart+t.lookahead,l=r,o=void 0,(o=s.avail_in)>l&&(o=l),a=0===o?0:(s.avail_in-=o,_.set(s.input.subarray(s.next_in,s.next_in+o),h),1===s.state.wrap?s.adler=C(s.adler,_,o,h):2===s.state.wrap&&(s.adler=M(s.adler,_,o,h)),s.next_in+=o,s.total_in+=o,o),t.lookahead+=a,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=yt(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=yt(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<ct&&0!==t.strm.avail_in)},Ut=function(t,e){for(var a,n;;){if(t.lookahead<ct){if(Zt(t),t.lookahead<ct&&e===q)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=yt(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==a&&t.strstart-a<=t.w_size-ct&&(t.match_length=Et(t,a)),t.match_length>=3)if(n=X(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=yt(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=yt(t,t.ins_h,t.window[t.strstart+1]);else n=X(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(zt(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===V?(zt(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(zt(t,!1),0===t.strm.avail_out)?1:2},St=function(t,e){for(var a,n,r;;){if(t.lookahead<ct){if(Zt(t),t.lookahead<ct&&e===q)return 1;if(0===t.lookahead)break}if(a=0,t.lookahead>=3&&(t.ins_h=yt(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==a&&t.prev_length<t.max_lazy_match&&t.strstart-a<=t.w_size-ct&&(t.match_length=Et(t,a),t.match_length<=5&&(t.strategy===st||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,n=X(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=yt(t,t.ins_h,t.window[t.strstart+3-1]),a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(zt(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((n=X(t,0,t.window[t.strstart-1]))&&zt(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=X(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===V?(zt(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(zt(t,!1),0===t.strm.avail_out)?1:2};function Rt(t,e,a,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=a,this.max_chain=n,this.func=r}var Lt=[new Rt(0,0,0,0,(function(t,e){var a=65535;for(a>t.pending_buf_size-5&&(a=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Zt(t),0===t.lookahead&&e===q)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+a;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,zt(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-ct&&(zt(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===V?(zt(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(zt(t,!1),t.strm.avail_out),1)})),new Rt(4,4,8,4,Ut),new Rt(4,5,16,8,Ut),new Rt(4,6,32,32,Ut),new Rt(4,4,16,16,St),new Rt(8,16,32,32,St),new Rt(8,16,128,128,St),new Rt(8,32,128,256,St),new Rt(32,128,258,1024,St),new Rt(32,258,258,4096,St)];function Ft(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ut,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),mt(this.dyn_ltree),mt(this.dyn_dtree),mt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),mt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),mt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Tt=function(t){if(!t||!t.state)return vt(t,at);t.total_in=t.total_out=0,t.data_type=dt;var e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:gt,t.adler=2===e.wrap?0:1,e.last_flush=q,P(e),tt},It=function(t){var e,a=Tt(t);return a===tt&&((e=t.state).window_size=2*e.w_size,mt(e.head),e.max_lazy_match=Lt[e.level].max_lazy,e.good_match=Lt[e.level].good_length,e.nice_match=Lt[e.level].nice_length,e.max_chain_length=Lt[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),a},Nt=function(t,e,a,n,r,i){if(!t)return at;var s=1;if(e===it&&(e=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),r<1||r>9||a!==ut||n<8||n>15||e<0||e>9||i<0||i>lt)return vt(t,at);8===n&&(n=9);var _=new Ft;return t.state=_,_.strm=t,_.wrap=s,_.gzhead=null,_.w_bits=n,_.w_size=1<<_.w_bits,_.w_mask=_.w_size-1,_.hash_bits=r+7,_.hash_size=1<<_.hash_bits,_.hash_mask=_.hash_size-1,_.hash_shift=~~((_.hash_bits+3-1)/3),_.window=new Uint8Array(2*_.w_size),_.head=new Uint16Array(_.hash_size),_.prev=new Uint16Array(_.w_size),_.lit_bufsize=1<<r+6,_.pending_buf_size=4*_.lit_bufsize,_.pending_buf=new Uint8Array(_.pending_buf_size),_.d_buf=1*_.lit_bufsize,_.l_buf=3*_.lit_bufsize,_.level=e,_.strategy=i,_.method=a,It(t)},Ot={deflateInit:function(t,e){return Nt(t,e,ut,15,8,ot)},deflateInit2:Nt,deflateReset:It,deflateResetKeep:Tt,deflateSetHeader:function(t,e){return t&&t.state?2!==t.state.wrap?at:(t.state.gzhead=e,tt):at},deflate:function(t,e){var a,n;if(!t||!t.state||e>$||e<0)return t?vt(t,at):at;var r=t.state;if(!t.output||!t.input&&0!==t.avail_in||r.status===wt&&e!==V)return vt(t,0===t.avail_out?rt:at);r.strm=t;var i=r.last_flush;if(r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,xt(r,31),xt(r,139),xt(r,8),r.gzhead?(xt(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),xt(r,255&r.gzhead.time),xt(r,r.gzhead.time>>8&255),xt(r,r.gzhead.time>>16&255),xt(r,r.gzhead.time>>24&255),xt(r,9===r.level?2:r.strategy>=_t||r.level<2?4:0),xt(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(xt(r,255&r.gzhead.extra.length),xt(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=M(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(xt(r,0),xt(r,0),xt(r,0),xt(r,0),xt(r,0),xt(r,9===r.level?2:r.strategy>=_t||r.level<2?4:0),xt(r,3),r.status=gt);else{var s=ut+(r.w_bits-8<<4)<<8;s|=(r.strategy>=_t||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(s|=32),s+=31-s%31,r.status=gt,At(r,s),0!==r.strstart&&(At(r,t.adler>>>16),At(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(t.adler=M(t.adler,r.pending_buf,r.pending-a,a)),kt(t),a=r.pending,r.pending!==r.pending_buf_size));)xt(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(t.adler=M(t.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(t.adler=M(t.adler,r.pending_buf,r.pending-a,a)),kt(t),a=r.pending,r.pending===r.pending_buf_size)){n=1;break}n=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,xt(r,n)}while(0!==n);r.gzhead.hcrc&&r.pending>a&&(t.adler=M(t.adler,r.pending_buf,r.pending-a,a)),0===n&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(t.adler=M(t.adler,r.pending_buf,r.pending-a,a)),kt(t),a=r.pending,r.pending===r.pending_buf_size)){n=1;break}n=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,xt(r,n)}while(0!==n);r.gzhead.hcrc&&r.pending>a&&(t.adler=M(t.adler,r.pending_buf,r.pending-a,a)),0===n&&(r.status=pt)}else r.status=pt;if(r.status===pt&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&kt(t),r.pending+2<=r.pending_buf_size&&(xt(r,255&t.adler),xt(r,t.adler>>8&255),t.adler=0,r.status=gt)):r.status=gt),0!==r.pending){if(kt(t),0===t.avail_out)return r.last_flush=-1,tt}else if(0===t.avail_in&&bt(e)<=bt(i)&&e!==V)return vt(t,rt);if(r.status===wt&&0!==t.avail_in)return vt(t,rt);if(0!==t.avail_in||0!==r.lookahead||e!==q&&r.status!==wt){var _=r.strategy===_t?function(t,e){for(var a;;){if(0===t.lookahead&&(Zt(t),0===t.lookahead)){if(e===q)return 1;break}if(t.match_length=0,a=X(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,a&&(zt(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===V?(zt(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(zt(t,!1),0===t.strm.avail_out)?1:2}(r,e):r.strategy===ht?function(t,e){for(var a,n,r,i,s=t.window;;){if(t.lookahead<=ft){if(Zt(t),t.lookahead<=ft&&e===q)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(n=s[r=t.strstart-1])===s[++r]&&n===s[++r]&&n===s[++r]){i=t.strstart+ft;do{}while(n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&n===s[++r]&&r<i);t.match_length=ft-(i-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(a=X(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(a=X(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),a&&(zt(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===V?(zt(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(zt(t,!1),0===t.strm.avail_out)?1:2}(r,e):Lt[r.level].func(r,e);if(3!==_&&4!==_||(r.status=wt),1===_||3===_)return 0===t.avail_out&&(r.last_flush=-1),tt;if(2===_&&(e===J?W(r):e!==$&&(j(r,0,0,!1),e===Q&&(mt(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),kt(t),0===t.avail_out))return r.last_flush=-1,tt}return e!==V?tt:r.wrap<=0?et:(2===r.wrap?(xt(r,255&t.adler),xt(r,t.adler>>8&255),xt(r,t.adler>>16&255),xt(r,t.adler>>24&255),xt(r,255&t.total_in),xt(r,t.total_in>>8&255),xt(r,t.total_in>>16&255),xt(r,t.total_in>>24&255)):(At(r,t.adler>>>16),At(r,65535&t.adler)),kt(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?tt:et)},deflateEnd:function(t){if(!t||!t.state)return at;var e=t.state.status;return 42!==e&&69!==e&&73!==e&&91!==e&&e!==pt&&e!==gt&&e!==wt?vt(t,at):(t.state=null,e===gt?vt(t,nt):tt)},deflateSetDictionary:function(t,e){var a=e.length;if(!t||!t.state)return at;var n=t.state,r=n.wrap;if(2===r||1===r&&42!==n.status||n.lookahead)return at;if(1===r&&(t.adler=C(t.adler,e,a,0)),n.wrap=0,a>=n.w_size){0===r&&(mt(n.head),n.strstart=0,n.block_start=0,n.insert=0);var i=new Uint8Array(n.w_size);i.set(e.subarray(a-n.w_size,a),0),e=i,a=n.w_size}var s=t.avail_in,_=t.next_in,h=t.input;for(t.avail_in=a,t.next_in=0,t.input=e,Zt(n);n.lookahead>=3;){var l=n.strstart,o=n.lookahead-2;do{n.ins_h=yt(n,n.ins_h,n.window[l+3-1]),n.prev[l&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=l,l++}while(--o);n.strstart=l,n.lookahead=2,Zt(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=_,t.input=h,t.avail_in=s,n.wrap=r,tt},deflateInfo:"pako deflate (from Nodeca project)"};for(var Dt=new Uint8Array(256),Bt=0;Bt<256;Bt++)Dt[Bt]=Bt>=252?6:Bt>=248?5:Bt>=240?4:Bt>=224?3:Bt>=192?2:1;Dt[254]=Dt[254]=1;var Ct=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Ht=Object.prototype.toString,Mt=K.Z_NO_FLUSH,Yt=K.Z_SYNC_FLUSH,Kt=K.Z_FULL_FLUSH,Pt=K.Z_FINISH,jt=K.Z_OK,Gt=K.Z_STREAM_END,Xt=K.Z_DEFAULT_COMPRESSION,Wt=K.Z_DEFAULT_STRATEGY,qt=K.Z_DEFLATED;function Jt(){this.options={level:Xt,method:qt,chunkSize:16384,windowBits:15,memLevel:8,strategy:Wt};var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ct,this.strm.avail_out=0;var e=Ot.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==jt)throw new Error(Y[e]);if(t.header&&Ot.deflateSetHeader(this.strm,t.header),t.dictionary){var a;if(a="[object ArrayBuffer]"===Ht.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(e=Ot.deflateSetDictionary(this.strm,a))!==jt)throw new Error(Y[e]);this._dict_set=!0}}function Qt(t,e,a){try{t.postMessage({type:"errored",error:e,streamId:a})}catch(n){t.postMessage({type:"errored",error:String(e),streamId:a})}}function Vt(t){var e=t.strm.adler;return new Uint8Array([3,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e])}Jt.prototype.push=function(t,e){var a,n,r=this.strm,i=this.options.chunkSize;if(this.ended)return!1;for(n=e===~~e?e:!0===e?Pt:Mt,"[object ArrayBuffer]"===Ht.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),(n===Yt||n===Kt)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if((a=Ot.deflate(r,n))===Gt)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),a=Ot.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===jt;if(0!==r.avail_out){if(n>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Jt.prototype.onData=function(t){this.chunks.push(t)},Jt.prototype.onEnd=function(t){t===jt&&(this.result=function(t){for(var e=0,a=0,n=t.length;a<n;a++)e+=t[a].length;for(var r=new Uint8Array(e),i=0,s=0,_=t.length;i<_;i++){var h=t[i];r.set(h,s),s+=h.length}return r}(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},function(e){void 0===e&&(e=self);try{var a=new Map;e.addEventListener("message",(function(n){try{var r=function(e,a){switch(a.action){case"init":return{type:"initialized",version:"4.46.0"};case"write":var n=e.get(a.streamId);n||(n=new Jt,e.set(a.streamId,n));var r=n.chunks.length,i=function(t){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);var e,a,n,r,i,s=t.length,_=0;for(r=0;r<s;r++)55296==(64512&(a=t.charCodeAt(r)))&&r+1<s&&56320==(64512&(n=t.charCodeAt(r+1)))&&(a=65536+(a-55296<<10)+(n-56320),r++),_+=a<128?1:a<2048?2:a<65536?3:4;for(e=new Uint8Array(_),i=0,r=0;i<_;r++)55296==(64512&(a=t.charCodeAt(r)))&&r+1<s&&56320==(64512&(n=t.charCodeAt(r+1)))&&(a=65536+(a-55296<<10)+(n-56320),r++),a<128?e[i++]=a:a<2048?(e[i++]=192|a>>>6,e[i++]=128|63&a):a<65536?(e[i++]=224|a>>>12,e[i++]=128|a>>>6&63,e[i++]=128|63&a):(e[i++]=240|a>>>18,e[i++]=128|a>>>12&63,e[i++]=128|a>>>6&63,e[i++]=128|63&a);return e}(a.data);return n.push(i,K.Z_SYNC_FLUSH),{type:"wrote",id:a.id,streamId:a.streamId,result:t(n.chunks.slice(r)),trailer:Vt(n),additionalBytesCount:i.length};case"reset":e.delete(a.streamId)}}(a,n.data);r&&e.postMessage(r)}catch(t){Qt(e,t,n.data&&"streamId"in n.data?n.data.streamId:void 0)}}))}catch(t){Qt(e,t)}}()}();';

// ../../node_modules/@datadog/browser-rum/esm/domain/segmentCollection/startDeflateWorker.js
var workerURL;
function createDeflateWorker() {
  if (!workerURL) {
    workerURL = URL.createObjectURL(new Blob([workerString]));
  }
  return new Worker(workerURL);
}
var state = {
  status: 0
  /* DeflateWorkerStatus.Nil */
};
function startDeflateWorker(callback, createDeflateWorkerImpl) {
  if (createDeflateWorkerImpl === void 0) {
    createDeflateWorkerImpl = createDeflateWorker;
  }
  switch (state.status) {
    case 0:
      state = { status: 1, callbacks: [callback] };
      doStartDeflateWorker(createDeflateWorkerImpl);
      break;
    case 1:
      state.callbacks.push(callback);
      break;
    case 2:
      callback();
      break;
    case 3:
      callback(state.worker);
      break;
  }
}
function doStartDeflateWorker(createDeflateWorkerImpl) {
  if (createDeflateWorkerImpl === void 0) {
    createDeflateWorkerImpl = createDeflateWorker;
  }
  try {
    var worker_1 = createDeflateWorkerImpl();
    addEventListener(worker_1, "error", onError);
    addEventListener(worker_1, "message", function(_a2) {
      var data = _a2.data;
      if (data.type === "errored") {
        onError(data.error, data.streamId);
      } else if (data.type === "initialized") {
        onInitialized(worker_1, data.version);
      }
    });
    worker_1.postMessage({ action: "init" });
    return worker_1;
  } catch (error) {
    onError(error);
  }
}
function onInitialized(worker, version) {
  if (state.status === 1) {
    state.callbacks.forEach(function(callback) {
      return callback(worker);
    });
    state = { status: 3, worker, version };
  }
}
function onError(error, streamId) {
  if (state.status === 1) {
    display.error("Session Replay recording failed to start: an error occurred while creating the Worker:", error);
    if (error instanceof Event || error instanceof Error && isMessageCspRelated(error.message)) {
      display.error("Please make sure CSP is correctly configured https://docs.datadoghq.com/real_user_monitoring/faq/content_security_policy");
    } else {
      addTelemetryError(error);
    }
    state.callbacks.forEach(function(callback) {
      return callback();
    });
    state = {
      status: 2
      /* DeflateWorkerStatus.Error */
    };
  } else {
    addTelemetryError(error, {
      worker_version: state.status === 3 && state.version,
      stream_id: streamId
    });
  }
}
function isMessageCspRelated(message) {
  return includes(message, "Content Security Policy") || // Related to `require-trusted-types-for` CSP: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/require-trusted-types-for
  includes(message, "requires 'TrustedScriptURL'");
}

// ../../node_modules/@datadog/browser-rum/esm/boot/startRecording.js
function startRecording(lifeCycle, configuration, sessionManager, viewContexts, worker, httpRequest) {
  var reportError = function(error) {
    lifeCycle.notify(12, { error });
    addTelemetryDebug("Error reported to customer", { "error.message": error.message });
  };
  var replayRequest = httpRequest || createHttpRequest(configuration.sessionReplayEndpointBuilder, SEGMENT_BYTES_LIMIT, reportError);
  var _a2 = startSegmentCollection(lifeCycle, configuration.applicationId, sessionManager, viewContexts, replayRequest, worker), addRecord2 = _a2.addRecord, stopSegmentCollection = _a2.stop;
  var _b = record({
    emit: addRecord2,
    configuration,
    lifeCycle
  }), stopRecording = _b.stop, takeSubsequentFullSnapshot = _b.takeSubsequentFullSnapshot, flushMutations = _b.flushMutations;
  var unsubscribeViewEnded = lifeCycle.subscribe(4, function() {
    flushMutations();
    addRecord2({
      timestamp: timeStampNow(),
      type: RecordType.ViewEnd
    });
  }).unsubscribe;
  var unsubscribeViewCreated = lifeCycle.subscribe(2, function(view) {
    takeSubsequentFullSnapshot(view.startClocks.timeStamp);
  }).unsubscribe;
  return {
    stop: function() {
      unsubscribeViewEnded();
      unsubscribeViewCreated();
      stopRecording();
      stopSegmentCollection();
    }
  };
}

// ../../node_modules/@datadog/browser-rum/esm/boot/isBrowserSupported.js
function isBrowserSupported() {
  return (
    // Array.from is a bit less supported by browsers than CSSSupportsRule, but has higher chances
    // to be polyfilled. Test for both to be more confident. We could add more things if we find out
    // this test is not sufficient.
    typeof Array.from === "function" && typeof CSSSupportsRule === "function" && typeof URL.createObjectURL === "function" && "forEach" in NodeList.prototype
  );
}

// ../../node_modules/@datadog/browser-rum/esm/domain/getSessionReplayLink.js
function getSessionReplayLink(configuration, sessionManager, viewContexts, isRecordingStarted) {
  var session = sessionManager.findTrackedSession();
  var errorType = getErrorType(session, isRecordingStarted);
  var viewContext = viewContexts.findView();
  return getSessionReplayUrl(configuration, {
    viewContext,
    errorType,
    session
  });
}
function getErrorType(session, isRecordingStarted) {
  if (!isBrowserSupported()) {
    return "browser-not-supported";
  }
  if (!session) {
    return "rum-not-tracked";
  }
  if (!session.sessionReplayAllowed) {
    return "incorrect-session-plan";
  }
  if (!isRecordingStarted) {
    return "replay-not-started";
  }
}

// ../../node_modules/@datadog/browser-rum/esm/boot/recorderApi.js
function makeRecorderApi(startRecordingImpl, startDeflateWorkerImpl) {
  if (startDeflateWorkerImpl === void 0) {
    startDeflateWorkerImpl = startDeflateWorker;
  }
  var recorderStartObservable = new Observable();
  if (canUseEventBridge() || !isBrowserSupported()) {
    return {
      start: noop,
      stop: noop,
      getReplayStats: function() {
        return void 0;
      },
      onRumStart: noop,
      isRecording: function() {
        return false;
      },
      getSessionReplayLink: function() {
        return void 0;
      },
      getSerializedNodeId: function() {
        return void 0;
      },
      recorderStartObservable
    };
  }
  var state2 = {
    status: 0
  };
  var startStrategy = function() {
    state2 = {
      status: 1
      /* RecorderStatus.IntentToStart */
    };
  };
  var stopStrategy = function() {
    state2 = {
      status: 0
      /* RecorderStatus.Stopped */
    };
  };
  return {
    start: function() {
      return startStrategy();
    },
    stop: function() {
      return stopStrategy();
    },
    getReplayStats,
    getSessionReplayLink: function(configuration, sessionManager, viewContexts) {
      return getSessionReplayLink(
        configuration,
        sessionManager,
        viewContexts,
        state2.status !== 0
        /* RecorderStatus.Stopped */
      );
    },
    recorderStartObservable,
    getSerializedNodeId,
    onRumStart: function(lifeCycle, configuration, sessionManager, viewContexts) {
      lifeCycle.subscribe(7, function() {
        if (state2.status === 2 || state2.status === 3) {
          stopStrategy();
          state2 = {
            status: 1
            /* RecorderStatus.IntentToStart */
          };
        }
      });
      lifeCycle.subscribe(8, function() {
        if (state2.status === 1) {
          startStrategy();
        }
      });
      startStrategy = function() {
        var session = sessionManager.findTrackedSession();
        if (!session || !session.sessionReplayAllowed) {
          state2 = {
            status: 1
            /* RecorderStatus.IntentToStart */
          };
          return;
        }
        if (state2.status === 2 || state2.status === 3) {
          return;
        }
        state2 = {
          status: 2
          /* RecorderStatus.Starting */
        };
        runOnReadyState("interactive", function() {
          if (state2.status !== 2) {
            return;
          }
          startDeflateWorkerImpl(function(worker) {
            if (state2.status !== 2) {
              return;
            }
            if (!worker) {
              state2 = {
                status: 0
              };
              return;
            }
            var stopRecording = startRecordingImpl(lifeCycle, configuration, sessionManager, viewContexts, worker).stop;
            recorderStartObservable.notify(relativeNow());
            state2 = {
              status: 3,
              stopRecording
            };
          });
        });
      };
      stopStrategy = function() {
        if (state2.status === 0) {
          return;
        }
        if (state2.status === 3) {
          state2.stopRecording();
        }
        state2 = {
          status: 0
        };
      };
      if (state2.status === 1) {
        startStrategy();
      }
    },
    isRecording: function() {
      return state2.status === 3;
    }
  };
}

// ../../node_modules/@datadog/browser-rum/esm/entries/main.js
var recorderApi = makeRecorderApi(startRecording);
var datadogRum = makeRumPublicApi(startRum, recorderApi);
defineGlobal(getGlobalObject(), "DD_RUM", datadogRum);
export {
  DefaultPrivacyLevel,
  datadogRum
};
//# sourceMappingURL=@datadog_browser-rum.js.map
